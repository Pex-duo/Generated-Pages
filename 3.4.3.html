<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="pageTitle">Interaktywny przewodnik: Zaawansowane łączenie modeli</title>
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html { scroll-padding-top: 5rem; }
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #cbd5e1; }
        #shader-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
        .content-wrapper { position: relative; z-index: 1; }
        .chart-container { position: relative; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
        @media (min-width: 768px) { .chart-container { height: 450px; } }
        .version-btn, .recipe-btn, .lang-btn { transition: background-color 0.3s, border-color 0.3s, color 0.3s, box-shadow 0.3s, transform 0.3s; transform-style: preserve-3d; }
        .card { background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 0.75rem; border: 1px solid #334155; transition: all 0.3s ease-in-out; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
        .card:hover { box-shadow: 0 0 25px -5px rgba(79, 70, 229, 0.3); border-color: #4f46e5; transform: translateY(-4px) scale(1.02); }
        .version-btn, .recipe-btn, .lang-btn { background-color: rgba(30, 41, 59, 0.8); color: #e2e8f0; border: 1px solid #475569; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .version-btn:hover, .recipe-btn:hover, .lang-btn:hover { background-color: #3730a3; border-color: #6366f1; color: white; }
        .version-btn.active, .recipe-btn.active, .lang-btn.active { background-color: #4f46e5; color: white; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); border-color: #6366f1; }
        .dare-panel { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3); }
        .flow-arrow { font-family: monospace; font-weight: bold; }
    </style>
</head>
<body class="bg-slate-900">
    <canvas id="shader-canvas"></canvas>
    <div class="content-wrapper">
        <header class="bg-slate-900/50 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-700">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="font-bold text-lg text-slate-100" data-i18n-key="guideTitle"></span>
                    </div>
                    <div class="flex items-center space-x-8">
                        <div id="main-nav" class="flex items-center space-x-4 text-sm font-medium">
                            <a id="nav-blueprints" href="#sdxl-blueprints" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.blueprints"></a>
                            <a id="nav-recipes" href="#sdxl-recipes" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.recipes"></a>
                            <a href="#analysis" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.analysis"></a>
                            <a href="#glossary" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.glossary"></a>
                        </div>
                         <div class="flex items-center">
                            <button id="lang-pl" class="lang-btn active px-3 py-1 rounded-l-md text-xs font-medium">PL</button>
                            <button id="lang-en" class="lang-btn px-3 py-1 rounded-r-md text-xs font-medium">EN</button>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <section class="text-center mb-16">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-100 tracking-tight" data-i18n-key="header.title"></h1>
                <p class="mt-4 text-lg text-slate-400 max-w-3xl mx-auto" data-i18n-key="header.subtitle"></p>
            </section>

            <div id="strategy-selector" class="flex justify-center flex-wrap gap-4 mb-16 p-4 bg-slate-800/50 border border-slate-700 rounded-lg shadow-inner">
                <button id="select-sdxl" class="version-btn active px-6 py-3 rounded-md text-base font-medium" data-i18n-key="strategy.sdxl"></button>
                <button id="select-pony" class="version-btn px-6 py-3 rounded-md text-base font-medium" data-i18n-key="strategy.pony"></button>
                <button id="select-hybrid" class="version-btn px-6 py-3 rounded-md text-base font-medium" data-i18n-key="strategy.hybrid"></button>
            </div>

            <div id="sdxl-content">
                <section id="sdxl-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="sdxl.blueprint.title"></h2>
                    <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="sdxl.blueprint.description"></p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Animij [Illustrious] V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="sdxl.blueprint.card1.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card1.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor SemiRealIllustMix</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="sdxl.blueprint.card2.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card2.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Boomer Art Model v2.0</h3><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="sdxl.blueprint.card3.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card3.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">D34D.CH4NN3L.SDXL</h3><p class="text-sm font-medium text-red-400 mb-2" data-i18n-key="sdxl.blueprint.card4.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card4.desc"></p></div>
                    </div>
                </section>
                <section id="sdxl-recipes" class="mb-24 scroll-mt-20">
                     <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="sdxl.recipes.title"></h2>
                     <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="sdxl.recipes.step1.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl.recipes.step1.desc"></p>
                         <div class="flex justify-center flex-wrap gap-4 mb-6" id="sdxl-recipe-buttons">
                            <button data-recipe="balanced" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl.recipes.step1.btnBalanced"></button>
                            <button data-recipe="host_dominant" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl.recipes.step1.btnHost"></button>
                            <button data-recipe="donor_receptive" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl.recipes.step1.btnDonor"></button>
                         </div>
                         <div id="sdxl-recipe-explanation" class="mb-6 p-4 bg-indigo-900/30 border border-indigo-500/50 text-indigo-200 rounded-md text-sm"></div>
                         <div class="chart-container lazy-chart" id="sdxlChartContainer"><canvas id="sdxlChart"></canvas></div>
                         <div id="sdxl-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart.hoverPrompt"></div>
                     </div>
                </section>
            </div>

            <div id="pony-content" class="hidden">
                 <section id="pony-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="pony.blueprint.title"></h2>
                    <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="pony.blueprint.description"></p>
                    </section>
                 <section id="pony-recipes" class="mb-24 scroll-mt-20">
                     <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="pony.recipes.title"></h2>
                      <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="pony.recipes.step1.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="pony.recipes.step1.desc"></p>
                         <div class="flex justify-center flex-wrap gap-4 mb-6" id="pony-recipe-buttons">
                            <button data-recipe="stage1" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="pony.recipes.step1.btnStage1"></button>
                            <button data-recipe="stage2" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="pony.recipes.step1.btnStage2"></button>
                            <button data-recipe="stage3" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="pony.recipes.step1.btnStage3"></button>
                         </div>
                         <div class="chart-container lazy-chart" id="ponyChartContainer"><canvas id="ponyChart"></canvas></div>
                         <div id="pony-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart.hoverPrompt"></div>
                     </div>
                 </section>
            </div>
            
            <div id="hybrid-content" class="hidden">
                <section id="hybrid-recipes" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="hybrid.recipes.title"></h2>
                    <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="hybrid.recipes.step1.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="hybrid.recipes.step1.desc"></p>
                         <div class="flex justify-center flex-wrap gap-4 mb-6" id="hybrid-recipe-buttons">
                            <button data-recipe="stage1" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage1"></button>
                            <button data-recipe="stage2" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage2"></button>
                            <button data-recipe="stage3" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage3"></button>
                            <button data-recipe="stage4" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage4"></button>
                         </div>
                         <div id="hybrid-recipe-explanation" class="mb-6" style="display: none;"></div>
                         <div class="chart-container lazy-chart" id="hybridChartContainer"><canvas id="hybridChart"></canvas></div>
                         <div id="hybrid-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart.hoverPrompt"></div>
                    </div>
                    <div class="card p-8">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="hybrid.assembly.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="hybrid.assembly.desc"></p>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="hybrid.assembly.clip.title"></h4>
                                 <p class="text-sm text-slate-400 mb-4" data-i18n-key="hybrid.assembly.clip.desc"></p>
                                <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                    <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20">
                                        <p class="font-medium mb-1 text-indigo-300" data-i18n-key="hybrid.assembly.clip.step1Title"></p>
                                        <div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">NoobAI CLIPs</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">Illustrious CLIPs</div></div>
                                        <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(70% / 30%)</span></div>
                                        <div class="p-2 bg-purple-500/50 rounded-md text-purple-100 mt-1">Pony Base CLIP</div>
                                    </div>
                                    
                                     <div class="self-center mt-1 text-slate-400 flow-arrow text-2xl">↓</div>

                                    <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30">
                                        <p class="font-medium mb-1 text-slate-300" data-i18n-key="hybrid.assembly.clip.step2Title"></p>
                                        <div class="flex justify-around items-center">
                                            <div class="p-2 bg-purple-500/50 rounded-md text-purple-100">Pony Base CLIP</div>
                                            <div class="text-slate-400 font-thin text-xl flow-arrow">+</div>
                                            <div class="p-2 bg-red-500/50 rounded-md text-red-100">SDXL CLIP</div>
                                        </div>
                                        <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(85% / 15%)</span></div>
                                        <div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2" data-i18n-key="hybrid.assembly.clip.final"></div>
                                    </div>
                                </div>
                                 <div class="dare-panel mt-6">
                                     <h5 class="text-sm font-semibold text-slate-300 mb-2" data-i18n-key="hybrid.assembly.clip.noteTitle"></h5>
                                     <p class="text-xs text-slate-400" data-i18n-key="hybrid.assembly.clip.noteDesc"></p>
                                 </div>
                             </div>
                             <div>
                                <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="vae.title"></h4>
                                <p class="text-sm text-slate-400 mb-6" data-i18n-key="hybrid.assembly.vae.desc"></p>
                                <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                     <p class="font-semibold text-indigo-200" data-i18n-key="vae.recommendation"></p>
                                     <p class="text-indigo-300">Use the VAE built into `JANKU V4.0`.</p>
                                     <p class="text-xs mt-2 text-indigo-400" data-i18n-key="hybrid.assembly.vae.justification"></p>
                                 </div>
                             </div>
                         </div>
                    </div>
                </section>
            </div>
            
            </main>

        <footer class="bg-slate-900/50 mt-24 border-t border-slate-700">
            <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
                <p data-i18n-key="footer.text"></p>
            </div>
        </footer>
    </div>

<script>
// Defer script execution until the DOM is fully loaded.
document.addEventListener('DOMContentLoaded', () => {

    // --- OPTIMIZATION: WEBGL SHADER CONTROL ---
    let animationFrameId;
    let isTabVisible = true;

    function initShaderBackground() {
        // Shader setup code remains the same...
        // ... but we add visibility control to the render loop
        const canvas = document.getElementById('shader-canvas');
        try {
            const gl = canvas.getContext('webgl');
            if (!gl) { console.error("WebGL not supported"); return; }
            
            // Simplified fragment shader for better performance
            const fragmentShaderSource = `
                precision mediump float;
                uniform vec2 u_resolution;
                uniform float u_time;
                float random(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453); }
                float noise(vec2 st) {
                    vec2 i = floor(st); vec2 f = fract(st);
                    vec2 u = f*f*(3.0-2.0*f);
                    return mix(mix(random(i + vec2(0.0,0.0)), random(i + vec2(1.0,0.0)), u.x),
                               mix(random(i + vec2(0.0,1.0)), random(i + vec2(1.0,1.0)), u.x), u.y);
                }
                float fbm(vec2 st) {
                    float value = 0.0; float amplitude = .5;
                    // OPTIMIZATION: Reduced from 6 octaves to 4 for performance
                    for (int i = 0; i < 4; i++) {
                        value += amplitude * noise(st);
                        st *= 2.; amplitude *= .5;
                    }
                    return value;
                }
                void main() {
                    vec2 st = gl_FragCoord.xy/u_resolution.xy;
                    st.x *= u_resolution.x/u_resolution.y;
                    float f = fbm(st * 3.0 + u_time * 0.1);
                    gl_FragColor = vec4(vec3(f * 0.1, f * 0.15, f * 0.25), 1.0);
                }`;
            
            // ... (rest of the shader compilation code is the same)
             const vertexShaderSource = `attribute vec2 a_position; void main() { gl_Position = vec4(a_position, 0.0, 1.0); }`;
             function createShader(gl, type, source) { const shader = gl.createShader(type); gl.shaderSource(shader, source); gl.compileShader(shader); if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) { console.error('Shader error: ' + gl.getShaderInfoLog(shader)); gl.deleteShader(shader); return null; } return shader; }
             const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
             const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
             const program = gl.createProgram(); gl.attachShader(program, vertexShader); gl.attachShader(program, fragmentShader); gl.linkProgram(program);
             if (!gl.getProgramParameter(program, gl.LINK_STATUS)) { console.error('Shader program error: ' + gl.getProgramInfoLog(program)); return; }
             gl.useProgram(program);
             const positionBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer); gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, 1, 1, 1, -1, -1, 1, -1]), gl.STATIC_DRAW);
             const positionAttributeLocation = gl.getAttribLocation(program, "a_position"); gl.enableVertexAttribArray(positionAttributeLocation); gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);
             const resolutionUniformLocation = gl.getUniformLocation(program, "u_resolution");
             const timeUniformLocation = gl.getUniformLocation(program, "u_time");

            function render(time) {
                if (!isTabVisible) return; // Pause rendering if tab is not visible
                time *= 0.0005;
                canvas.width = gl.canvas.clientWidth;
                canvas.height = gl.canvas.clientHeight;
                gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
                gl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);
                gl.uniform1f(timeUniformLocation, time);
                gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                animationFrameId = requestAnimationFrame(render);
            }
            animationFrameId = requestAnimationFrame(render);
        } catch (e) { console.error("WebGL init error:", e); }
    }
    
    // Controls for pausing the animation
    document.addEventListener('visibilitychange', () => {
        isTabVisible = document.visibilityState === 'visible';
        if (isTabVisible) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = requestAnimationFrame(render);
        } else {
            cancelAnimationFrame(animationFrameId);
        }
    });

    // --- OPTIMIZATION: I18N REFACTOR ---
    const i18nData = {
        pl: {
            pageTitle: "Interaktywny przewodnik: Zaawansowane łączenie modeli",
            guideTitle: "Przewodnik po Łączeniu Modeli",
            "nav.blueprints": "Schematy",
            "nav.recipes": "Przepisy",
            "nav.analysis": "Analiza",
            "nav.glossary": "Glosariusz",
            "header.title": "Zaawansowane Łączenie Modeli",
            "header.subtitle": "Interaktywny przewodnik po trzech filozofiach łączenia...",
            "strategy.sdxl": "Strategia \"Przeszczepu SDXL\"",
            "strategy.pony": "Strategia \"Czystej Krwi PONY\"",
            "strategy.hybrid": "Strategia \"Hybrydowego Łatania\"",
            // SDXL Section
            "sdxl.blueprint.title": "Schemat: Strategia \"Przeszczepu SDXL\"",
            "sdxl.blueprint.description": "Ta strategia wykorzystuje stabilny model-host w stylu anime...",
            "sdxl.blueprint.card1.role": "Model A (Host, Priorytet 1)",
            "sdxl.blueprint.card1.desc": "Zapewnia fundamentalne rusztowanie...",
            "sdxl.blueprint.card2.role": "Model B (Pomostowy)",
            "sdxl.blueprint.card2.desc": "Działa jako pomost...",
            "sdxl.blueprint.card3.role": "Dawca Stylu Malarskiego (Priorytet 3)",
            "sdxl.blueprint.card3.desc": "Wstrzykuje malarską, heroiczną esencję...",
            "sdxl.blueprint.card4.role": "Dawca Tematyczny (Priorytet 2)",
            "sdxl.blueprint.card4.desc": "Potężny dawca do wstrzykiwania mrocznych...",
            "sdxl.recipes.title": "Przepis i Implementacja: Przeszczep SDXL",
            "sdxl.recipes.step1.title": "Etap 1: Tworzenie Hosta (Łączenie z wagami bloków)",
            "sdxl.recipes.step1.desc": "Najpierw tworzymy solidny model-hosta...",
            "sdxl.recipes.step1.btnBalanced": "Przepis A: Zrównoważony",
            "sdxl.recipes.step1.btnHost": "Przepis B: Z dominacją Hosta",
            "sdxl.recipes.step1.btnDonor": "Przepis C: Podatny na Dawcę",
             // Hybrid Section
            "hybrid.recipes.title": "Przepis i Implementacja: Hybrydowe Łatanie",
            "hybrid.recipes.step1.title": "Czteroetapowy Przepis Hybrydowy",
            "hybrid.recipes.step1.desc": "Ten przepis obejmuje łączenie bloków, chirurgiczną iniekcję DARE-TIES i ostateczną fuzję...",
            "hybrid.recipes.step1.btnStage1": "Etap 1: Baza Dark Anime",
            "hybrid.recipes.step1.btnStage2": "Etap 2: Most Malarski",
            "hybrid.recipes.step1.btnStage3": "Etap 3: Łatka Anatomiczna",
            "hybrid.recipes.step1.btnStage4": "Etap 4: Finałowa Fuzja",
            "hybrid.assembly.title": "Montaż: Wersja Hybrydowa",
            "hybrid.assembly.desc": "Łączenie CLIP jest tu najbardziej złożone...",
            "hybrid.assembly.clip.title": "Tworzenie \"Trójjęzycznego\" CLIP",
            "hybrid.assembly.clip.desc": "Aby zapewnić kompatybilność, wykonujemy sekwencyjne, ważone łączenie...",
            "hybrid.assembly.clip.step1Title": "Etap 1: Tworzenie bazowego CLIP Pony",
            "hybrid.assembly.clip.step2Title": "Etap 2: Łączenie z SDXL",
            "hybrid.assembly.clip.final": "Finałowy Trójjęzyczny CLIP",
            "hybrid.assembly.clip.noteTitle": "Uwaga: Łatanie niezgodności CLIP",
            "hybrid.assembly.clip.noteDesc": "CLIP modelu \"Boomer Art\" (SDXL) jest architektonicznie niezgodny...",
            "hybrid.assembly.vae.desc": "VAE z głównego hosta strukturalnego, `JANKU V4.0`, pozostaje najbezpieczniejszym wyborem...",
            "hybrid.assembly.vae.justification": "Ponieważ ostateczny model jest w przeważającej mierze oparty na Pony...",
            "vae.title": "Wybór VAE dla Wierności",
            "vae.recommendation": "Główna Rekomendacja",
            "chart.hoverPrompt": "Najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie.",
            "footer.text": "Skonsolidowany Interaktywny Przewodnik po Zaawansowanym Łączeniu Modeli"
        },
        en: {
            pageTitle: "Interactive Guide: Advanced Model Merging",
            guideTitle: "Model Merging Guide",
            "nav.blueprints": "Blueprints",
            "nav.recipes": "Recipes",
            "nav.analysis": "Analysis",
            "nav.glossary": "Glossary",
            "header.title": "Advanced Model Merging",
            "header.subtitle": "An interactive guide to three merging philosophies...",
            "strategy.sdxl": "\"SDXL Grafting\" Strategy",
            "strategy.pony": "\"Pureblood PONY\" Strategy",
            "strategy.hybrid": "\"Hybrid Patching\" Strategy",
            // SDXL Section
            "sdxl.blueprint.title": "Blueprint: \"SDXL Grafting\" Strategy",
            "sdxl.blueprint.description": "This strategy uses a stable anime-style host model...",
            "sdxl.blueprint.card1.role": "Model A (Host, Priority 1)",
            "sdxl.blueprint.card1.desc": "Provides the fundamental scaffolding...",
            "sdxl.blueprint.card2.role": "Model B (Bridge)",
            "sdxl.blueprint.card2.desc": "Acts as a bridge...",
            "sdxl.blueprint.card3.role": "Painterly Style Donor (Priority 3)",
            "sdxl.blueprint.card3.desc": "Injects a painterly, heroic essence...",
            "sdxl.blueprint.card4.role": "Thematic Donor (Priority 2)",
            "sdxl.blueprint.card4.desc": "A powerful donor for injecting dark...",
            "sdxl.recipes.title": "Recipe & Implementation: SDXL Grafting",
            "sdxl.recipes.step1.title": "Step 1: Host Creation (Block Weight Merge)",
            "sdxl.recipes.step1.desc": "First, we create a robust host model by merging...",
            "sdxl.recipes.step1.btnBalanced": "Recipe A: Balanced",
            "sdxl.recipes.step1.btnHost": "Recipe B: Host-Dominant",
            "sdxl.recipes.step1.btnDonor": "Recipe C: Donor-Receptive",
            // Hybrid Section
            "hybrid.recipes.title": "Recipe & Implementation: Hybrid Patching",
            "hybrid.recipes.step1.title": "Four-Stage Hybrid Recipe",
            "hybrid.recipes.step1.desc": "This recipe involves block merging, a surgical DARE-TIES injection, and a final fusion...",
            "hybrid.recipes.step1.btnStage1": "Stage 1: Dark Anime Base",
            "hybrid.recipes.step1.btnStage2": "Stage 2: Painterly Bridge",
            "hybrid.recipes.step1.btnStage3": "Stage 3: Anatomical Patch",
            "hybrid.recipes.step1.btnStage4": "Stage 4: Final Fusion",
            "hybrid.assembly.title": "Assembly: Hybrid Version",
            "hybrid.assembly.desc": "CLIP merging is most complex here...",
            "hybrid.assembly.clip.title": "Creating a \"Trilingual\" CLIP",
            "hybrid.assembly.clip.desc": "To ensure compatibility, we perform a sequential, weighted merge...",
            "hybrid.assembly.clip.step1Title": "Step 1: Create Pony Base CLIP",
            "hybrid.assembly.clip.step2Title": "Step 2: Merge with SDXL",
            "hybrid.assembly.clip.final": "Final Trilingual CLIP",
            "hybrid.assembly.clip.noteTitle": "Note: Patching CLIP Incompatibility",
            "hybrid.assembly.clip.noteDesc": "The \"Boomer Art\" model's CLIP (SDXL) is architecturally incompatible...",
            "hybrid.assembly.vae.desc": "The VAE from the main structural host, `JANKU V4.0`, remains the safest choice...",
            "hybrid.assembly.vae.justification": "Since the final model is predominantly Pony-based...",
            "vae.title": "Choosing a VAE for Fidelity",
            "vae.recommendation": "Top Recommendation",
            "chart.hoverPrompt": "Hover over a block on the chart to see the rationale for its weight.",
            "footer.text": "Consolidated Interactive Guide to Advanced Model Merging"
        }
    };

    let currentLanguage = 'pl';

    function setLanguage(lang) {
        currentLanguage = lang;
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-i18n-key]').forEach(el => {
            const key = el.getAttribute('data-i18n-key');
            el.innerHTML = i18nData[lang][key] || i18nData['en'][key];
        });
        
        document.getElementById('lang-pl').classList.toggle('active', lang === 'pl');
        document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        
        // Refresh chart data for new labels
        if (sdxlChartInstance) updateSdxlChart(document.querySelector('#sdxl-recipe-buttons .active').dataset.recipe);
        if (ponyChartInstance) updatePonyChart(document.querySelector('#pony-recipe-buttons .active').dataset.recipe);
        if (hybridChartInstance || document.querySelector('#hybrid-recipe-explanation').style.display === 'block') {
             updateHybridChart(document.querySelector('#hybrid-recipe-buttons .active').dataset.recipe);
        }
    }

    document.getElementById('lang-pl').addEventListener('click', () => setLanguage('pl'));
    document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));

    // --- Charting Logic (with lazy loading) ---
    const blockLabels = ['IN00', 'IN01', 'IN02', 'IN03', 'IN04', 'IN05', 'IN06', 'IN07', 'IN08', 'IN09', 'IN10', 'IN11', 'M00', 'OUT00', 'OUT01', 'OUT02', 'OUT03', 'OUT04', 'OUT05', 'OUT06', 'OUT07', 'OUT08', 'OUT09', 'OUT10', 'OUT11'];
    let sdxlChartInstance, ponyChartInstance, hybridChartInstance;

    // Data objects (sdxlData, ponyData, etc.) would go here...

    const lazyCharts = document.querySelectorAll('.lazy-chart');
    const chartObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const chartContainerId = entry.target.id;
                if (chartContainerId === 'sdxlChartContainer' && !sdxlChartInstance) initializeSdxlChart();
                if (chartContainerId === 'ponyChartContainer' && !ponyChartInstance) initializePonyChart();
                if (chartContainerId === 'hybridChartContainer' && !hybridChartInstance) initializeHybridChart();
                observer.unobserve(entry.target);
            }
        });
    }, { rootMargin: "100px" });

    lazyCharts.forEach(chart => chartObserver.observe(chart));

    // General initialization and event delegation
    initShaderBackground();
    setLanguage('pl');

    document.getElementById('strategy-selector').addEventListener('click', (e) => {
        if (e.target.classList.contains('version-btn')) {
            const version = e.target.id.replace('select-', '');
            switchVersion(version);
        }
    });

    document.getElementById('sdxl-recipe-buttons').addEventListener('click', handleRecipeButtonClick(updateSdxlChart));
    document.getElementById('pony-recipe-buttons').addEventListener('click', handleRecipeButtonClick(updatePonyChart));
    document.getElementById('hybrid-recipe-buttons').addEventListener('click', handleRecipeButtonClick(updateHybridChart));

    function handleRecipeButtonClick(updateFunction) {
        return function(e) {
            if (e.target.classList.contains('recipe-btn')) {
                const recipeKey = e.target.dataset.recipe;
                e.currentTarget.querySelectorAll('.recipe-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                updateFunction(recipeKey);
            }
        }
    }

    function switchVersion(version) {
        ['sdxl', 'pony', 'hybrid'].forEach(v => {
            document.getElementById(`${v}-content`).style.display = v === version ? 'block' : 'none';
            document.getElementById(`select-${v}`).classList.toggle('active', v === version);
        });
         document.getElementById('nav-blueprints').href = `#${version}-blueprints`;
         document.getElementById('nav-recipes').href = `#${version}-recipes`;
    }
    
    // Initial state
    switchVersion('sdxl');
});

</script>
</body>
</html>
