<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktywny przewodnik: Zaawansowane łączenie modeli (Potrójna strategia)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Celestial Indigo -->
    <!-- Application Structure Plan: Aplikacja zachowuje swoją podstawową strukturę opartą na trzech przełączanych przez użytkownika strategiach. Kluczowe ulepszenie wizualne to animowane tło oparte na shaderze WebGL, które nadaje immersyjne, zaawansowane technologicznie odczucie, odpowiednie dla tematyki AI. Kluczowe diagramy (takie jak łączenie CLIP) są przekształcone z list tekstowych w graficzne schematy blokowe przy użyciu stylizowanego HTML/CSS dla lepszego zrozumienia. Nowa sekcja "Glosariusz" definiuje złożone terminy, poprawiając dostępność dla szerszej publiczności. Ta struktura nakłada bogate wizualizacje i treści objaśniające na solidny, interaktywny rdzeń danych, zwiększając zaangażowanie i zrozumienie użytkownika. -->
    <!-- Visualization & Content Choices: Informacje z raportu -> Procesy łączenia. Cel -> Wizualne wyjaśnienie przepływu danych. Prezentacja -> Schematy blokowe HTML/CSS ze strzałkami zamiast prostych list. Interakcja -> Brak, statyczny wyświetlacz. Uzasadnienie -> Schematy blokowe są znacznie lepsze w pokazywaniu procesów i relacji niż listy. Informacje z raportu -> Parametry DARE-TIES. Cel -> Uczynienie abstrakcyjnych parametrów namacalnymi. Prezentacja -> Zamiast bloków kodu użyto niestandardowych, stylizowanych kart "panelu technicznego", aby uzyskać bardziej intuicyjną i atrakcyjną wizualnie prezentację ustawień węzłów. Interakcja -> Brak. Uzasadnienie -> Wzmacnia metaforę "wstrzykiwania umiejętności" poprzez interfejs naśladujący interfejs oparty na węzłach. Nowa treść -> Glosariusz terminów. Cel -> Zdefiniowanie żargonu. Prezentacja -> Dedykowana, stylizowana sekcja. Interakcja -> Brak. Uzasadnienie -> Kluczowe dla edukacji użytkownika. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html {
            scroll-padding-top: 5rem;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #cbd5e1; /* slate-300 */
        }
        #shader-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }
        .content-wrapper {
            position: relative;
            z-index: 1;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 450px;
            }
        }
        .version-btn,.recipe-btn {
            transition: background-color 0.3s, border-color 0.3s, color 0.3s, box-shadow 0.3s, transform 0.3s;
            transform-style: preserve-3d;
        }
        .card {
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            border: 1px solid #334155;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }
        .card:hover {
            box-shadow: 0 0 25px -5px rgba(79, 70, 229, 0.3);
            border-color: #4f46e5;
            transform: translateY(-4px) scale(1.02);
        }
        .version-btn, .recipe-btn {
            background-color: rgba(30, 41, 59, 0.8);
            color: #e2e8f0;
            border: 1px solid #475569;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }
        .version-btn:hover, .recipe-btn:hover {
             background-color: #3730a3;
             border-color: #6366f1;
             color: white;
        }
        .version-btn.active, .recipe-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
            border-color: #6366f1;
        }
        .dare-panel {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid #334155;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
        }
        .flow-arrow {
            font-family: monospace;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-slate-900">
    <canvas id="shader-canvas"></canvas>
    <div class="content-wrapper">
        <header class="bg-slate-900/50 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-700">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="font-bold text-lg text-slate-100">Przewodnik po Łączeniu Modeli</span>
                    </div>
                    <div id="main-nav" class="flex items-center space-x-4 text-sm font-medium">
                        <a id="nav-blueprints" href="#sdxl-blueprints" class="text-slate-300 hover:text-white transition-colors">Schematy</a>
                        <a id="nav-recipes" href="#sdxl-recipes" class="text-slate-300 hover:text-white transition-colors">Przepisy</a>
                        <a href="#analysis" class="text-slate-300 hover:text-white transition-colors">Analiza</a>
                        <a href="#glossary" class="text-slate-300 hover:text-white transition-colors">Glosariusz</a>
                    </div>
                </div>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <section class="text-center mb-16">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-100 tracking-tight">Zaawansowane Łączenie Modeli</h1>
                <p class="mt-4 text-lg text-slate-400 max-w-3xl mx-auto">Interaktywny przewodnik po trzech filozofiach łączenia w celu stworzenia modelu do zasobów gry w stylu retro anime, dark fantasy i sci-fi. Wybierz strategię, aby poznać jej komponenty i przepisy.</p>
            </section>

            <div class="flex justify-center flex-wrap gap-4 mb-16 p-4 bg-slate-800/50 border border-slate-700 rounded-lg shadow-inner">
                <button id="select-sdxl" class="version-btn active px-6 py-3 rounded-md text-base font-medium">Strategia "Przeszczepu SDXL"</button>
                <button id="select-pony" class="version-btn px-6 py-3 rounded-md text-base font-medium">Strategia "Czystej Krwi PONY"</button>
                <button id="select-hybrid" class="version-btn px-6 py-3 rounded-md text-base font-medium">Strategia "Hybrydowego Łatania"</button>
            </div>

            <div id="sdxl-content">
                <section id="sdxl-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2">Schemat: Strategia "Przeszczepu SDXL"</h2>
                    <p class="text-slate-400 mb-10 max-w-4xl">Ta strategia wykorzystuje stabilny model-host w stylu anime i chirurgicznie wstrzykuje określone "umiejętności" od architektonicznie różnych dawców `SDXL 1.0` za pomocą algorytmu DARE-TIES. Celem jest połączenie czystego stylu retro anime (Priorytet 1) z estetyką dark fantasy/sci-fi (Priorytet 2) i malarskim stylem (Priorytet 3).</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Animij [Illustrious] V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2">Model A (Host, Priorytet 1)</p><p class="text-sm text-slate-400 flex-grow">Zapewnia fundamentalne rusztowanie: doskonałą anatomię, kompozycję i żywy styl retro anime z czystymi liniami.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor SemiRealIllustMix</h3><p class="text-sm font-medium text-indigo-400 mb-2">Model B (Pomostowy)</p><p class="text-sm text-slate-400 flex-grow">Działa jako pomost, łącząc czysty wygląd anime z półrealistycznym odczuciem, aby uczynić hosta bardziej podatnym na dawców.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Boomer Art Model v2.0</h3><p class="text-sm font-medium text-amber-400 mb-2">Dawca Stylu Malarskiego (Priorytet 3)</p><p class="text-sm text-slate-400 flex-grow">Wstrzykuje malarską, heroiczną esencję fantasy w stylu Frazetty i Vallejo, zapewniając pożądane wykończenie tekstur.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">D34D.CH4NN3L.SDXL</h3><p class="text-sm font-medium text-red-400 mb-2">Dawca Tematyczny (Priorytet 2)</p><p class="text-sm text-slate-400 flex-grow">Potężny dawca do wstrzykiwania mrocznych, surowych, horrorowych i fantastycznonaukowych treści tematycznych.</p></div>
                    </div>
                </section>
                <section id="sdxl-recipes" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2">Przepis i Implementacja: Przeszczep SDXL</h2>
                    <div class="card p-6 md:p-8 mb-12">
                        <h3 class="text-xl font-bold text-slate-100 mb-4">Etap 1: Tworzenie Hosta (Łączenie z wagami bloków)</h3>
                        <p class="text-sm text-slate-400 mb-6">Najpierw tworzymy solidny model-hosta, łącząc Animij (Model A) i Graycolor (Model B). Wartość wagi (`weight`) odnosi się do wkładu Modelu B. Waga `1.0` to 100% Modelu B, a `0.0` to 100% Modelu A.</p>
                        <div class="flex justify-center flex-wrap gap-4 mb-6">
                            <button id="recipe-sdxl-balanced" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium">Przepis A: Zrównoważony</button>
                            <button id="recipe-sdxl-host_dominant" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Przepis B: Z dominacją Hosta</button>
                            <button id="recipe-sdxl-donor_receptive" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Przepis C: Podatny na Dawcę</button>
                        </div>
                        <div id="sdxl-recipe-explanation" class="mb-6 p-4 bg-indigo-900/30 border border-indigo-500/50 text-indigo-200 rounded-md text-sm"></div>
                        <div class="chart-container"><canvas id="sdxlChart"></canvas></div>
                        <div id="sdxl-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]">Najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie jego wagi.</div>
                    </div>
                    <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4">Etap 2: Wstrzykiwanie umiejętności (DARE-TIES)</h3>
                         <p class="text-sm text-slate-400 mb-6">W tym etapie używamy zaawansowanego węzła `Model Merger (Advanced/DARE)`. Ta metoda jest alternatywą dla łączenia blokowego i ignoruje wagi ustawione dla poszczególnych bloków. Kontrola nad procesem odbywa się poprzez parametry DARE i TIES. Ogólna waga modelu powinna być ustawiona na `1.0`, aby zmiany zostały w pełni zastosowane.</p>
                         <div class="grid md:grid-cols-1 gap-8">
                             <div class="dare-panel">
                                 <h4 class="font-bold text-lg text-slate-200 mb-4 text-center">Krok 2a: Wstrzyknij styl malarski (Priorytet 3)</h4>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                     <div>
                                         <h5 class="text-sm font-semibold text-indigo-300 mb-2">Krok 1: Przycinanie (TIES Trim)</h5>
                                         <p class="text-xs text-slate-400 mb-4">Użyj węzła `Magnitude Masker`, aby zachować 40% najważniejszych zmian.</p>
                                         <p class="text-xs"><strong class="text-slate-300">model_a:</strong> Host z Etapu 1</p>
                                         <p class="text-xs"><strong class="text-slate-300">model_b:</strong> sd_xl_base_1.0</p>
                                         <p class="text-xs"><strong class="text-slate-300">threshold:</strong> 0.60</p>
                                         <p class="text-xs"><strong class="text-slate-300">threshold_type:</strong> quantile</p>
                                     </div>
                                     <div>
                                         <h5 class="text-sm font-semibold text-amber-300 mb-2">Krok 2: Łączenie (DARE Merge)</h5>
                                         <p class="text-xs text-slate-400 mb-4">Użyj `Model Merger (DARE)` z utworzoną maską.</p>
                                         <p class="text-xs"><strong class="text-slate-300">model1:</strong> Host z Etapu 1</p>
                                         <p class="text-xs"><strong class="text-slate-300">model2:</strong> Boomer Art Model</p>
                                         <p class="text-xs"><strong class="text-slate-300">base_model:</strong> sd_xl_base_1.0</p>
                                         <p class="text-xs"><strong class="text-slate-300">density:</strong> 0.45</p>
                                         <p class="text-xs"><strong class="text-slate-300">ties_mode:</strong> sum</p>
                                     </div>
                                 </div>
                                 <div class="mt-6 pt-4 border-t border-slate-700">
                                     <h5 class="text-sm font-semibold text-slate-300 mb-2">Uzasadnienie</h5>
                                     <p class="text-xs text-slate-400">`threshold: 0.60` w trybie `quantile` zachowuje 40% najważniejszych wektorów zmian, precyzyjnie izolując esencję stylu malarskiego. `density: 0.45` dodatkowo przerzedza te wektory, zapobiegając nadpisaniu bazy anime. Tryb `sum` jest standardowym, zalecanym wyborem dla TIES.</p>
                                 </div>
                             </div>
                             <div class="dare-panel mt-8">
                                 <h4 class="font-bold text-lg text-slate-200 mb-4 text-center">Krok 2b: Wstrzyknij treść tematyczną (Priorytet 2)</h4>
                                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                      <div>
                                          <h5 class="text-sm font-semibold text-indigo-300 mb-2">Krok 1: Przycinanie (TIES Trim)</h5>
                                          <p class="text-xs text-slate-400 mb-4">Użyj `Magnitude Masker`, aby zachować 50% najważniejszych zmian.</p>
                                          <p class="text-xs"><strong class="text-slate-300">model_a:</strong> Wynik z Kroku 2a</p>
                                          <p class="text-xs"><strong class="text-slate-300">model_b:</strong> sd_xl_base_1.0</p>
                                          <p class="text-xs"><strong class="text-slate-300">threshold:</strong> 0.50</p>
                                          <p class="text-xs"><strong class="text-slate-300">threshold_type:</strong> quantile</p>
                                      </div>
                                      <div>
                                          <h5 class="text-sm font-semibold text-red-300 mb-2">Krok 2: Łączenie (DARE Merge)</h5>
                                          <p class="text-xs text-slate-400 mb-4">Użyj `Model Merger (DARE)` z nową maską.</p>
                                          <p class="text-xs"><strong class="text-slate-300">model1:</strong> Wynik z Kroku 2a</p>
                                          <p class="text-xs"><strong class="text-slate-300">model2:</strong> D34D.CH4NN3L.SDXL</p>
                                          <p class="text-xs"><strong class="text-slate-300">base_model:</strong> sd_xl_base_1.0</p>
                                          <p class="text-xs"><strong class="text-slate-300">density:</strong> 0.35</p>
                                          <p class="text-xs"><strong class="text-slate-300">ties_mode:</strong> sum</p>
                                      </div>
                                  </div>
                                 <div class="mt-6 pt-4 border-t border-slate-700">
                                     <h5 class="text-sm font-semibold text-slate-300 mb-2">Uzasadnienie</h5>
                                     <p class="text-xs text-slate-400">Mniej agresywne przycinanie (`threshold: 0.50`) pozwala na przeszczepienie szerszego spektrum cech tematycznych. Niższa `gęstość` (0.35) zapewnia, że te zmiany są stosowane subtelnie, dodając mroczne motywy bez niszczenia ustalonego już stylu.</p>
                                 </div>
                             </div>
                         </div>
                    </div>
                     <div class="card p-8">
                         <h3 class="text-xl font-bold text-slate-100 mb-4">Montaż: Wersja "Przeszczepu SDXL"</h3>
                         <p class="text-sm text-slate-400 mb-6">Strategia CLIP i VAE dla tej wersji musi uwzględniać różne rodziny architektoniczne, aby zapewnić, że model rozumie prompty i prawidłowo renderuje kolory.</p>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4">Tworzenie "Dwujęzycznego" CLIP</h4>
                                 <p class="text-sm text-slate-400 mb-4">Aby zapobiec "zderzeniu leksykonów", tworzymy "dwujęzyczny" CLIP poprzez sekwencyjne łączenie, co pozwala mu rozumieć zarówno tagi hosta, jak i naturalny język dawców.</p>
                                 <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                     <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20"><p class="font-medium mb-1 text-indigo-300">1. HOST CLIP</p><div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">Animij</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">Graycolor</div></div><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(50/50)</span></div></div>
                                     <div class="p-2 border border-amber-500/50 rounded-lg bg-amber-900/20"><p class="font-medium mb-1 text-amber-300">2. DONOR CLIP</p><div class="flex justify-around items-center"><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">Boomer Art</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-red-500/30 rounded-md text-red-200">D34D.CH4NN3L</div></div><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(50/50)</span></div></div>
                                     <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30"><p class="font-medium mb-1 text-slate-300">3. FINAŁOWE POŁĄCZENIE</p><div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/50 rounded-md text-indigo-100">Połączenie Hosta</div><div class="text-slate-400 font-thin text-xl flow-arrow">+</div><div class="p-2 bg-amber-500/50 rounded-md text-amber-100">Połączenie Dawcy</div></div><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(65% Host / 35% Dawca)</span></div><div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2">Finałowy Dwujęzyczny CLIP</div></div>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4">Wybór VAE dla Wierności</h4>
                                 <p class="text-sm text-slate-400 mb-6">Łączenie VAE z różnych rodzin jest bardzo ryzykowne. Aby zapewnić maksymalną wierność kolorów i zapobiec artefaktom, nie łączymy ich. Oryginalny VAE hosta jest najbezpieczniejszym wyborem.</p>
                                 <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                     <p class="font-semibold text-indigo-200">Główna Rekomendacja</p>
                                     <p class="text-indigo-300">Użyj VAE wbudowanego w `Animij [Illustrious] V5.0`.</p>
                                     <p class="text-xs mt-2 text-indigo-400">Zapewnia to, że ostateczny obraz jest dekodowany przez VAE idealnie dopasowany do podstawowej architektury hosta.</p>
                                 </div>
                             </div>
                         </div>
                     </div>
                </section>
            </div>

            <div id="pony-content" class="hidden">
                <section id="pony-blueprints" class="mb-24 scroll-mt-20">
                     <h2 class="text-3xl font-bold text-slate-100 mb-2">Schemat: Strategia "Czystej Krwi PONY"</h2>
                     <p class="text-slate-400 mb-10 max-w-4xl">Ta strategia pozostaje w obrębie architektonicznie spójnej rodziny "Pony", zapewniając wysoką kompatybilność i stabilność. Używa `JANKU` dla solidnej anatomii i `NEW ERA V5` dla tematyki, łącząc je z malarskimi modelami `Graycolor` i `SinGlo`, aby stworzyć dopracowany, spójny i gotowy do wektoryzacji wynik.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">JANKU V4.0</h3><p class="text-sm font-medium text-indigo-400 mb-2">Host / Baza Strukturalna</p><p class="text-sm text-slate-400 flex-grow">Wszechstronny model z rodziny `NoobAI`, który zapewni podstawową, solidną anatomię i podatne podłoże dla mrocznych motywów.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">NEW ERA V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2">Baza Tematyczna</p><p class="text-sm text-slate-400 flex-grow">Model o silnym stylu, który zostanie połączony z lepszą anatomią JANKU, aby stworzyć bazę "Dark Anime".</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor SemiRealIllustMix</h3><p class="text-sm font-medium text-amber-400 mb-2">Fundament Stylu Malarskiego</p><p class="text-sm text-slate-400 flex-grow">Model z rodziny `Illustrious`, który zapewnia półrealistyczną, malarską bazę dla ostatecznego wykończenia.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">SinGlo V2.0</h3><p class="text-sm font-medium text-amber-400 mb-2">Dawca Detali Tekstur</p><p class="text-sm text-slate-400 flex-grow">Model z rodziny `Illustrious` o unikalnym, ostrym stylu, który doda złożoności tekstur.</p></div>
                    </div>
                </section>
                <section id="pony-recipes" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2">Przepis i Implementacja: Czysta Krew PONY</h2>
                    <div class="card p-6 md:p-8 mb-12">
                        <h3 class="text-xl font-bold text-slate-100 mb-4">Wieloetapowe Łączenie Bloków</h3>
                        <p class="text-sm text-slate-400 mb-6">To podejście wykorzystuje sekwencję łączeń do budowania ostatecznego modelu warstwa po warstwie. Wybierz etap, aby zobaczyć jego przepis. Wykres zaktualizuje się, aby pokazać wagi bloków. Najedź kursorem na dowolny blok, aby uzyskać szczegółowe uzasadnienie.</p>
                        <div class="flex justify-center flex-wrap gap-4 mb-6">
                            <button id="recipe-pony-stage1" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium">Etap 1: Baza "Dark Anime"</button>
                            <button id="recipe-pony-stage2" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Etap 2: "Most Malarski"</button>
                            <button id="recipe-pony-stage3" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Etap 3: Finałowa Fuzja</button>
                        </div>
                        <div class="chart-container"><canvas id="ponyChart"></canvas></div>
                        <div id="pony-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]">Wybierz przepis i najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie jego wagi.</div>
                    </div>
                     <div class="card p-8">
                         <h3 class="text-xl font-bold text-slate-100 mb-4">Montaż: Wersja "Czystej Krwi PONY"</h3>
                         <p class="text-sm text-slate-400 mb-6">Nawet w obrębie rodziny Pony, gałęzie `NoobAI` i `Illustrious` mają różne "słowniki". Sekwencyjne łączenie CLIP jest nadal zalecane dla maksymalnej kontroli i zrozumienia promptów.</p>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4">Tworzenie Spójnego CLIP</h4>
                                 <p class="text-sm text-slate-400 mb-4">To sekwencyjne łączenie zapewnia, że ostateczny CLIP rozumie prompty związane zarówno z bazą `NoobAI`, jak i warstwą stylu `Illustrious`.</p>
                                 <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                     <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20"><p class="font-medium mb-1 text-indigo-300">1. `NoobAI` CLIP</p><div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">JANKU</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">NEW ERA</div></div><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(50/50)</span></div></div>
                                     <div class="p-2 border border-amber-500/50 rounded-lg bg-amber-900/20"><p class="font-medium mb-1 text-amber-300">2. `Illustrious` CLIP</p><div class="flex justify-around items-center"><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">Graycolor</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">SinGlo</div></div><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(50/50)</span></div></div>
                                     <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30"><p class="font-medium mb-1 text-slate-300">3. FINAŁOWE POŁĄCZENIE</p><div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/50 rounded-md text-indigo-100">Połączenie `NoobAI`</div><div class="text-slate-400 font-thin text-xl flow-arrow">+</div><div class="p-2 bg-amber-500/50 rounded-md text-amber-100">Połączenie `Illustrious`</div></div><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(70% NoobAI / 30% Illustrious)</span></div><div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2">Finałowy Spójny CLIP</div></div>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4">Wybór VAE dla Wierności</h4>
                                 <p class="text-sm text-slate-400 mb-6">Chociaż wszystkie modele pochodzą z rodziny Pony, użycie VAE z ostatecznego Głównego Hosta (`JANKU`) jest najbezpieczniejszym wyborem dla dokładności kolorów.</p>
                                 <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                     <p class="font-semibold text-indigo-200">Główna Rekomendacja</p>
                                     <p class="text-indigo-300">Użyj VAE wbudowanego w `JANKU V4.0`.</p>
                                     <p class="text-xs mt-2 text-indigo-400">Zapewnia to, że ostateczny obraz jest dekodowany przez VAE dopasowany do bazy strukturalnej.</p>
                                 </div>
                             </div>
                         </div>
                     </div>
                </section>
            </div>
            
            <div id="hybrid-content" class="hidden">
                <section id="hybrid-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2">Schemat: Strategia "Hybrydowego Łatania"</h2>
                    <p class="text-slate-400 mb-10 max-w-4xl">Ta zaawansowana strategia tworzy bazę z rodziny Pony, a następnie używa DARE-TIES do "łatania" jej słabości (np. anatomii) modelem SDXL. To złożone, ale potężne podejście łączy stabilność Pony z siłą SDXL.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">JANKU V4.0</h3><p class="text-sm font-medium text-indigo-400 mb-2">Baza Strukturalna Pony</p><p class="text-sm text-slate-400 flex-grow">Tworzy fundamenty anatomiczne bazy Pony.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">NEW ERA V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2">Baza Tematyczna Pony</p><p class="text-sm text-slate-400 flex-grow">Wnosi do bazy Pony estetykę retro anime.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor</h3><p class="text-sm font-medium text-amber-400 mb-2">Baza Malarska Pony</p><p class="text-sm text-slate-400 flex-grow">Wprowadza jakość malarską.</p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">SinGlo V2.0</h3><p class="text-sm font-medium text-amber-400 mb-2">Dawca Tekstur Pony</p><p class="text-sm text-slate-400 flex-grow">Dodaje ostre detale tekstur.</p></div>
                        <div class="card p-6 flex flex-col ring-2 ring-red-500/50"><h3 class="font-bold text-lg text-slate-100">Boomer Art (SDXL)</h3><p class="text-sm font-medium text-red-400 mb-2">Łatka Anatomiczna</p><p class="text-sm text-slate-400 flex-grow">Model SDXL używany do chirurgicznego korygowania wad w bazie Pony.</p></div>
                    </div>
                </section>
                <section id="hybrid-recipes" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2">Przepis i Implementacja: Hybrydowe Łatanie</h2>
                    <div class="card p-6 md:p-8 mb-12">
                        <h3 class="text-xl font-bold text-slate-100 mb-4">Czteroetapowy Przepis Hybrydowy</h3>
                        <p class="text-sm text-slate-400 mb-6">Ten przepis obejmuje łączenie bloków, chirurgiczną iniekcję DARE-TIES i ostateczną fuzję. Wybierz etap, aby zobaczyć jego przepis. Etap 3 to proces DARE-TIES i zamiast wykresu pokaże parametry iniekcji.</p>
                        <div class="flex justify-center flex-wrap gap-4 mb-6">
                            <button id="recipe-hybrid-stage1" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium">Etap 1: Baza Dark Anime</button>
                            <button id="recipe-hybrid-stage2" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Etap 2: Most Malarski</button>
                            <button id="recipe-hybrid-stage3" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Etap 3: Łatka Anatomiczna</button>
                            <button id="recipe-hybrid-stage4" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium">Etap 4: Finałowa Fuzja</button>
                        </div>
                        <div id="hybrid-recipe-explanation" class="mb-6" style="display: none;"></div>
                        <div class="chart-container"><canvas id="hybridChart"></canvas></div>
                        <div id="hybrid-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]">Wybierz przepis i najedź kursorem na blok, aby zobaczyć uzasadnienie.</div>
                    </div>
                     <div class="card p-8">
                         <h3 class="text-xl font-bold text-slate-100 mb-4">Montaż: Wersja Hybrydowa</h3>
                         <p class="text-sm text-slate-400 mb-6">Łączenie CLIP jest tu najbardziej złożone, wymagając trójstronnego połączenia w celu włączenia słownictwa wszystkich modeli. Tworzy to "trójjęzyczny" CLIP, który rozumie prompty związane ze wszystkimi modelami rodzicielskimi.</p>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4">Tworzenie "Trójjęzycznego" CLIP</h4>
                                 <p class="text-sm text-slate-400 mb-4">Tworzymy trzy grupy słownictwa, a następnie wykonujemy ostateczne ważone łączenie, aby zrównoważyć ich wpływ, zapewniając, że baza Pony pozostaje dominująca.</p>
                                 <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                     <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20"><p class="font-medium mb-1 text-indigo-300">1. `NoobAI` CLIP (JANKU + NEW ERA)</p></div>
                                     <div class="p-2 border border-amber-500/50 rounded-lg bg-amber-900/20"><p class="font-medium mb-1 text-amber-300">2. `Illustrious` CLIP (Graycolor + SinGlo)</p></div>
                                     <div class="p-2 border border-red-500/50 rounded-lg bg-red-900/20"><p class="font-medium mb-1 text-red-300">3. `SDXL` CLIP (Boomer Art)</p></div>
                                     <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30"><p class="font-medium mb-1 text-slate-300">4. FINAŁOWE POŁĄCZENIE</p><div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal">(60% NoobAI / 25% Illustrious / 15% SDXL)</span></div><div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2">Finałowy Trójjęzyczny CLIP</div></div>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4">Wybór VAE dla Wierności</h4>
                                 <p class="text-sm text-slate-400 mb-6">VAE z głównego hosta strukturalnego, `JANKU V4.0`, pozostaje najbezpieczniejszym wyborem do utrzymania spójności kolorów pomimo złożonych łączeń.</p>
                                 <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                     <p class="font-semibold text-indigo-200">Główna Rekomendacja</p>
                                     <p class="text-indigo-300">Użyj VAE wbudowanego w `JANKU V4.0`.</p>
                                     <p class="text-xs mt-2 text-indigo-400">Ponieważ ostateczny model jest w przeważającej mierze oparty na Pony, użycie VAE Pony jest kluczowe, aby zapobiec artefaktom.</p>
                                 </div>
                             </div>
                         </div>
                     </div>
                </section>
            </div>

            <section id="analysis" class="mb-24 scroll-mt-20">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Analiza Porównawcza i Rekomendacja</h2>
                <p class="text-slate-400 mb-10 max-w-4xl">Wybór strategii łączenia wiąże się z kompromisem między stabilnością, zasięgiem stylistycznym a złożonością. Ta sekcja podsumowuje kluczowe różnice, aby pomóc Ci zdecydować, która wersja najlepiej odpowiada Twoim potrzebom.</p>
                <div class="overflow-x-auto card p-2 md:p-6">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-800/50 text-slate-200">
                            <tr>
                                <th class="p-3 font-semibold">Czynnik</th>
                                <th class="p-3 font-semibold">"Przeszczep SDXL"</th>
                                <th class="p-3 font-semibold">"Czysta Krew PONY"</th>
                                <th class="p-3 font-semibold">"Hybrydowe Łatanie"</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700">
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200">Główna Filozofia</td>
                                <td class="p-3">Chirurgiczne Wstrzykiwanie Umiejętności (DARE-TIES)</td>
                                <td class="p-3">Harmonia Architektoniczna (Łączenie Bloków)</td>
                                <td class="p-3">Łączenie Bloków + Chirurgiczne Łatanie (DARE-TIES)</td>
                            </tr>
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200">Stabilność</td>
                                <td class="p-3">Dobra, ale wyższe ryzyko artefaktów z powodu łączenia międzyarchitektonicznego.</td>
                                <td class="p-3">Doskonała. Łączenie kompatybilnych modeli jest bardziej stabilne.</td>
                                <td class="p-3">Bardzo Dobra. Głównie stabilna, ale wstrzyknięcie SDXL wprowadza mały czynnik ryzyka.</td>
                            </tr>
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200">Zasięg Stylistyczny</td>
                                <td class="p-3">Najszerszy. Może włączać style z zupełnie różnych rodzin.</td>
                                <td class="p-3">Skoncentrowany. Doskonale łączy style w ekosystemie Pony, dając wyrafinowany wynik.</td>
                                <td class="p-3">Unikalny. Tworzy nowatorską mieszankę przez "łatanie" bazy Pony cechami SDXL.</td>
                            </tr>
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200">Złożoność</td>
                                <td class="p-3">Wysoka. Wymaga konfiguracji DARE-TIES.</td>
                                <td class="p-3">Średnia. Proste wieloetapowe łączenie bloków.</td>
                                <td class="p-3">Bardzo Wysoka. Łączy obie techniki w czteroetapowym procesie.</td>
                            </tr>
                             <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200">Najlepsze dla...</td>
                                <td class="p-3">Osiągnięcia bardzo specyficznej, unikalnej mieszanki odmiennych estetyk (np. retro anime + styl Frazetty).</td>
                                <td class="p-3">Tworzenia bardzo dopracowanego i stabilnego modelu do konsekwentnego generowania zasobów z czystymi liniami.</td>
                                <td class="p-3">Eksperymentalnego łączenia w celu naprawy wad (np. słabej anatomii) w modelu bazowym przy użyciu dawcy z innej rodziny.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                 <div class="mt-8 p-6 bg-indigo-900/30 border border-indigo-500/50 rounded-lg">
                    <h3 class="font-bold text-lg text-indigo-200 mb-2">Ostateczna Rekomendacja</h3>
                    <p class="text-indigo-300">Dla celu tworzenia **spójnych zasobów do gier** z **czystymi liniami do wektoryzacji**, wersja **"Czystej Krwi PONY" jest najlepszym i najbezpieczniejszym wyborem.**</p>
                    <p class="mt-2 text-sm text-indigo-400">Jej harmonia architektoniczna zapewnia najwyższą stabilność i przewidywalność. **"Hybrydowe Łatanie"** to potężna alternatywa dla zaawansowanych użytkowników, ale jej złożoność czyni ją bardziej eksperymentalną. Wersja **"Przeszczepu SDXL"** jest najlepsza, gdy pożądanej estetyki nie można osiągnąć w ramach jednej rodziny.</p>
                </div>
            </section>
            
            <section id="glossary" class="mb-24 scroll-mt-20">
                 <h2 class="text-3xl font-bold text-slate-100 mb-2">Glosariusz Terminów</h2>
                 <p class="text-slate-400 mb-10 max-w-4xl">Zrozumienie terminologii jest kluczem do udanego łączenia modeli. Oto definicje podstawowych pojęć omówionych w tym przewodniku.</p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-slate-200 mb-2">Łączenie z wagami bloków</h3>
                        <p class="text-sm text-slate-400">Technika, w której różne warstwy (bloki) dwóch sieci neuronowych są łączone z różnymi wagami. Wczesne warstwy (IN) kontrolują kompozycję i anatomię, środkowe (M) kontrolują koncepcje, a późne (OUT) kontrolują detale i styl. Jest to metoda odrębna od DARE-TIES.</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-slate-200 mb-2">DARE-TIES</h3>
                        <p class="text-sm text-slate-400">Zaawansowany algorytm do chirurgicznego wstrzykiwania umiejętności, zaimplementowany w `ComfyUI-DareMerge`. Składa się z dwóch głównych mechanizmów:</p>
                        <ul class="text-sm text-slate-400 mt-2 list-disc list-inside space-y-1">
                            <li><strong>DARE (`density`):</strong> Określa, jaki procent (`density`) wektorów zmian jest **zachowywany** podczas losowego przerzedzania. Jest to odwrotność `drop_rate` z publikacji (`density = 1 - drop_rate`). Wartość `0.2` oznacza zachowanie 20% i odrzucenie 80%.</li>
                            <li><strong>TIES (`ties_mode`):</strong> Rozwiązuje konflikty między modelami. Kluczowym krokiem jest "Przycinanie" (Trim), które w `ComfyUI-DareMerge` realizuje się za pomocą węzła `Magnitude Masker` (np. z `threshold_type: quantile`), aby zachować tylko najważniejsze zmiany przed właściwym łączeniem.</li>
                        </ul>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-slate-200 mb-2">UNet</h3>
                        <p class="text-sm text-slate-400">Podstawowa architektura sieci neuronowej w modelach dyfuzyjnych, która generuje obraz. Składa się z bloków wejściowych (IN), środkowych (M) i wyjściowych (OUT).</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-slate-200 mb-2">CLIP</h3>
                        <p class="text-sm text-slate-400">Komponent, który rozumie prompty tekstowe. Tłumaczy słowa na matematyczną reprezentację, której UNet używa do kierowania generowaniem obrazu. Łączenie CLIP-ów jest kluczowe, aby model rozumiał połączone "słownictwo" swoich rodziców.</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-slate-200 mb-2">VAE (Variational Autoencoder)</h3>
                        <p class="text-sm text-slate-400">Mała sieć neuronowa, która tłumaczy dane wyjściowe UNet na rzeczywiste piksele. Dobry VAE zapewnia żywe kolory. Najbezpieczniej jest używać VAE z głównego modelu bazowego.</p>
                    </div>
                     <div class="card p-6">
                         <h3 class="font-bold text-lg text-slate-200 mb-2">Rodzina Architektoniczna</h3>
                         <p class="text-sm text-slate-400">Grupa modeli o zgodnych strukturach wewnętrznych (np. Pony, SDXL 1.0). Łączenie w obrębie tej samej rodziny jest generalnie bardziej stabilne niż łączenie między rodzinami, które często wymaga DARE-TIES do rozwiązania niezgodności.</p>
                     </div>
                </div>
            </section>

        </main>
        
        <footer class="bg-slate-900/50 mt-24 border-t border-slate-700">
            <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
                <p>Skonsolidowany Interaktywny Przewodnik po Zaawansowanym Łączeniu Modeli</p>
            </div>
        </footer>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    function initShaderBackground() {
        try {
            const canvas = document.getElementById('shader-canvas');
            const gl = canvas.getContext('webgl');
            if (!gl) {
                console.error("WebGL nie jest wspierany, tło nie będzie animowane.");
                return;
            }

            const vertexShaderSource = `
                attribute vec2 a_position;
                void main() {
                    gl_Position = vec4(a_position, 0.0, 1.0);
                }
            `;

            const fragmentShaderSource = `
                precision mediump float;
                uniform vec2 u_resolution;
                uniform float u_time;

                float random (vec2 st) {
                    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
                }

                float noise (vec2 st) {
                    vec2 i = floor(st);
                    vec2 f = fract(st);
                    vec2 u = f*f*(3.0-2.0*f);
                    return mix( mix( random( i + vec2(0.0,0.0) ),
                                   random( i + vec2(1.0,0.0) ), u.x),
                                mix( random( i + vec2(0.0,1.0) ),
                                   random( i + vec2(1.0,1.0) ), u.x), u.y);
                }

                float fbm (vec2 st) {
                    float value = 0.0;
                    float amplitude = .5;
                    for (int i = 0; i < 6; i++) {
                        value += amplitude * noise(st);
                        st *= 2.;
                        amplitude *= .5;
                    }
                    return value;
                }

                void main() {
                    vec2 st = gl_FragCoord.xy/u_resolution.xy;
                    st.x *= u_resolution.x/u_resolution.y;
                    vec3 color = vec3(0.0);
                    vec2 q = vec2(fbm(st + 0.00*u_time), fbm(st + vec2(1.0)));
                    vec2 r = vec2(fbm(st + 1.0*q + vec2(1.7,9.2) + 0.15*u_time), fbm(st + 1.0*q + vec2(8.3,2.8) + 0.126*u_time));
                    float f = fbm(st+r);
                    color = mix(vec3(0.1,0.1,0.2), vec3(0.3,0.3,0.6), clamp((f*f)*4.0,0.0,1.0));
                    color = mix(color, vec3(0.2,0.1,0.4), clamp(length(q),0.0,1.0));
                    color = mix(color, vec3(0.4,0.5,0.7), clamp(length(r.x),0.0,1.0));
                    float star_val = random(gl_FragCoord.xy);
                    if (star_val > 0.998) {
                        float star_intensity = (star_val - 0.998) / (1.0 - 0.998);
                        color += vec3(star_intensity * (0.8 + 0.2 * sin(u_time * 2.0 + gl_FragCoord.y)));
                    }
                    gl_FragColor = vec4( (f*f*f+.6*f*f+.5*f)*color, 1.);
                }
            `;

            function createShader(gl, type, source) {
                const shader = gl.createShader(type);
                gl.shaderSource(shader, source);
                gl.compileShader(shader);
                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    console.error('Wystąpił błąd podczas kompilacji shaderów: ' + gl.getShaderInfoLog(shader));
                    gl.deleteShader(shader);
                    return null;
                }
                return shader;
            }

            const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);

            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error('Nie można zainicjować programu shadera: ' + gl.getProgramInfoLog(program));
                return;
            }

            gl.useProgram(program);
            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            const positions = [-1, 1, 1, 1, -1, -1, 1, -1];
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);
            const positionAttributeLocation = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(positionAttributeLocation);
            gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);
            const resolutionUniformLocation = gl.getUniformLocation(program, "u_resolution");
            const timeUniformLocation = gl.getUniformLocation(program, "u_time");

            function render(time) {
                time *= 0.0005; 
                canvas.width = gl.canvas.clientWidth;
                canvas.height = gl.canvas.clientHeight;
                gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
                gl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);
                gl.uniform1f(timeUniformLocation, time);
                gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
        } catch (e) {
            console.error("Błąd podczas inicjalizacji tła WebGL:", e);
        }
    }

    initShaderBackground();

    const blockLabels = ['IN00', 'IN01', 'IN02', 'IN03', 'IN04', 'IN05', 'IN06', 'IN07', 'IN08', 'IN09', 'IN10', 'IN11', 'M00', 'OUT00', 'OUT01', 'OUT02', 'OUT03', 'OUT04', 'OUT05', 'OUT06', 'OUT07', 'OUT08', 'OUT09', 'OUT10', 'OUT11'];
    
    const sdxlData = {
        labels: blockLabels,
        recipes: {
            balanced: {
                explanation: "<strong>Przepis A: Zrównoważony (Domyślny)</strong><br>Zalecany przepis, starannie obliczony w celu zrównoważenia integralności Animij z wkładem Graycolor. Faworyzuje Animij we wczesnych blokach, płynnie przechodzi w kierunku Graycolor w środku, a następnie wraca do Animij w końcowych blokach dla czystych linii.",
                weights: [0.10, 0.12, 0.15, 0.18, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.52, 0.55, 0.60, 0.58, 0.55, 0.52, 0.50, 0.47, 0.42, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10],
                justifications: ['IN00 @ 0.10: Dominacja Hosta (Animij @ 90%) dla podstawowej kompozycji i stylu lineartu.','IN01 @ 0.12: Utrzymanie silnej dominacji Hosta (88%) dla zablokowania struktury anatomicznej.','IN02 @ 0.15: Host (85%) wciąż prowadzi, definiując formę podmiotu.','IN03 @ 0.18: Subtelne łagodzenie czysto animowej estetyki (Host @ 82%).','IN04 @ 0.25: Wprowadzenie 25% półrealistycznych właściwości Graycolor do struktury anime.','IN05 @ 0.30: Wpływ Graycolor (30%) rośnie, wpływając na cechy średniego poziomu.','IN06 @ 0.35: Mieszanka dąży do równowagi stylów (Host @ 65%).','IN07 @ 0.40: Zbliżając się do środkowego bloku, modele zbliżają się do równowagi.','IN08 @ 0.45: Host utrzymuje niewielką przewagę (55%) tuż przed wąskim gardłem.','IN09 @ 0.50: Dokładny podział 50/50, aby stworzyć zrównoważone przejście.','IN10 @ 0.52: Graycolor po raz pierwszy przejmuje niewielką przewagę (52%), definiując koncepcję.','IN11 @ 0.55: Wzmacnianie dominacji koncepcyjnej Graycolor (55%).','M00 @ 0.60: Graycolor otrzymuje najsilniejszą wagę (60%) w rdzeniu, osadzając styl malarski.','OUT00 @ 0.58: Graycolor pozostaje dominujący (58%), propagując swój styl na zewnątrz.','OUT01 @ 0.55: Równowaga zaczyna się przesuwać z powrotem w kierunku hosta (45%).','OUT02 @ 0.52: Graycolor wciąż ma niewielką większość (52%), wpływając na wczesne detale.','OUT03 @ 0.50: Drugi idealny podział 50/50 dla detali i tekstury.','OUT04 @ 0.47: Host odzyskuje prowadzenie (53%), stosując swoją czystą interpretację.','OUT05 @ 0.42: Nacisk na hosta rośnie (58%), koncentrując się na czystych liniach.','OUT06 @ 0.35: Silniejsza waga dla hosta (65%) dla drobnych detali.','OUT07 @ 0.30: Host dominuje (70%), udoskonalając tekstury.','OUT08 @ 0.25: Znacząca waga dla hosta (75%) do ostatecznego przejścia.','OUT09 @ 0.20: Silnie faworyzuje hosta (80%) dla detali o wysokiej częstotliwości.','OUT10 @ 0.15: Zdecydowanie faworyzuje hosta (85%), aby zapewnić ostre i czyste linie.','OUT11 @ 0.10: Ostateczna, decydująca waga dla hosta (90%), aby zapewnić czysty i żywy wynik.']
            },
            host_dominant: {
                explanation: "<strong>Przepis B: Z dominacją Hosta</strong><br>Daje większą wagę Animij we wszystkich blokach. Rezultatem będzie model o wyjątkowo silnej anatomii i spójności, ściśle trzymający się stylu retro anime. Wpływ dawców będzie bardziej subtelny.",
                weights: [0.05, 0.08, 0.10, 0.12, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.12, 0.10, 0.08, 0.05],
                justifications: ['(Z dominacją Hosta) IN00 @ 0.05: Maksymalna integralność strukturalna Hosta (95%).','(Z dominacją Hosta) IN01 @ 0.08: Przytłaczająca kontrola Hosta (92%) nad anatomią.','(Z dominacją Hosta) IN02 @ 0.10: Czysta forma z Animij (90%).','(Z dominacją Hosta) IN03 @ 0.12: Minimalny wpływ stylu (Host @ 88%).','(Z dominacją Hosta) IN04 @ 0.15: Priorytet dla struktury Hosta (85%).','(Z dominacją Hosta) IN05 @ 0.20: Styl bliski Animij (80%).','(Z dominacją Hosta) IN06 @ 0.25: Stosunek 3:1 na korzyść struktury Hosta.','(Z dominacją Hosta) IN07 @ 0.30: Silna kontrola hosta (70%).','(Z dominacją Hosta) IN08 @ 0.35: Ostatnie słowo dla Animij (65%) przed rdzeniem.','(Z dominacją Hosta) IN09 @ 0.40: Mieszanka faworyzująca hosta (60%).','(Z dominacją Hosta) IN10 @ 0.45: Niewielka przewaga hosta (55%) w koncepcji.','(Z dominacją Hosta) IN11 @ 0.50: Równy podział tuż przed rdzeniem.','(Z dominacją Hosta) M00 @ 0.55: Nawet w rdzeniu, silna obecność hosta (45%).','(Z dominacją Hosta) OUT00 @ 0.50: Rozpoczęcie rekonstrukcji z równym podziałem.','(Z dominacją Hosta) OUT01 @ 0.45: Natychmiastowe ponowne potwierdzenie kontroli hosta (55%).','(Z dominacją Hosta) OUT02 @ 0.40: Wzmocnienie kontroli hosta (60%) nad wczesnymi detalami.','(Z dominacją Hosta) OUT03 @ 0.35: Priorytet dla logiki hosta (65%).','(Z dominacją Hosta) OUT04 @ 0.30: Silna kontrola hosta (70%) nad rekonstrukcją.','(Z dominacją Hosta) OUT05 @ 0.25: Stosunek 3:1 dla linii hosta (75%).','(Z dominacją Hosta) OUT06 @ 0.20: Faworyzowanie hosta (80%) dla drobnych detali.','(Z dominacją Hosta) OUT07 @ 0.15: Tekstury głównie od hosta (85%).','(Z dominacją Hosta) OUT08 @ 0.12: Polerowanie strukturalne przez hosta (88%).','(Z dominacją Hosta) OUT09 @ 0.10: Maksymalna klarowność od hosta (90%).','(Z dominacją Hosta) OUT10 @ 0.08: Wyjątkowo czyste linie (Host @ 92%).','(Z dominacją Hosta) OUT11 @ 0.05: Wynik w stylu czystego Animij (95%).']
            },
            donor_receptive: {
                explanation: "<strong>Przepis C: Podatny na Dawcę</strong><br>Daje większą wagę Graycolor. Tworzy to hosta bardziej elastycznego stylistycznie i podatnego na dawców. Kompromisem jest potencjalne zmniejszenie stabilności kompozycyjnej.",
                weights: [0.15, 0.18, 0.20, 0.22, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.58, 0.60, 0.65, 0.62, 0.60, 0.58, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15],
                justifications: ['(Podatny na Dawcę) IN00 @ 0.15: Łagodniejszy start (Host @ 85%).','(Podatny na Dawcę) IN01 @ 0.18: Wczesne osłabienie kontroli hosta (82%).','(Podatny na Dawcę) IN02 @ 0.20: Silny wczesny głos dla Graycolor (20%).','(Podatny na Dawcę) IN03 @ 0.22: Priorytet dla mieszania stylów (Host @ 78%).','(Podatny na Dawcę) IN04 @ 0.30: Silne pchnięcie w kierunku stylu Graycolor (30%).','(Podatny na Dawcę) IN05 @ 0.35: Znaczący wpływ Graycolor (35%).','(Podatny na Dawcę) IN06 @ 0.40: Podział 60/40 na korzyść Hosta.','(Podatny na Dawcę) IN07 @ 0.45: Niemal równy podział (Host @ 55%).','(Podatny na Dawcę) IN08 @ 0.50: Równy podział dla fuzji.','(Podatny na Dawcę) IN09 @ 0.55: Graycolor prowadzi (55%) do rdzenia.','(Podatny na Dawcę) IN10 @ 0.58: Wzmocnienie wpływu Graycolor (58%).','(Podatny na Dawcę) IN11 @ 0.60: Silna waga dla Graycolor (60%).','(Podatny na Dawcę) M00 @ 0.65: Decydująca waga dla Graycolor (65%) w rdzeniu.','(Podatny na Dawcę) OUT00 @ 0.62: Silny wpływ Graycolor (62%) w rekonstrukcji.','(Podatny na Dawcę) OUT01 @ 0.60: Utrzymanie wagi dla Graycolor (60%).','(Podatny na Dawcę) OUT02 @ 0.58: Priorytet dla stylu malarskiego (58%).','(Podatny na Dawcę) OUT03 @ 0.55: Podział faworyzujący dawcę (55%).','(Podatny na Dawcę) OUT04 @ 0.50: Równy podział dla cech.','(Podatny na Dawcę) OUT05 @ 0.45: Powrót do Animij (55%) dla linii.','(Podatny na Dawcę) OUT06 @ 0.40: Podział 60/40 dla hosta.','(Podatny na Dawcę) OUT07 @ 0.35: Wzmocnienie kontroli hosta (65%).','(Podatny na Dawcę) OUT08 @ 0.30: Podział 70/30 dla polerowania.','(Podatny na Dawcę) OUT09 @ 0.25: Silna obecność hosta (75%) dla klarowności.','(Podatny na Dawcę) OUT10 @ 0.20: Linie głównie od hosta (80%).','(Podatny na Dawcę) OUT11 @ 0.15: Silna waga hosta (85%) dla czystego wykończenia.']
            }
        }
    };

    const ponyData = {
        labels: blockLabels,
        recipes: {
            stage1: { model1: 'JANKU', model2: 'NEW ERA V5', color1: '#6366F1', color2: '#312E81', weights: [0.10,0.12,0.15,0.18,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.52,0.55,0.50,0.45,0.40,0.35,0.30,0.25,0.20,0.18,0.15,0.12,0.10,0.08], justifications: ['Etap 1 (JANKU/NEW ERA V5) - IN00 @ 0.10: Faworyzuje anatomię JANKU (90%) dla silnych fundamentów.','Etap 1 - IN01 @ 0.12: Utrwalenie kompozycji i póz (JANKU @ 88%).','Etap 1 - IN02 @ 0.15: Wprowadzenie stylu tematycznego NEW ERA (15%).','Etap 1 - IN03 @ 0.18: Stopniowe zwiększanie wpływu NEW ERA (18%).','Etap 1 - IN04 @ 0.20: Stosunek 4:1 zapewnia dominację anatomii JANKU (80%).','Etap 1 - IN05 @ 0.25: Danie NEW ERA 25% wpływu na cechy.','Etap 1 - IN06 @ 0.30: Zrównoważenie stylu NEW ERA (30%) ze spójnością JANKU.','Etap 1 - IN07 @ 0.35: Zbliżanie się do równej mieszanki.','Etap 1 - IN08 @ 0.40: Danie NEW ERA 40% wpływu przed rdzeniem.','Etap 1 - IN09 @ 0.45: Lekka przewaga JANKU (55%) dla stabilności.','Etap 1 - IN10 @ 0.50: Zrównoważony podział dla stabilnego przejścia.','Etap 1 - IN11 @ 0.52: Lekka przewaga NEW ERA (52%) dla koncepcji.','Etap 1 - M00 @ 0.55: Większość 55% dla NEW ERA w rdzeniu dla osadzenia motywów.','Etap 1 - OUT00 @ 0.50: Zrównoważony podział dla nowatorskiej fuzji.','Etap 1 - OUT01 @ 0.45: Ponowne potwierdzenie kontroli strukturalnej JANKU (55%).','Etap 1 - OUT02 @ 0.40: Zwiększenie wpływu JANKU (60%) dla spójnych detali.','Etap 1 - OUT03 @ 0.35: Priorytet dla logiki JANKU (65%).','Etap 1 - OUT04 @ 0.30: Podział 70/30 dla zgodności detali (JANKU @ 70%).','Etap 1 - OUT05 @ 0.25: Stosunek 3:1 na korzyść JANKU (75%) dla czystych linii.','Etap 1 - OUT06 @ 0.20: Faworyzowanie JANKU (80%) dla drobnych detali.','Etap 1 - OUT07 @ 0.18: Silna przewaga JANKU (82%) dla dopracowania tekstur.','Etap 1 - OUT08 @ 0.15: Zapewnienie spójnej kompozycji (JANKU @ 85%).','Etap 1 - OUT09 @ 0.12: Faworyzowanie JANKU (88%) dla ostrości.','Etap 1 - OUT10 @ 0.10: Waga 90% dla JANKU dla ostrych, czystych linii.','Etap 1 - OUT11 @ 0.08: Ostateczna waga dla JANKU (92%) dla czystego wyniku.']}, 
            stage2: { model1: 'Graycolor', model2: 'SinGlo', color1: '#F59E0B', color2: '#78350F', weights: [0.15, 0.15, 0.20, 0.20, 0.25, 0.30, 0.30, 0.35, 0.35, 0.40, 0.40, 0.40, 0.45, 0.40, 0.40, 0.35, 0.35, 0.30, 0.30, 0.25, 0.25, 0.20, 0.20, 0.15, 0.15], justifications: ['Etap 2 (Graycolor/SinGlo) - IN00 @ 0.15: Ustanowienie półrealizmu Graycolor (85%) jako bazy.','Etap 2 - IN01 @ 0.15: Utrzymanie dominacji Graycolor (85%) dla spójności.','Etap 2 - IN02 @ 0.20: Wprowadzanie tekstur SinGlo (20%).','Etap 2 - IN03 @ 0.20: Kontynuacja mieszania stylu (SinGlo @ 20%).','Etap 2 - IN04 @ 0.25: Zwiększenie wpływu SinGlo (25%).','Etap 2 - IN05 @ 0.30: Danie SinGlo (30%) głosu w detalach.','Etap 2 - IN06 @ 0.30: Danie SinGlo (30%) głosu w detalach.','Etap 2 - IN07 @ 0.35: Zbliżanie się do równej mieszanki tekstur.','Etap 2 - IN08 @ 0.35: Zbliżanie się do równej mieszanki tekstur.','Etap 2 - IN09 @ 0.40: Znaczący wpływ SinGlo (40%).','Etap 2 - IN10 @ 0.40: Znaczący wpływ SinGlo (40%).','Etap 2 - IN11 @ 0.40: Znaczący wpływ SinGlo (40%).','Etap 2 - M00 @ 0.45: Prawie równy podział w rdzeniu.','Etap 2 - OUT00 @ 0.40: Lekka przewaga Graycolor (60%).','Etap 2 - OUT01 @ 0.40: Lekka przewaga Graycolor (60%).','Etap 2 - OUT02 @ 0.35: Faworyzowanie Graycolor (65%) dla stabilności.','Etap 2 - OUT03 @ 0.35: Faworyzowanie Graycolor (65%) dla stabilności.','Etap 2 - OUT04 @ 0.30: Podkreślenie malarskiego charakteru (Graycolor @ 70%).','Etap 2 - OUT05 @ 0.30: Podkreślenie malarskiego charakteru (Graycolor @ 70%).','Etap 2 - OUT06 @ 0.25: Silne faworyzowanie Graycolor (75%).','Etap 2 - OUT07 @ 0.25: Silne faworyzowanie Graycolor (75%).','Etap 2 - OUT08 @ 0.20: Dominacja Graycolor (80%) w detalach.','Etap 2 - OUT09 @ 0.20: Dominacja Graycolor (80%) w detalach.','Etap 2 - OUT10 @ 0.15: Czyste, malarskie wykończenie (Graycolor @ 85%).','Etap 2 - OUT11 @ 0.15: Czyste, malarskie wykończenie (Graycolor @ 85%).']}, 
            stage3: { model1: '"Baza Dark Anime"', model2: '"Most Malarski"', color1: '#1E3A8A', color2: '#78350F', weights: [0.10, 0.10, 0.12, 0.15, 0.18, 0.20, 0.22, 0.25, 0.28, 0.30, 0.32, 0.35, 0.40, 0.38, 0.35, 0.32, 0.30, 0.28, 0.25, 0.22, 0.20, 0.18, 0.15, 0.12, 0.10], justifications: ['Etap 3 (Finał) - IN00 @ 0.10: Faworyzowanie bazy Dark Anime (90%) dla struktury.','Etap 3 - IN01 @ 0.10: Utrzymanie dominacji strukturalnej (Baza @ 90%).','Etap 3 - IN02 @ 0.12: Wprowadzanie malarskiej tekstury (12%).','Etap 3 - IN03 @ 0.15: Zwiększenie wpływu malarskiego (15%).','Etap 3 - IN04 @ 0.18: Więcej stylu malarskiego (18%).','Etap 3 - IN05 @ 0.20: 20% wpływu malarskiego.','Etap 3 - IN06 @ 0.22: Kontynuacja mieszanki.','Etap 3 - IN07 @ 0.25: Podział 75/25 na korzyść Bazy.','Etap 3 - IN08 @ 0.28: Dalsze zwiększanie wpływu.','Etap 3 - IN09 @ 0.30: Podział 70/30.','Etap 3 - IN10 @ 0.32: Większa waga dla stylu.','Etap 3 - IN11 @ 0.35: Silny wpływ malarski (35%).','Etap 3 - M00 @ 0.40: Podział 60/40 w rdzeniu na korzyść Bazy.','Etap 3 - OUT00 @ 0.38: Podobny podział w rekonstrukcji.','Etap 3 - OUT01 @ 0.35: Powrót do bazy Dark Anime (65%).','Etap 3 - OUT02 @ 0.32: Wzmocnienie podstawowego stylu anime (Baza @ 68%).','Etap 3 - OUT03 @ 0.30: Podział 70/30 dla detali.','Etap 3 - OUT04 @ 0.28: Priorytet dla interpretacji bazy (72%).','Etap 3 - OUT05 @ 0.25: Silny podział 75/25 dla linii.','Etap 3 - OUT06 @ 0.22: Zwiększenie dominacji bazy (78%).','Etap 3 - OUT07 @ 0.20: Podział 80/20 dla detali.','Etap 3 - OUT08 @ 0.18: Priorytet dla spójności (Baza @ 82%).','Etap 3 - OUT09 @ 0.15: Faworyzowanie bazy (85%) dla ostrych linii.','Etap 3 - OUT10 @ 0.12: Wynik zdefiniowany przez bazę (88%).','Etap 3 - OUT11 @ 0.10: Czyste wykończenie (Baza @ 90%).']} 
        }
    };
    
    const hybridData = {
        labels: blockLabels,
        recipes: {
            stage1: ponyData.recipes.stage1,
            stage2: ponyData.recipes.stage2,
            stage3: { 
                is_dare: true, 
                explanation: `<strong>Etap 3: Łatka Anatomiczna (DARE-TIES)</strong><br>Krok chirurgiczny. Używamy DARE-TIES do wstrzyknięcia wiedzy anatomicznej z <strong>Boomer Art</strong> do naszej bazy 'Dark Anime', aby naprawić anatomię bez naruszania stylu hosta. Poniżej przedstawiono dokładny, dwuetapowy proces z użyciem węzłów z ComfyUI-DareMerge.
                <div class="dare-panel mt-4">
                    <h4 class="font-bold text-lg text-slate-200 mb-4 text-center">Przeszczep Anatomiczny</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                        <div>
                            <h5 class="text-sm font-semibold text-indigo-300 mb-2">Krok 1: Przycinanie (TIES Trim)</h5>
                            <p class="text-xs text-slate-400 mb-4">Użyj \`Magnitude Masker\`, aby zachować 20% najważniejszych zmian anatomicznych.</p>
                            <p class="text-xs"><strong class="text-slate-300">model_a:</strong> 'Baza Dark Anime'</p>
                            <p class="text-xs"><strong class="text-slate-300">model_b:</strong> sd_xl_base_1.0</p>
                            <p class="text-xs"><strong class="text-slate-300">threshold:</strong> 0.80</p>
                            <p class="text-xs"><strong class="text-slate-300">threshold_type:</strong> quantile</p>
                        </div>
                        <div>
                            <h5 class="text-sm font-semibold text-red-300 mb-2">Krok 2: Łączenie (DARE Merge)</h5>
                            <p class="text-xs text-slate-400 mb-4">Użyj \`Model Merger (DARE)\` z utworzoną maską.</p>
                            <p class="text-xs"><strong class="text-slate-300">model1:</strong> 'Baza Dark Anime'</p>
                            <p class="text-xs"><strong class="text-slate-300">model2:</strong> Boomer Art Model</p>
                            <p class="text-xs"><strong class="text-slate-300">base_model:</strong> sd_xl_base_1.0</p>
                            <p class="text-xs"><strong class="text-slate-300">density:</strong> 0.20</p>
                            <p class="text-xs"><strong class="text-slate-300">ties_mode:</strong> sum</p>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-slate-700">
                        <h5 class="text-sm font-semibold text-slate-300 mb-2">Uzasadnienie</h5>
                        <p class="text-xs text-slate-400">Bardzo agresywne przycinanie (\`threshold: 0.80\`) izoluje tylko 20% najsilniejszych wektorów zmian, które z największym prawdopodobieństwem odpowiadają za fundamentalną wiedzę o anatomii. Niska \`gęstość\` (0.20) zapewnia, że ta "łatka" jest stosowana bardzo precyzyjnie i nie narusza stylu bazy Pony.</p>
                    </div>
                </div>`
            },
            stage4: { model1: '"Baza z łatką"', model2: '"Most Malarski"', color1: '#1E3A8A', color2: '#78350F', weights: [0.08,0.10,0.12,0.15,0.18,0.20,0.22,0.25,0.28,0.30,0.32,0.35,0.40,0.38,0.35,0.32,0.30,0.28,0.25,0.22,0.20,0.18,0.15,0.12,0.08], justifications: ['Etap 4 (Finał) - IN00 @ 0.08: Faworyzowanie załatanej bazy (92%) dla struktury.','Etap 4 - IN01 @ 0.10: Utrzymanie dominacji strukturalnej (Baza @ 90%).','Etap 4 - IN02 @ 0.12: Wprowadzanie malarskiej tekstury (12%).','Etap 4 - IN03 @ 0.15: Zwiększenie wpływu malarskiego (15%).','Etap 4 - IN04 @ 0.18: Więcej stylu malarskiego (18%).','Etap 4 - IN05 @ 0.20: 20% wpływu malarskiego.','Etap 4 - IN06 @ 0.22: Kontynuacja mieszanki.','Etap 4 - IN07 @ 0.25: Podział 75/25 na korzyść Bazy.','Etap 4 - IN08 @ 0.28: Dalsze zwiększanie wpływu.','Etap 4 - IN09 @ 0.30: Podział 70/30.','Etap 4 - IN10 @ 0.32: Większa waga dla stylu.','Etap 4 - IN11 @ 0.35: Silny wpływ malarski (35%).','Etap 4 - M00 @ 0.40: Podział 60/40 w rdzeniu na korzyść Bazy.','Etap 4 - OUT00 @ 0.38: Podobny podział w rekonstrukcji.','Etap 4 - OUT01 @ 0.35: Powrót do bazy z łatką (65%).','Etap 4 - OUT02 @ 0.32: Wzmocnienie stylu anime (Baza @ 68%).','Etap 4 - OUT03 @ 0.30: Podział 70/30 dla detali.','Etap 4 - OUT04 @ 0.28: Priorytet dla interpretacji bazy (72%).','Etap 4 - OUT05 @ 0.25: Silny podział 75/25 dla linii.','Etap 4 - OUT06 @ 0.22: Zwiększenie dominacji bazy (78%).','Etap 4 - OUT07 @ 0.20: Podział 80/20 dla detali.','Etap 4 - OUT08 @ 0.18: Priorytet dla spójności (Baza @ 82%).','Etap 4 - OUT09 @ 0.15: Faworyzowanie bazy (85%) dla ostrych linii.','Etap 4 - OUT10 @ 0.12: Wynik zdefiniowany przez bazę (88%).','Etap 4 - OUT11 @ 0.08: Czyste wykończenie (Baza @ 92%).']}
        }
    };

    let sdxlChartInstance, ponyChartInstance, hybridChartInstance = null;

    const selectSdxlBtn = document.getElementById('select-sdxl');
    const selectPonyBtn = document.getElementById('select-pony');
    const selectHybridBtn = document.getElementById('select-hybrid');
    const sdxlContent = document.getElementById('sdxl-content');
    const ponyContent = document.getElementById('pony-content');
    const hybridContent = document.getElementById('hybrid-content');
    const mainNav = document.getElementById('main-nav');

    function createChart(ctx, onHoverCallback) {
        return new Chart(ctx, {
            type: 'bar',
            options: {
                responsive: true, maintainAspectRatio: false,
                animation: { duration: 1000 },
                plugins: {
                    tooltip: { 
                        mode: 'index', intersect: false, 
                        callbacks: { label: (c) => `${c.dataset.label}: ${(c.parsed.y * 100).toFixed(0)}%` },
                        backgroundColor: 'rgba(15, 23, 42, 0.8)',
                        titleFont: { weight: 'bold'},
                        bodyFont: { size: 12 },
                        borderColor: '#334155',
                        borderWidth: 1,
                    },
                    legend: { position: 'top', labels: { color: '#cbd5e1' } }
                },
                scales: {
                    x: { stacked: true, grid: { display: false }, ticks: { color: '#94a3b8' } },
                    y: { stacked: true, beginAtZero: true, max: 1.0, grid: { color: '#1e293b' }, ticks: { color: '#94a3b8', callback: (v) => (v * 100) + '%' } }
                },
                onHover: onHoverCallback
            }
        });
    }

    function initializeSdxlChart() {
        const ctx = document.getElementById('sdxlChart').getContext('2d');
        const justificationEl = document.getElementById('sdxl-justification');
        const recipeButtons = document.querySelectorAll('#sdxl-content .recipe-btn');
        const explanationEl = document.getElementById('sdxl-recipe-explanation');

        const onHover = (e, el) => {
            const activeBtn = document.querySelector('#sdxl-content .recipe-btn.active');
            if (!activeBtn) return;
            const activeRecipeKey = activeBtn.id.replace('recipe-sdxl-', '');
            justificationEl.textContent = el.length ? sdxlData.recipes[activeRecipeKey].justifications[el[0].index] : 'Najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie jego wagi.';
        };
        sdxlChartInstance = createChart(ctx, onHover);

        function updateSdxlChart(recipeKey) {
            const recipe = sdxlData.recipes[recipeKey];
            if (!recipe || !sdxlChartInstance) return;
            explanationEl.innerHTML = recipe.explanation;
            sdxlChartInstance.data = {
                labels: sdxlData.labels,
                datasets: [
                    { label: 'Animij (A)', data: recipe.weights.map(w => 1 - w), backgroundColor: '#4f46e5', barPercentage: 0.9, categoryPercentage: 0.8 },
                    { label: 'Graycolor (B)', data: recipe.weights, backgroundColor: '#a5b4fc', barPercentage: 0.9, categoryPercentage: 0.8 }
                ]
            };
            sdxlChartInstance.update();
        }
        recipeButtons.forEach(button => button.addEventListener('click', () => {
            const recipeKey = button.id.replace('recipe-sdxl-', '');
            recipeButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updateSdxlChart(recipeKey);
        }));
        updateSdxlChart('balanced');
    }

    function initializePonyChart() {
        const ctx = document.getElementById('ponyChart').getContext('2d');
        const justificationEl = document.getElementById('pony-justification');
        const recipeButtons = document.querySelectorAll('#pony-content .recipe-btn');
        
        const onHover = (e, el) => {
            const activeBtn = document.querySelector('#pony-content .recipe-btn.active');
            if (!activeBtn) return;
            const activeRecipeKey = activeBtn.id.replace('recipe-pony-', '');
            justificationEl.textContent = el.length ? ponyData.recipes[activeRecipeKey].justifications[el[0].index] : 'Wybierz przepis i najedź kursorem na blok, aby zobaczyć uzasadnienie.';
        };
        ponyChartInstance = createChart(ctx, onHover);

        function updatePonyChart(recipeKey) {
            const recipe = ponyData.recipes[recipeKey];
            if (!recipe || !ponyChartInstance) return;
            ponyChartInstance.data = {
                labels: ponyData.labels,
                datasets: [
                    { label: `${recipe.model1} (A)`, data: recipe.weights.map(w => 1 - w), backgroundColor: recipe.color1, barPercentage: 0.9, categoryPercentage: 0.8 },
                    { label: `${recipe.model2} (B)`, data: recipe.weights, backgroundColor: recipe.color2, barPercentage: 0.9, categoryPercentage: 0.8 }
                ]
            };
            ponyChartInstance.update();
        }
        recipeButtons.forEach(button => button.addEventListener('click', () => {
            const recipeKey = button.id.replace('recipe-pony-', '');
            recipeButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updatePonyChart(recipeKey);
        }));
        updatePonyChart('stage1');
    }
    
    function initializeHybridChart() {
        const ctx = document.getElementById('hybridChart').getContext('2d');
        const justificationEl = document.getElementById('hybrid-justification');
        const recipeButtons = document.querySelectorAll('#hybrid-content .recipe-btn');
        const explanationEl = document.getElementById('hybrid-recipe-explanation');
        const chartContainer = document.querySelector('#hybrid-content .chart-container');

        const onHover = (e, el) => {
            const activeBtn = document.querySelector('#hybrid-content .recipe-btn.active');
            if (!activeBtn) return;
            const activeRecipeKey = activeBtn.id.replace('recipe-hybrid-', '');
            const recipe = hybridData.recipes[activeRecipeKey];
            if (recipe && !recipe.is_dare) {
                justificationEl.textContent = el.length ? recipe.justifications[el[0].index] : 'Wybierz przepis i najedź kursorem na blok, aby zobaczyć uzasadnienie.';
            } else {
                justificationEl.textContent = 'Ustawienia DARE-TIES są stałe i nie są wizualizowane na wykresie.';
            }
        };
        hybridChartInstance = createChart(ctx, onHover);
        
        function updateHybridChart(recipeKey) {
            const recipe = hybridData.recipes[recipeKey];
            if (!recipe) return;
            
            explanationEl.style.display = recipe.is_dare ? 'block' : 'none';
            if(recipe.is_dare) {
                explanationEl.innerHTML = recipe.explanation || '';
            }
            
            if (recipe.is_dare) {
                chartContainer.style.display = 'none';
                justificationEl.textContent = 'Ustawienia DARE-TIES są stałe i nie są wizualizowane na wykresie.';
            } else {
                chartContainer.style.display = 'block';
                if (!hybridChartInstance) return;
                hybridChartInstance.data = {
                    labels: hybridData.labels,
                    datasets: [
                        { label: `${recipe.model1} (A)`, data: recipe.weights.map(w => 1 - w), backgroundColor: recipe.color1, barPercentage: 0.9, categoryPercentage: 0.8 },
                        { label: `${recipe.model2} (B)`, data: recipe.weights, backgroundColor: recipe.color2, barPercentage: 0.9, categoryPercentage: 0.8 }
                    ]
                };
                hybridChartInstance.update();
            }
        }
        recipeButtons.forEach(button => button.addEventListener('click', () => {
            const recipeKey = button.id.replace('recipe-hybrid-', '');
            recipeButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updateHybridChart(recipeKey);
        }));
        updateHybridChart('stage1');
    }

    function switchVersion(version) {
        const allContent = [sdxlContent, ponyContent, hybridContent];
        const allButtons = [selectSdxlBtn, selectPonyBtn, selectHybridBtn];
        
        allContent.forEach(el => el.style.display = 'none');
        allButtons.forEach(btn => btn.classList.remove('active'));

        const navBlueprints = document.getElementById('nav-blueprints');
        const navRecipes = document.getElementById('nav-recipes');
        navBlueprints.href = `#${version}-blueprints`;
        navRecipes.href = `#${version}-recipes`;

        if (version === 'sdxl') {
            sdxlContent.style.display = 'block';
            selectSdxlBtn.classList.add('active');
            if (!sdxlChartInstance) initializeSdxlChart();
        } else if (version === 'pony') {
            ponyContent.style.display = 'block';
            selectPonyBtn.classList.add('active');
            if (!ponyChartInstance) initializePonyChart();
        } else if (version === 'hybrid') {
            hybridContent.style.display = 'block';
            selectHybridBtn.classList.add('active');
            if (!hybridChartInstance) initializeHybridChart();
        }
    }

    selectSdxlBtn.addEventListener('click', () => switchVersion('sdxl'));
    selectPonyBtn.addEventListener('click', () => switchVersion('pony'));
    selectHybridBtn.addEventListener('click', () => switchVersion('hybrid'));

    mainNav.addEventListener('click', function(e) {
        if (e.target.tagName === 'A') {
            e.preventDefault();
            const targetId = e.target.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        }
    });

    switchVersion('sdxl');
});
    </script>

</body>
</html>
