<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="pageTitle">Interaktywny przewodnik: Zaawansowane łączenie modeli</title>
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html { scroll-padding-top: 5rem; }
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #cbd5e1; }
        #shader-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
        .content-wrapper { position: relative; z-index: 1; }
        .chart-container { position: relative; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
        @media (min-width: 768px) { .chart-container { height: 450px; } }
        .version-btn, .recipe-btn, .lang-btn { transition: background-color 0.3s, border-color 0.3s, color 0.3s, box-shadow 0.3s, transform 0.3s; transform-style: preserve-3d; }
        .card { background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 0.75rem; border: 1px solid #334155; transition: all 0.3s ease-in-out; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
        .card:hover { box-shadow: 0 0 25px -5px rgba(79, 70, 229, 0.3); border-color: #4f46e5; transform: translateY(-4px) scale(1.02); }
        .version-btn, .recipe-btn, .lang-btn { background-color: rgba(30, 41, 59, 0.8); color: #e2e8f0; border: 1px solid #475569; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .version-btn:hover, .recipe-btn:hover, .lang-btn:hover { background-color: #3730a3; border-color: #6366f1; color: white; }
        .version-btn.active, .recipe-btn.active, .lang-btn.active { background-color: #4f46e5; color: white; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); border-color: #6366f1; }
        .dare-panel { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3); }
        .flow-arrow { font-family: monospace; font-weight: bold; }
    </style>
</head>
<body class="bg-slate-900">
    <canvas id="shader-canvas"></canvas>
    <div class="content-wrapper">
        <header class="bg-slate-900/50 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-700">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="font-bold text-lg text-slate-100" data-i18n-key="guideTitle"></span>
                    </div>
                    <div class="flex items-center space-x-8">
                        <div id="main-nav" class="flex items-center space-x-4 text-sm font-medium">
                            <a id="nav-blueprints" href="#sdxl-blueprints" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.blueprints"></a>
                            <a id="nav-recipes" href="#sdxl-recipes" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.recipes"></a>
                            <a href="#analysis" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.analysis"></a>
                            <a href="#glossary" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav.glossary"></a>
                        </div>
                         <div class="flex items-center">
                            <button id="lang-pl" class="lang-btn active px-3 py-1 rounded-l-md text-xs font-medium">PL</button>
                            <button id="lang-en" class="lang-btn px-3 py-1 rounded-r-md text-xs font-medium">EN</button>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <section class="text-center mb-16">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-100 tracking-tight" data-i18n-key="header.title"></h1>
                <p class="mt-4 text-lg text-slate-400 max-w-3xl mx-auto" data-i18n-key="header.subtitle"></p>
            </section>

            <div id="strategy-selector" class="flex justify-center flex-wrap gap-4 mb-16 p-4 bg-slate-800/50 border border-slate-700 rounded-lg shadow-inner">
                <button id="select-sdxl" class="version-btn active px-6 py-3 rounded-md text-base font-medium" data-i18n-key="strategy.sdxl"></button>
                <button id="select-pony" class="version-btn px-6 py-3 rounded-md text-base font-medium" data-i18n-key="strategy.pony"></button>
                <button id="select-hybrid" class="version-btn px-6 py-3 rounded-md text-base font-medium" data-i18n-key="strategy.hybrid"></button>
            </div>

            <!-- SDXL Content -->
            <div id="sdxl-content">
                <section id="sdxl-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="sdxl.blueprint.title"></h2>
                    <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="sdxl.blueprint.description"></p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Animij [Illustrious] V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="sdxl.blueprint.card1.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card1.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor SemiRealIllustMix</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="sdxl.blueprint.card2.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card2.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Boomer Art Model v2.0</h3><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="sdxl.blueprint.card3.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card3.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">D34D.CH4NN3L.SDXL</h3><p class="text-sm font-medium text-red-400 mb-2" data-i18n-key="sdxl.blueprint.card4.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl.blueprint.card4.desc"></p></div>
                    </div>
                </section>
                <section id="sdxl-recipes" class="mb-24 scroll-mt-20">
                     <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="sdxl.recipes.title"></h2>
                     <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="sdxl.recipes.step1.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl.recipes.step1.desc"></p>
                         <div class="flex justify-center flex-wrap gap-4 mb-6" id="sdxl-recipe-buttons">
                            <button data-recipe="balanced" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl.recipes.step1.btnBalanced"></button>
                            <button data-recipe="host_dominant" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl.recipes.step1.btnHost"></button>
                            <button data-recipe="donor_receptive" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl.recipes.step1.btnDonor"></button>
                         </div>
                         <div id="sdxl-recipe-explanation" class="mb-6 p-4 bg-indigo-900/30 border border-indigo-500/50 text-indigo-200 rounded-md text-sm"></div>
                         <div class="chart-container lazy-chart" id="sdxlChartContainer"><canvas id="sdxlChart"></canvas></div>
                         <div id="sdxl-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart.hoverPrompt"></div>
                     </div>
                     <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="sdxl.recipes.step2.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl.recipes.step2.desc"></p>
                         <div class="grid md:grid-cols-1 gap-8">
                             <div class="dare-panel">
                                 <h4 class="font-bold text-lg text-slate-200 mb-4 text-center" data-i18n-key="sdxl.recipes.step2a.title"></h4>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                     <div>
                                         <h5 class="text-sm font-semibold text-indigo-300 mb-2" data-i18n-key="dare.trim.title"></h5>
                                         <p class="text-xs text-slate-400 mb-4" data-i18n-key="sdxl.recipes.step2a.trimDesc"></p>
                                         <p class="text-xs"><strong class="text-slate-300">model_a:</strong> <span data-i18n-key="dare.hostFromStep1"></span></p>
                                         <p class="text-xs"><strong class="text-slate-300">model_b:</strong> sd_xl_base_1.0</p>
                                         <p class="text-xs"><strong class="text-slate-300">threshold:</strong> 0.60</p>
                                         <p class="text-xs"><strong class="text-slate-300">threshold_type:</strong> quantile</p>
                                     </div>
                                     <div>
                                         <h5 class="text-sm font-semibold text-amber-300 mb-2" data-i18n-key="dare.merge.title"></h5>
                                         <p class="text-xs text-slate-400 mb-4" data-i18n-key="dare.merge.desc"></p>
                                         <p class="text-xs"><strong class="text-slate-300">model1:</strong> <span data-i18n-key="dare.hostFromStep1"></span></p>
                                         <p class="text-xs"><strong class="text-slate-300">model2:</strong> Boomer Art Model</p>
                                         <p class="text-xs"><strong class="text-slate-300">base_model:</strong> sd_xl_base_1.0</p>
                                         <p class="text-xs"><strong class="text-slate-300">density:</strong> 0.45</p>
                                         <p class="text-xs"><strong class="text-slate-300">ties_mode:</strong> sum</p>
                                     </div>
                                 </div>
                                 <div class="mt-6 pt-4 border-t border-slate-700">
                                     <h5 class="text-sm font-semibold text-slate-300 mb-2" data-i18n-key="dare.justification"></h5>
                                     <p class="text-xs text-slate-400" data-i18n-key="sdxl.recipes.step2a.justification"></p>
                                 </div>
                             </div>
                         </div>
                    </div>
                </section>
            </div>

            <!-- PONY Content -->
            <div id="pony-content" class="hidden">
                 <section id="pony-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="pony.blueprint.title"></h2>
                    <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="pony.blueprint.description"></p>
                     <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">JANKU V4.0</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="pony.blueprint.card1.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="pony.blueprint.card1.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">NEW ERA V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="pony.blueprint.card2.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="pony.blueprint.card2.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor SemiRealIllustMix</h3><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="pony.blueprint.card3.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="pony.blueprint.card3.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">SinGlo V2.0</h3><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="pony.blueprint.card4.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="pony.blueprint.card4.desc"></p></div>
                    </div>
                 </section>
                 <section id="pony-recipes" class="mb-24 scroll-mt-20">
                     <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="pony.recipes.title"></h2>
                      <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="pony.recipes.step1.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="pony.recipes.step1.desc"></p>
                         <div class="flex justify-center flex-wrap gap-4 mb-6" id="pony-recipe-buttons">
                            <button data-recipe="stage1" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="pony.recipes.step1.btnStage1"></button>
                            <button data-recipe="stage2" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="pony.recipes.step1.btnStage2"></button>
                            <button data-recipe="stage3" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="pony.recipes.step1.btnStage3"></button>
                         </div>
                         <div class="chart-container lazy-chart" id="ponyChartContainer"><canvas id="ponyChart"></canvas></div>
                         <div id="pony-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart.hoverPrompt"></div>
                     </div>
                     <div class="card p-8">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="pony.assembly.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="pony.assembly.desc"></p>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="pony.assembly.clip.title"></h4>
                                 <p class="text-sm text-slate-400 mb-4" data-i18n-key="pony.assembly.clip.desc"></p>
                                <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                     <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20">
                                         <p class="font-medium mb-1 text-indigo-300" data-i18n-key="clip.merge.noobai.title"></p>
                                         <div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">JANKU CLIP</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">NEW ERA CLIP</div></div>
                                         <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.noobai.weights"></span></div>
                                     </div>
                                     <div class="p-2 border border-amber-500/50 rounded-lg bg-amber-900/20">
                                         <p class="font-medium mb-1 text-amber-300" data-i18n-key="clip.merge.illustrious.title"></p>
                                         <div class="flex justify-around items-center"><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">Graycolor CLIP</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">SinGlo CLIP</div></div>
                                         <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.illustrious.weights"></span></div>
                                     </div>
                                     <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30">
                                        <p class="font-medium mb-1 text-slate-300" data-i18n-key="clip.merge.pony.title"></p>
                                        <div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/50 rounded-md text-indigo-100" data-i18n-key="clip.merge.noobai.result"></div><div class="text-slate-400 font-thin text-xl flow-arrow">+</div><div class="p-2 bg-amber-500/50 rounded-md text-amber-100" data-i18n-key="clip.merge.illustrious.result"></div></div>
                                        <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.pony.weights"></span></div>
                                        <div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2" data-i18n-key="clip.merge.pony.final"></div>
                                    </div>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="vae.title"></h4>
                                 <p class="text-sm text-slate-400 mb-6" data-i18n-key="pony.assembly.vae.desc"></p>
                                 <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                     <p class="font-semibold text-indigo-200" data-i18n-key="vae.recommendation"></p>
                                     <p class="text-indigo-300">Use the VAE built into `JANKU V4.0`.</p>
                                     <p class="text-xs mt-2 text-indigo-400" data-i18n-key="pony.assembly.vae.justification"></p>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </section>
            </div>
            
            <!-- HYBRID Content -->
            <div id="hybrid-content" class="hidden">
                 <section id="hybrid-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="hybrid.blueprint.title"></h2>
                    <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="hybrid.blueprint.description"></p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-6">
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">JANKU V4.0</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="hybrid.blueprint.card1.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="hybrid.blueprint.card1.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">NEW ERA V5.0</h3><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="hybrid.blueprint.card2.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="hybrid.blueprint.card2.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">Graycolor</h3><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="hybrid.blueprint.card3.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="hybrid.blueprint.card3.desc"></p></div>
                        <div class="card p-6 flex flex-col"><h3 class="font-bold text-lg text-slate-100">SinGlo V2.0</h3><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="hybrid.blueprint.card4.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="hybrid.blueprint.card4.desc"></p></div>
                        <div class="card p-6 flex flex-col ring-2 ring-red-500/50"><h3 class="font-bold text-lg text-slate-100">Boomer Art (SDXL)</h3><p class="text-sm font-medium text-red-400 mb-2" data-i18n-key="hybrid.blueprint.card5.role"></p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="hybrid.blueprint.card5.desc"></p></div>
                    </div>
                </section>
                <section id="hybrid-recipes" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="hybrid.recipes.title"></h2>
                    <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="hybrid.recipes.step1.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="hybrid.recipes.step1.desc"></p>
                         <div class="flex justify-center flex-wrap gap-4 mb-6" id="hybrid-recipe-buttons">
                            <button data-recipe="stage1" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage1"></button>
                            <button data-recipe="stage2" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage2"></button>
                            <button data-recipe="stage3" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage3"></button>
                            <button data-recipe="stage4" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="hybrid.recipes.step1.btnStage4"></button>
                         </div>
                         <div id="hybrid-recipe-explanation" class="mb-6" style="display: none;"></div>
                         <div class="chart-container lazy-chart" id="hybridChartContainer"><canvas id="hybridChart"></canvas></div>
                         <div id="hybrid-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart.hoverPrompt"></div>
                    </div>
                    <div class="card p-8">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="hybrid.assembly.title"></h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="hybrid.assembly.desc"></p>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="hybrid.assembly.clip.title"></h4>
                                 <p class="text-sm text-slate-400 mb-4" data-i18n-key="hybrid.assembly.clip.desc"></p>
                                <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                     <div class="p-2 border border-purple-500/50 rounded-lg bg-purple-900/20">
                                        <p class="font-medium mb-1 text-purple-300" data-i18n-key="hybrid.assembly.clip.step1Title"></p>
                                        <div class="flex flex-col space-y-2">
                                            <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20">
                                                 <p class="font-medium mb-1 text-indigo-300" data-i18n-key="clip.merge.noobai.title"></p>
                                                 <div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">JANKU CLIP</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">NEW ERA CLIP</div></div>
                                                 <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.noobai.weights"></span></div>
                                            </div>
                                            <div class="self-center text-slate-400 flow-arrow">+</div>
                                            <div class="p-2 border border-amber-500/50 rounded-lg bg-amber-900/20">
                                                 <p class="font-medium mb-1 text-amber-300" data-i18n-key="clip.merge.illustrious.title"></p>
                                                 <div class="flex justify-around items-center"><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">Graycolor CLIP</div><div class="text-slate-400 flow-arrow">+</div><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">SinGlo CLIP</div></div>
                                                 <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.illustrious.weights"></span></div>
                                            </div>
                                        </div>
                                        <div class="self-center mt-2 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.hybrid.ponyweights"></span></div>
                                         <div class="p-2 bg-purple-500/50 rounded-md text-purple-100 mt-1" data-i18n-key="clip.merge.pony.result"></div>
                                    </div>
                                     <div class="self-center mt-1 text-slate-400 flow-arrow text-2xl">↓</div>
                                    <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30">
                                        <p class="font-medium mb-1 text-slate-300" data-i18n-key="hybrid.assembly.clip.step2Title"></p>
                                        <div class="flex justify-around items-center"><div class="p-2 bg-purple-500/50 rounded-md text-purple-100">Pony Base CLIP</div><div class="text-slate-400 font-thin text-xl flow-arrow">+</div><div class="p-2 bg-red-500/50 rounded-md text-red-100">SDXL CLIP</div></div>
                                        <div class="self-center mt-1 text-slate-400 flow-arrow">↓ <span class="font-normal" data-i18n-key="clip.merge.hybrid.finalweights"></span></div>
                                        <div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2" data-i18n-key="hybrid.assembly.clip.final"></div>
                                    </div>
                                </div>
                                 <div class="dare-panel mt-6">
                                     <h5 class="text-sm font-semibold text-slate-300 mb-2" data-i18n-key="hybrid.assembly.clip.noteTitle"></h5>
                                     <p class="text-xs text-slate-400" data-i18n-key="hybrid.assembly.clip.noteDesc"></p>
                                 </div>
                             </div>
                             <div>
                                <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="vae.title"></h4>
                                <p class="text-sm text-slate-400 mb-6" data-i18n-key="hybrid.assembly.vae.desc"></p>
                                <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                     <p class="font-semibold text-indigo-200" data-i18n-key="vae.recommendation"></p>
                                     <p class="text-indigo-300">Use the VAE built into `JANKU V4.0`.</p>
                                     <p class="text-xs mt-2 text-indigo-400" data-i18n-key="hybrid.assembly.vae.justification"></p>
                                 </div>
                             </div>
                         </div>
                    </div>
                </section>
            </div>
            
             <section id="analysis" class="mb-24 scroll-mt-20">
                 <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="analysis.title"></h2>
                 <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="analysis.desc"></p>
                <div class="overflow-x-auto card p-2 md:p-6">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-800/50 text-slate-200">
                            <tr>
                                <th class="p-3 font-semibold" data-i18n-key="analysis.table.header1"></th>
                                <th class="p-3 font-semibold" data-i18n-key="strategy.sdxl"></th>
                                <th class="p-3 font-semibold" data-i18n-key="strategy.pony"></th>
                                <th class="p-3 font-semibold" data-i18n-key="strategy.hybrid"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700">
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200" data-i18n-key="analysis.table.row1.title"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row1.col1"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row1.col2"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row1.col3"></td>
                            </tr>
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200" data-i18n-key="analysis.table.row2.title"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row2.col1"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row2.col2"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row2.col3"></td>
                            </tr>
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200" data-i18n-key="analysis.table.row3.title"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row3.col1"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row3.col2"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row3.col3"></td>
                            </tr>
                            <tr class="hover:bg-slate-800/30">
                                <td class="p-3 font-medium text-slate-200" data-i18n-key="analysis.table.row4.title"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row4.col1"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row4.col2"></td>
                                <td class="p-3" data-i18n-key="analysis.table.row4.col3"></td>
                            </tr>
                             <tr class="hover:bg-slate-800/30">
                                 <td class="p-3 font-medium text-slate-200" data-i18n-key="analysis.table.row5.title"></td>
                                 <td class="p-3" data-i18n-key="analysis.table.row5.col1"></td>
                                 <td class="p-3" data-i18n-key="analysis.table.row5.col2"></td>
                                 <td class="p-3" data-i18n-key="analysis.table.row5.col3"></td>
                             </tr>
                        </tbody>
                    </table>
                </div>
                 <div class="mt-8 p-6 bg-indigo-900/30 border border-indigo-500/50 rounded-lg">
                     <h3 class="font-bold text-lg text-indigo-200 mb-2" data-i18n-key="analysis.recommendation.title"></h3>
                     <p class="text-indigo-300" data-i18n-key="analysis.recommendation.p1"></p>
                     <p class="mt-2 text-sm text-indigo-400" data-i18n-key="analysis.recommendation.p2"></p>
                 </div>
            </section>

            <section id="glossary" class="mb-24 scroll-mt-20">
                 <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="glossary.title"></h2>
                 <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="glossary.desc"></p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card p-6"> <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="glossary.term1.title"></h3> <p class="text-sm text-slate-400" data-i18n-key="glossary.term1.desc"></p> </div>
                    <div class="card p-6"> <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="glossary.term2.title"></h3> <p class="text-sm text-slate-400" data-i18n-key="glossary.term2.desc"></p> <ul class="text-sm text-slate-400 mt-2 list-disc list-inside space-y-1"> <li data-i18n-key="glossary.term2.li1"></li> <li data-i18n-key="glossary.term2.li2"></li> </ul> </div>
                    <div class="card p-6"> <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="glossary.term3.title"></h3> <p class="text-sm text-slate-400" data-i18n-key="glossary.term3.desc"></p> </div>
                    <div class="card p-6"> <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="glossary.term4.title"></h3> <p class="text-sm text-slate-400" data-i18n-key="glossary.term4.desc"></p> </div>
                    <div class="card p-6"> <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="glossary.term5.title"></h3> <p class="text-sm text-slate-400" data-i18n-key="glossary.term5.desc"></p> </div>
                    <div class="card p-6"> <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="glossary.term6.title"></h3> <p class="text-sm text-slate-400" data-i18n-key="glossary.term6.desc"></p> </div>
                </div>
            </section>
        </main>

        <footer class="bg-slate-900/50 mt-24 border-t border-slate-700">
            <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
                <p data-i18n-key="footer.text"></p>
            </div>
        </footer>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- OPTIMIZATION: WEBGL SHADER CONTROL ---
    let animationFrameId;
    let isTabVisible = true;
    let gl, program, positionAttributeLocation, resolutionUniformLocation, timeUniformLocation;

    function initShaderBackground() {
        const canvas = document.getElementById('shader-canvas');
        try {
            gl = canvas.getContext('webgl', { antialias: false, powerPreference: 'low-power' });
            if (!gl) { console.error("WebGL not supported"); return; }
            
            const vertexShaderSource = `attribute vec2 a_position; void main() { gl_Position = vec4(a_position, 0.0, 1.0); }`;
            const fragmentShaderSource = `
                precision lowp float;
                uniform vec2 u_resolution;
                uniform float u_time;
                float random(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453); }
                float noise(vec2 st) {
                    vec2 i = floor(st); vec2 f = fract(st);
                    vec2 u = f*f*(3.0-2.0*f);
                    return mix(mix(random(i), random(i + vec2(1.0,0.0)), u.x),
                               mix(random(i + vec2(0.0,1.0)), random(i + vec2(1.0,1.0)), u.x), u.y);
                }
                void main() {
                    vec2 st = gl_FragCoord.xy/u_resolution.xy * 2.0;
                    st.x *= u_resolution.x/u_resolution.y;
                    float n = noise(st * 4.0 + u_time * 0.1);
                    gl_FragColor = vec4(vec3(n * 0.1, n * 0.15, n * 0.25), 1.0);
                }`;
            
             function createShader(type, source) { const shader = gl.createShader(type); gl.shaderSource(shader, source); gl.compileShader(shader); if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) { console.error('Shader error: ' + gl.getShaderInfoLog(shader)); gl.deleteShader(shader); return null; } return shader; }
             const vertexShader = createShader(gl.VERTEX_SHADER, vertexShaderSource);
             const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentShaderSource);
             program = gl.createProgram(); gl.attachShader(program, vertexShader); gl.attachShader(program, fragmentShader); gl.linkProgram(program);
             if (!gl.getProgramParameter(program, gl.LINK_STATUS)) { console.error('Shader program error: ' + gl.getProgramInfoLog(program)); return; }
             
             positionAttributeLocation = gl.getAttribLocation(program, "a_position");
             resolutionUniformLocation = gl.getUniformLocation(program, "u_resolution");
             timeUniformLocation = gl.getUniformLocation(program, "u_time");
             
             const positionBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer); gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, 1, 1, 1, -1, -1, 1, -1]), gl.STATIC_DRAW);
             gl.useProgram(program);
             gl.enableVertexAttribArray(positionAttributeLocation);
             gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);

             requestAnimationFrame(render);
        } catch (e) { console.error("WebGL init error:", e); }
    }
    
    function render(time) {
        if (!isTabVisible || !gl) {
            animationFrameId = requestAnimationFrame(render);
            return;
        };
        time *= 0.0005;
        if (gl.canvas.width !== gl.canvas.clientWidth || gl.canvas.height !== gl.canvas.clientHeight) {
            gl.canvas.width = gl.canvas.clientWidth;
            gl.canvas.height = gl.canvas.clientHeight;
            gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
        }
        gl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);
        gl.uniform1f(timeUniformLocation, time);
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
        animationFrameId = requestAnimationFrame(render);
    }

    document.addEventListener('visibilitychange', () => {
        isTabVisible = document.visibilityState === 'visible';
    });

    // --- I18N and Data Store ---
    const i18nData = {
        pl: {
            pageTitle: "Interaktywny przewodnik: Zaawansowane łączenie modeli",
            guideTitle: "Przewodnik po Łączeniu Modeli",
            "nav.blueprints": "Schematy", "nav.recipes": "Przepisy", "nav.analysis": "Analiza", "nav.glossary": "Glosariusz",
            "header.title": "Zaawansowane Łączenie Modeli",
            "header.subtitle": "Interaktywny przewodnik po trzech filozofiach łączenia w celu stworzenia modelu do zasobów gry w stylu retro anime, dark fantasy i sci-fi. Wybierz strategię, aby poznać jej komponenty i przepisy.",
            "strategy.sdxl": "Strategia \"Przeszczepu SDXL\"", "strategy.pony": "Strategia \"Czystej Krwi PONY\"", "strategy.hybrid": "Strategia \"Hybrydowego Łatania\"",
            "sdxl.blueprint.title": "Schemat: Strategia \"Przeszczepu SDXL\"",
            "sdxl.blueprint.description": "Ta strategia wykorzystuje stabilny model-host w stylu anime i chirurgicznie wstrzykuje określone \"umiejętności\" od architektonicznie różnych dawców `SDXL 1.0` za pomocą algorytmu DARE-TIES. Celem jest połączenie czystego stylu retro anime (Priorytet 1) z estetyką dark fantasy/sci-fi (Priorytet 2) i malarskim stylem (Priorytet 3).",
            "sdxl.blueprint.card1.role": "Model A (Host, Priorytet 1)", "sdxl.blueprint.card1.desc": "Zapewnia fundamentalne rusztowanie: doskonałą anatomię, kompozycję i żywy styl retro anime z czystymi liniami.",
            "sdxl.blueprint.card2.role": "Model B (Pomostowy)", "sdxl.blueprint.card2.desc": "Działa jako pomost, łącząc czysty wygląd anime z półrealistycznym odczuciem, aby uczynić hosta bardziej podatnym na dawców.",
            "sdxl.blueprint.card3.role": "Dawca Stylu Malarskiego (Priorytet 3)", "sdxl.blueprint.card3.desc": "Wstrzykuje malarską, heroiczną esencję fantasy w stylu Frazetty i Vallejo, zapewniając pożądane wykończenie tekstur.",
            "sdxl.blueprint.card4.role": "Dawca Tematyczny (Priorytet 2)", "sdxl.blueprint.card4.desc": "Potężny dawca do wstrzykiwania mrocznych, surowych, horrorowych i fantastycznonaukowych treści tematycznych.",
            "sdxl.recipes.title": "Przepis i Implementacja: Przeszczep SDXL",
            "sdxl.recipes.step1.title": "Etap 1: Tworzenie Hosta (Łączenie z wagami bloków)",
            "sdxl.recipes.step1.desc": "Najpierw tworzymy solidny model-hosta, łącząc Animij (Model A) i Graycolor (Model B). Wartość wagi (`weight`) odnosi się do wkładu Modelu B. Waga `1.0` to 100% Modelu B, a `0.0` to 100% Modelu A.",
            "sdxl.recipes.step1.btnBalanced": "Przepis A: Zrównoważony", "sdxl.recipes.step1.btnHost": "Przepis B: Z dominacją Hosta", "sdxl.recipes.step1.btnDonor": "Przepis C: Podatny na Dawcę",
            "sdxl.recipes.step2.title": "Etap 2: Wstrzykiwanie umiejętności (DARE-TIES)",
            "sdxl.recipes.step2.desc": "W tym etapie używamy zaawansowanego węzła `Model Merger (Advanced/DARE)`. Ta metoda jest alternatywą dla łączenia blokowego i ignoruje wagi ustawione dla poszczególnych bloków. Kontrola nad procesem odbywa się poprzez parametry DARE i TIES. Ogólna waga modelu powinna być ustawiona na `1.0`, aby zmiany zostały w pełni zastosowane.",
            "sdxl.recipes.step2a.title": "Krok 2a: Wstrzyknij styl malarski (Priorytet 3)",
            "sdxl.recipes.step2a.trimDesc": "Użyj węzła `Magnitude Masker`, aby zachować 40% najważniejszych zmian.",
            "sdxl.recipes.step2a.justification": "`threshold: 0.60` w trybie `quantile` zachowuje 40% najważniejszych wektorów zmian, precyzyjnie izolując esencję stylu malarskiego. `density: 0.45` dodatkowo przerzedza te wektory, zapobiegając nadpisaniu bazy anime. Tryb `sum` jest standardowym, zalecanym wyborem dla TIES.",
            "pony.blueprint.title": "Schemat: Strategia \"Czystej Krwi PONY\"",
            "pony.blueprint.description": "Ta strategia pozostaje w obrębie architektonicznie spójnej rodziny \"Pony\", zapewniając wysoką kompatybilność i stabilność. Używa `JANKU` dla solidnej anatomii i `NEW ERA V5` dla tematyki, łącząc je z malarskimi modelami `Graycolor` i `SinGlo`, aby stworzyć dopracowany, spójny i gotowy do wektoryzacji wynik.",
            "pony.blueprint.card1.role": "Host / Baza Strukturalna", "pony.blueprint.card1.desc": "Wszechstronny model z rodziny `NoobAI`, który zapewni podstawową, solidną anatomię i podatne podłoże dla mrocznych motywów.",
            "pony.blueprint.card2.role": "Baza Tematyczna", "pony.blueprint.card2.desc": "Model o silnym stylu, który zostanie połączony z lepszą anatomią JANKU, aby stworzyć bazę \"Dark Anime\".",
            "pony.blueprint.card3.role": "Fundament Stylu Malarskiego", "pony.blueprint.card3.desc": "Model z rodziny `Illustrious`, który zapewnia półrealistyczną, malarską bazę dla ostatecznego wykończenia.",
            "pony.blueprint.card4.role": "Dawca Detali Tekstur", "pony.blueprint.card4.desc": "Model z rodziny `Illustrious` o unikalnym, ostrym stylu, który doda złożoności tekstur.",
            "pony.recipes.title": "Przepis i Implementacja: Czysta Krew PONY",
            "pony.recipes.step1.title": "Wieloetapowe Łączenie Bloków",
            "pony.recipes.step1.desc": "To podejście wykorzystuje sekwencję łączeń do budowania ostatecznego modelu warstwa po warstwie. Wybierz etap, aby zobaczyć jego przepis. Wykres zaktualizuje się, aby pokazać wagi bloków. Najedź kursorem na dowolny blok, aby uzyskać szczegółowe uzasadnienie.",
            "pony.recipes.step1.btnStage1": "Etap 1: Baza \"Dark Anime\"", "pony.recipes.step1.btnStage2": "Etap 2: \"Most Malarski\"", "pony.recipes.step1.btnStage3": "Etap 3: Finałowa Fuzja",
            "pony.assembly.title": "Montaż: Wersja \"Czystej Krwi PONY\"",
            "pony.assembly.desc": "Nawet w obrębie rodziny Pony, gałęzie `NoobAI` i `Illustrious` mają różne \"słowniki\". Sekwencyjne łączenie CLIP jest nadal zalecane dla maksymalnej kontroli i zrozumienia promptów.",
            "pony.assembly.clip.title": "Tworzenie Spójnego CLIP",
            "pony.assembly.clip.desc": "To sekwencyjne łączenie zapewnia, że ostateczny CLIP rozumie prompty związane zarówno z bazą `NoobAI`, jak i warstwą stylu `Illustrious`.",
            "pony.assembly.vae.desc": "Chociaż wszystkie modele pochodzą z rodziny Pony, użycie VAE z ostatecznego Głównego Hosta (`JANKU`) jest najbezpieczniejszym wyborem dla dokładności kolorów.",
            "pony.assembly.vae.justification": "Zapewnia to, że ostateczny obraz jest dekodowany przez VAE dopasowany do bazy strukturalnej.",
            "hybrid.blueprint.title": "Schemat: Strategia \"Hybrydowego Łatania\"",
            "hybrid.blueprint.description": "Ta zaawansowana strategia tworzy bazę z rodziny Pony, a następnie używa DARE-TIES do \"łatania\" jej słabości (np. anatomii) modelem SDXL. To złożone, ale potężne podejście łączy stabilność Pony z siłą SDXL.",
            "hybrid.blueprint.card1.role": "Baza Strukturalna Pony", "hybrid.blueprint.card1.desc": "Tworzy fundamenty anatomiczne bazy Pony.",
            "hybrid.blueprint.card2.role": "Baza Tematyczna Pony", "hybrid.blueprint.card2.desc": "Wnosi do bazy Pony estetykę retro anime.",
            "hybrid.blueprint.card3.role": "Baza Malarska Pony", "hybrid.blueprint.card3.desc": "Wprowadza jakość malarską.",
            "hybrid.blueprint.card4.role": "Dawca Tekstur Pony", "hybrid.blueprint.card4.desc": "Dodaje ostre detale tekstur.",
            "hybrid.blueprint.card5.role": "Łatka Anatomiczna", "hybrid.blueprint.card5.desc": "Model SDXL używany do chirurgicznego korygowania wad w bazie Pony.",
            "hybrid.recipes.title": "Przepis i Implementacja: Hybrydowe Łatanie",
            "hybrid.recipes.step1.title": "Czteroetapowy Przepis Hybrydowy",
            "hybrid.recipes.step1.desc": "Ten przepis obejmuje łączenie bloków, chirurgiczną iniekcję DARE-TIES i ostateczną fuzję. Wybierz etap, aby zobaczyć jego przepis. Etap 3 to proces DARE-TIES i zamiast wykresu pokaże parametry iniekcji.",
            "hybrid.recipes.step1.btnStage1": "Etap 1: Baza Dark Anime", "hybrid.recipes.step1.btnStage2": "Etap 2: Most Malarski", "hybrid.recipes.step1.btnStage3": "Etap 3: Łatka Anatomiczna", "hybrid.recipes.step1.btnStage4": "Etap 4: Finałowa Fuzja",
            "hybrid.assembly.title": "Montaż: Wersja Hybrydowa",
            "hybrid.assembly.desc": "Łączenie CLIP jest tu najbardziej złożone, wymagając sekwencyjnego, dwuetapowego połączenia w celu włączenia słownictwa wszystkich modeli.",
            "hybrid.assembly.clip.title": "Tworzenie \"Trójjęzycznego\" CLIP",
            "hybrid.assembly.clip.desc": "Aby zapewnić kompatybilność, wykonujemy sekwencyjne, ważone łączenie. Najpierw tworzymy bazę Pony, a następnie łączymy ją z SDXL.",
            "hybrid.assembly.clip.step1Title": "Etap 1: Tworzenie bazowego CLIP Pony",
            "hybrid.assembly.clip.step2Title": "Etap 2: Łączenie z SDXL",
            "hybrid.assembly.clip.final": "Finałowy Trójjęzyczny CLIP",
            "hybrid.assembly.clip.noteTitle": "Uwaga: Łatanie niezgodności CLIP",
            "hybrid.assembly.clip.noteDesc": "CLIP modelu \"Boomer Art\" (SDXL) jest architektonicznie niezgodny z CLIP-ami Pony. Aby to załagodzić, zaleca się użycie dwuetapowego procesu DARE-TIES. **Najpierw**, użyj węzła `Magnitude Masker`, aby wyizolować najważniejsze wektory zmian z CLIP modelu SDXL, używając `progu` (np. 0.7-0.8). **Następnie**, użyj tej maski w wejściu `ties_mask` węzła `Model Merger (DARE)` z niską `gęstością` (np. 0.2-0.3). To pozwala na wstrzyknięcie tylko podstawowego 'słownictwa', minimalizując zakłócenia.",
            "hybrid.assembly.vae.desc": "VAE z głównego hosta strukturalnego, `JANKU V4.0`, pozostaje najbezpieczniejszym wyborem do utrzymania spójności kolorów pomimo złożonych łączeń.",
            "hybrid.assembly.vae.justification": "Ponieważ ostateczny model jest w przeważającej mierze oparty na Pony, użycie VAE Pony jest kluczowe, aby zapobiec artefaktom.",
            "analysis.title": "Analiza Porównawcza i Rekomendacja",
            "analysis.desc": "Wybór strategii łączenia wiąże się z kompromisem między stabilnością, zasięgiem stylistycznym a złożonością. Ta sekcja podsumowuje kluczowe różnice, aby pomóc Ci zdecydować, która wersja najlepiej odpowiada Twoim potrzebom.",
            "analysis.table.header1": "Czynnik",
            "analysis.table.row1.title": "Główna Filozofia", "analysis.table.row1.col1": "Chirurgiczne Wstrzykiwanie Umiejętności (DARE-TIES)", "analysis.table.row1.col2": "Harmonia Architektoniczna (Łączenie Bloków)", "analysis.table.row1.col3": "Łączenie Bloków + Chirurgiczne Łatanie (DARE-TIES)",
            "analysis.table.row2.title": "Stabilność", "analysis.table.row2.col1": "Dobra, ale wyższe ryzyko artefaktów z powodu łączenia międzyarchitektonicznego.", "analysis.table.row2.col2": "Doskonała. Łączenie kompatybilnych modeli jest bardziej stabilne.", "analysis.table.row2.col3": "Bardzo Dobra. Głównie stabilna, ale wstrzyknięcie SDXL wprowadza mały czynnik ryzyka.",
            "analysis.table.row3.title": "Zasięg Stylistyczny", "analysis.table.row3.col1": "Najszerszy. Może włączać style z zupełnie różnych rodzin.", "analysis.table.row3.col2": "Skoncentrowany. Doskonale łączy style w ekosystemie Pony, dając wyrafinowany wynik.", "analysis.table.row3.col3": "Unikalny. Tworzy nowatorską mieszankę przez \"łatanie\" bazy Pony cechami SDXL.",
            "analysis.table.row4.title": "Złożoność", "analysis.table.row4.col1": "Wysoka. Wymaga konfiguracji DARE-TIES.", "analysis.table.row4.col2": "Średnia. Proste wieloetapowe łączenie bloków.", "analysis.table.row4.col3": "Bardzo Wysoka. Łączy obie techniki w czteroetapowym procesie.",
            "analysis.table.row5.title": "Najlepsze dla...", "analysis.table.row5.col1": "Osiągnięcia bardzo specyficznej, unikalnej mieszanki odmiennych estetyk (np. retro anime + styl Frazetty).", "analysis.table.row5.col2": "Tworzenia bardzo dopracowanego i stabilnego modelu do konsekwentnego generowania zasobów z czystymi liniami.", "analysis.table.row5.col3": "Eksperymentalnego łączenia w celu naprawy wad (np. słabej anatomii) w modelu bazowym przy użyciu dawcy z innej rodziny.",
            "analysis.recommendation.title": "Ostateczna Rekomendacja",
            "analysis.recommendation.p1": "Dla celu tworzenia **spójnych zasobów do gier** z **czystymi liniami do wektoryzacji**, wersja **\"Czystej Krwi PONY\" jest najlepszym i najbezpieczniejszym wyborem.**",
            "analysis.recommendation.p2": "Jej harmonia architektoniczna zapewnia najwyższą stabilność i przewidywalność. **\"Hybrydowe Łatanie\"** to potężna alternatywa dla zaawansowanych użytkowników, ale jej złożoność czyni ją bardziej eksperymentalną. Wersja **\"Przeszczepu SDXL\"** jest najlepsza, gdy pożądanej estetyki nie można osiągnąć w ramach jednej rodziny.",
            "glossary.title": "Glosariusz Terminów",
            "glossary.desc": "Zrozumienie terminologii jest kluczem do udanego łączenia modeli. Oto definicje podstawowych pojęć omówionych w tym przewodniku.",
            "glossary.term1.title": "Łączenie z wagami bloków", "glossary.term1.desc": "Technika, w której różne warstry (bloki) dwóch sieci neuronowych są łączone z różnymi wagami. Wczesne warstry (IN) kontrolują kompozycję i anatomię, środkowe (M) kontrolują koncepcje, a późne (OUT) kontrolują detale i styl. Jest to metoda odrębna od DARE-TIES.",
            "glossary.term2.title": "DARE-TIES", "glossary.term2.desc": "Zaawansowany algorytm do chirurgicznego wstrzykiwania umiejętności, zaimplementowany w `ComfyUI-DareMerge`. Składa się z dwóch głównych mechanizmów:", "glossary.term2.li1": "<strong>DARE (`density`):</strong> Określa, jaki procent (`density`) wektorów zmian jest **zachowywany** podczas losowego przerzedzania. Jest to odwrotność `drop_rate` z publikacji (`density = 1 - drop_rate`). Wartość `0.2` oznacza zachowanie 20% i odrzucenie 80%.", "glossary.term2.li2": "<strong>TIES (`ties_mode`):</strong> Rozwiązuje konflikty między modelami. Kluczowym krokiem jest \"Przycinanie\" (Trim), które w `ComfyUI-DareMerge` realizuje się za pomocą węzła `Magnitude Masker` (np. z `threshold_type: quantile`), aby zachować tylko najważniejsze zmiany przed właściwym łączeniem.",
            "glossary.term3.title": "UNet", "glossary.term3.desc": "Podstawowa architektura sieci neuronowej w modelach dyfuzyjnych, która generuje obraz. Składa się z bloków wejściowych (IN), środkowych (M) i wyjściowych (OUT).",
            "glossary.term4.title": "CLIP", "glossary.term4.desc": "Komponent, który rozumie prompty tekstowe. Tłumaczy słowa na matematyczną reprezentację, której UNet używa do kierowania generowaniem obrazu. Łączenie CLIP-ów jest kluczowe, aby model rozumiał połączone \"słownictwo\" swoich rodziców.",
            "glossary.term5.title": "VAE (Variational Autoencoder)", "glossary.term5.desc": "Mała sieć neuronowa, która tłumaczy dane wyjściowe UNet na rzeczywiste piksele. Dobry VAE zapewnia żywe kolory. Najbezpieczniej jest używać VAE z głównego modelu bazowego.",
            "glossary.term6.title": "Rodzina Architektoniczna", "glossary.term6.desc": "Grupa modeli o zgodnych strukturach wewnętrznych (np. Pony, SDXL 1.0). Łączenie w obrębie tej samej rodziny jest generalnie bardziej stabilne niż łączenie między rodzinami, które często wymaga DARE-TIES do rozwiązania niezgodności.",
            "dare.trim.title": "Krok 1: Przycinanie (TIES Trim)", "dare.merge.title": "Krok 2: Łączenie (DARE Merge)", "dare.merge.desc": "Użyj `Model Merger (DARE)` z utworzoną maską.", "dare.hostFromStep1": "Host z Etapu 1", "dare.justification": "Uzasadnienie",
            "clip.merge.noobai.title": "Połączenie `NoobAI` CLIPs", "clip.merge.noobai.weights": "(50% / 50%)", "clip.merge.noobai.result": "Połączenie `NoobAI`",
            "clip.merge.illustrious.title": "Połączenie `Illustrious` CLIPs", "clip.merge.illustrious.weights": "(50% / 50%)", "clip.merge.illustrious.result": "Połączenie `Illustrious`",
            "clip.merge.pony.title": "Finałowe Połączenie Pony", "clip.merge.pony.weights": "(70% NoobAI / 30% Illustrious)", "clip.merge.pony.final": "Finałowy Spójny CLIP",
            "clip.merge.hybrid.ponyweights": "(60% NoobAI / 40% Illustrious)", "clip.merge.hybrid.finalweights": "(85% Pony Base / 15% SDXL)",
            "vae.title": "Wybór VAE dla Wierności", "vae.recommendation": "Główna Rekomendacja",
            "footer.text": "Skonsolidowany Interaktywny Przewodnik po Zaawansowanym Łączeniu Modeli",
            "chart.hoverPrompt": "Najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie."
        },
        en: {
            pageTitle: "Interactive Guide: Advanced Model Merging",
            guideTitle: "Model Merging Guide",
            "nav.blueprints": "Blueprints", "nav.recipes": "Recipes", "nav.analysis": "Analysis", "nav.glossary": "Glossary",
            "header.title": "Advanced Model Merging",
            "header.subtitle": "An interactive guide to three merging philosophies for creating a model for retro anime, dark fantasy, and sci-fi game assets. Choose a strategy to explore its components and recipes.",
            "strategy.sdxl": "\"SDXL Grafting\" Strategy", "strategy.pony": "\"Pureblood PONY\" Strategy", "strategy.hybrid": "\"Hybrid Patching\" Strategy",
            "sdxl.blueprint.title": "Blueprint: \"SDXL Grafting\" Strategy",
            "sdxl.blueprint.description": "This strategy uses a stable anime-style host model and surgically injects specific \"skills\" from architecturally different `SDXL 1.0` donors using the DARE-TIES algorithm. The goal is to combine a clean retro anime style (Priority 1) with dark fantasy/sci-fi aesthetics (Priority 2) and a painterly style (Priority 3).",
            "sdxl.blueprint.card1.role": "Model A (Host, Priority 1)", "sdxl.blueprint.card1.desc": "Provides the fundamental scaffolding: excellent anatomy, composition, and a vibrant retro anime style with clean lines.",
            "sdxl.blueprint.card2.role": "Model B (Bridge)", "sdxl.blueprint.card2.desc": "Acts as a bridge, blending the clean anime look with a semi-realistic feel to make the host more receptive to donors.",
            "sdxl.blueprint.card3.role": "Painterly Style Donor (Priority 3)", "sdxl.blueprint.card3.desc": "Injects a painterly, heroic fantasy essence in the style of Frazetta and Vallejo, providing the desired textural finish.",
            "sdxl.blueprint.card4.role": "Thematic Donor (Priority 2)", "sdxl.blueprint.card4.desc": "A powerful donor for injecting dark, raw, horror, and sci-fi thematic content.",
            "sdxl.recipes.title": "Recipe & Implementation: SDXL Grafting",
            "sdxl.recipes.step1.title": "Step 1: Host Creation (Block Weight Merge)",
            "sdxl.recipes.step1.desc": "First, we create a robust host model by merging Animij (Model A) and Graycolor (Model B). The `weight` value refers to Model B's contribution. A weight of `1.0` is 100% Model B, and `0.0` is 100% Model A.",
            "sdxl.recipes.step1.btnBalanced": "Recipe A: Balanced", "sdxl.recipes.step1.btnHost": "Recipe B: Host-Dominant", "sdxl.recipes.step1.btnDonor": "Recipe C: Donor-Receptive",
            "sdxl.recipes.step2.title": "Step 2: Skill Injection (DARE-TIES)",
            "sdxl.recipes.step2.desc": "In this step, we use the advanced `Model Merger (Advanced/DARE)` node. This method is an alternative to block merging and ignores the weights set for individual blocks. Control over the process is done via DARE and TIES parameters. The overall model weight should be set to `1.0` for the changes to be fully applied.",
            "sdxl.recipes.step2a.title": "Step 2a: Inject Painterly Style (Priority 3)",
            "sdxl.recipes.step2a.trimDesc": "Use the `Magnitude Masker` node to keep the top 40% of changes.",
            "sdxl.recipes.step2a.justification": "`threshold: 0.60` in `quantile` mode preserves the top 40% of change vectors, precisely isolating the painterly style's essence. `density: 0.45` further thins these vectors, preventing the anime base from being overwritten. The `sum` mode is the standard, recommended choice for TIES.",
            "pony.blueprint.title": "Blueprint: \"Pureblood PONY\" Strategy",
            "pony.blueprint.description": "This strategy stays within the architecturally consistent \"Pony\" family, ensuring high compatibility and stability. It uses `JANKU` for solid anatomy and `NEW ERA V5` for thematics, merging them with the painterly `Graycolor` and `SinGlo` models to create a polished, coherent, and vector-ready result.",
            "pony.blueprint.card1.role": "Host / Structural Base", "pony.blueprint.card1.desc": "A versatile model from the `NoobAI` family that provides a solid anatomical base and a receptive foundation for dark themes.",
            "pony.blueprint.card2.role": "Thematic Base", "pony.blueprint.card2.desc": "A model with a strong style that will be merged with JANKU's better anatomy to create a \"Dark Anime\" base.",
            "pony.blueprint.card3.role": "Painterly Style Foundation", "pony.blueprint.card3.desc": "A model from the `Illustrious` family that provides a semi-realistic, painterly base for the final finish.",
            "pony.blueprint.card4.role": "Texture Detail Donor", "pony.blueprint.card4.desc": "A model from the `Illustrious` family with a unique, sharp style that will add textural complexity.",
            "pony.recipes.title": "Recipe & Implementation: Pureblood PONY",
            "pony.recipes.step1.title": "Multi-Stage Block Merging",
            "pony.recipes.step1.desc": "This approach uses a sequence of merges to build the final model layer by layer. Select a stage to see its recipe. The chart will update to show the block weights. Hover over any block for a detailed justification.",
            "pony.recipes.step1.btnStage1": "Stage 1: \"Dark Anime\" Base", "pony.recipes.step1.btnStage2": "Stage 2: \"Painterly Bridge\"", "pony.recipes.step1.btnStage3": "Stage 3: Final Fusion",
            "pony.assembly.title": "Assembly: \"Pureblood PONY\" Version",
            "pony.assembly.desc": "Even within the Pony family, the `NoobAI` and `Illustrious` branches have different \"vocabularies.\" Sequential CLIP merging is still recommended for maximum control and prompt understanding.",
            "pony.assembly.clip.title": "Creating a Coherent CLIP",
            "pony.assembly.clip.desc": "This sequential merge ensures the final CLIP understands prompts related to both the `NoobAI` base and the `Illustrious` style layer.",
            "pony.assembly.vae.desc": "Although all models are from the Pony family, using the VAE from the final Main Host (`JANKU`) is the safest choice for color accuracy.",
            "pony.assembly.vae.justification": "This ensures the final image is decoded by a VAE matched to the structural base.",
            "hybrid.blueprint.title": "Blueprint: \"Hybrid Patching\" Strategy",
            "hybrid.blueprint.description": "This advanced strategy creates a base from the Pony family and then uses DARE-TIES to \"patch\" its weaknesses (e.g., anatomy) with an SDXL model. This complex but powerful approach combines Pony's stability with SDXL's strength.",
            "hybrid.blueprint.card1.role": "Pony Structural Base", "hybrid.blueprint.card1.desc": "Creates the anatomical foundation of the Pony base.",
            "hybrid.blueprint.card2.role": "Pony Thematic Base", "hybrid.blueprint.card2.desc": "Brings the retro anime aesthetic to the Pony base.",
            "hybrid.blueprint.card3.role": "Pony Painterly Base", "hybrid.blueprint.card3.desc": "Introduces a painterly quality.",
            "hybrid.blueprint.card4.role": "Pony Texture Donor", "hybrid.blueprint.card4.desc": "Adds sharp texture details.",
            "hybrid.blueprint.card5.role": "Anatomical Patch", "hybrid.blueprint.card5.desc": "An SDXL model used to surgically correct flaws in the Pony base.",
            "hybrid.recipes.title": "Recipe & Implementation: Hybrid Patching",
            "hybrid.recipes.step1.title": "Four-Stage Hybrid Recipe",
            "hybrid.recipes.step1.desc": "This recipe involves block merging, a surgical DARE-TIES injection, and a final fusion. Select a stage to see its recipe. Stage 3 is a DARE-TIES process and will show injection parameters instead of a chart.",
            "hybrid.recipes.step1.btnStage1": "Stage 1: Dark Anime Base", "hybrid.recipes.step1.btnStage2": "Stage 2: Painterly Bridge", "hybrid.recipes.step1.btnStage3": "Stage 3: Anatomical Patch", "hybrid.recipes.step1.btnStage4": "Stage 4: Final Fusion",
            "hybrid.assembly.title": "Assembly: Hybrid Version",
            "hybrid.assembly.desc": "CLIP merging is most complex here, requiring a sequential, two-step merge to incorporate the vocabulary of all models.",
            "hybrid.assembly.clip.title": "Creating a \"Trilingual\" CLIP",
            "hybrid.assembly.clip.desc": "To ensure compatibility, we perform a sequential, weighted merge. First, we create the Pony base, then merge it with SDXL.",
            "hybrid.assembly.clip.step1Title": "Step 1: Create Pony Base CLIP",
            "hybrid.assembly.clip.step2Title": "Step 2: Merge with SDXL",
            "hybrid.assembly.clip.final": "Final Trilingual CLIP",
            "hybrid.assembly.clip.noteTitle": "Note: Patching CLIP Incompatibility",
            "hybrid.assembly.clip.noteDesc": "The \"Boomer Art\" model's CLIP (SDXL) is architecturally incompatible with Pony CLIPs. To mitigate this, a two-step DARE-TIES process is recommended. **First**, use the `Magnitude Masker` node to isolate the most significant change vectors from the SDXL CLIP using a `threshold` (e.g., 0.7-0.8). **Then**, use this mask in the `ties_mask` input of the `Model Merger (DARE)` node with a low `density` (e.g., 0.2-0.3). This allows only its core 'vocabulary' to be injected, minimizing disruption.",
            "hybrid.assembly.vae.desc": "The VAE from the main structural host, `JANKU V4.0`, remains the safest choice for maintaining color consistency despite the complex merges.",
            "hybrid.assembly.vae.justification": "Since the final model is predominantly Pony-based, using a Pony VAE is crucial to prevent artifacts.",
            "analysis.title": "Comparative Analysis and Recommendation",
            "analysis.desc": "Choosing a merging strategy involves a trade-off between stability, stylistic range, and complexity. This section summarizes the key differences to help you decide which version best suits your needs.",
            "analysis.table.header1": "Factor",
            "analysis.table.row1.title": "Core Philosophy", "analysis.table.row1.col1": "Surgical Skill Injection (DARE-TIES)", "analysis.table.row1.col2": "Architectural Harmony (Block Weight Merge)", "analysis.table.row1.col3": "Block Merging + Surgical Patching (DARE-TIES)",
            "analysis.table.row2.title": "Stability", "analysis.table.row2.col1": "Good, but higher risk of artifacts due to cross-architecture merging.", "analysis.table.row2.col2": "Excellent. Merging compatible models is more stable.", "analysis.table.row2.col3": "Very Good. Mostly stable, but the SDXL injection introduces a small risk factor.",
            "analysis.table.row3.title": "Stylistic Range", "analysis.table.row3.col1": "Widest. Can incorporate styles from completely different families.", "analysis.table.row3.col2": "Focused. Perfectly blends styles within the Pony ecosystem for a refined result.", "analysis.table.row3.col3": "Unique. Creates a novel blend by \"patching\" a Pony base with SDXL traits.",
            "analysis.table.row4.title": "Complexity", "analysis.table.row4.col1": "High. Requires DARE-TIES setup.", "analysis.table.row4.col2": "Medium. Straightforward multi-stage block merging.", "analysis.table.row4.col3": "Very High. Combines both techniques in a four-stage process.",
            "analysis.table.row5.title": "Best for...", "analysis.table.row5.col1": "Achieving a very specific, unique blend of disparate aesthetics (e.g., retro anime + Frazetta style).", "analysis.table.row5.col2": "Creating a highly polished and stable model for consistent asset generation with clean lines.", "analysis.table.row5.col3": "Experimental merging to fix flaws (e.g., poor anatomy) in a base model using a donor from another family.",
            "analysis.recommendation.title": "Final Recommendation",
            "analysis.recommendation.p1": "For the goal of creating **consistent game assets** with **clean lines for vectorization**, the **\"Pureblood PONY\" version is the best and safest choice.**",
            "analysis.recommendation.p2": "Its architectural harmony ensures the highest stability and predictability. **\"Hybrid Patching\"** is a powerful alternative for advanced users, but its complexity makes it more experimental. The **\"SDXL Grafting\"** version is best when the desired aesthetic cannot be achieved within a single family.",
            "glossary.title": "Glossary of Terms",
            "glossary.desc": "Understanding the terminology is key to successful model merging. Here are definitions of the core concepts discussed in this guide.",
            "glossary.term1.title": "Block Weight Merging", "glossary.term1.desc": "A technique where different layers (blocks) of two neural networks are merged with different weights. Early layers (IN) control composition and anatomy, the middle layer (M) controls concepts, and late layers (OUT) control details and style. This is a distinct method from DARE-TIES.",
            "glossary.term2.title": "DARE-TIES", "glossary.term2.desc": "An advanced algorithm for surgical skill injection, implemented in `ComfyUI-DareMerge`. It consists of two main mechanisms:", "glossary.term2.li1": "<strong>DARE (`density`):</strong> Determines what percentage (`density`) of change vectors are **kept** during random pruning. It is the inverse of the paper's `drop_rate` (`density = 1 - drop_rate`). A value of `0.2` means 20% are kept and 80% are discarded.", "glossary.term2.li2": "<strong>TIES (`ties_mode`):</strong> Resolves conflicts between models. A key step is \"Trimming,\" which in `ComfyUI-DareMerge` is done using the `Magnitude Masker` node (e.g., with `threshold_type: quantile`) to keep only the most significant changes before the actual merge.",
            "glossary.term3.title": "UNet", "glossary.term3.desc": "The core neural network architecture in diffusion models that generates the image. It consists of input (IN), middle (M), and output (OUT) blocks.",
            "glossary.term4.title": "CLIP", "glossary.term4.desc": "The component that understands text prompts. It translates words into a mathematical representation that the UNet uses to guide image generation. Merging CLIPs is crucial for the model to understand the combined \"vocabulary\" of its parents.",
            "glossary.term5.title": "VAE (Variational Autoencoder)", "glossary.term5.desc": "A small neural network that translates the UNet's output into actual pixels. A good VAE ensures vibrant colors. It's safest to use the VAE from the main base model.",
            "glossary.term6.title": "Architectural Family", "glossary.term6.desc": "A group of models with compatible internal structures (e.g., Pony, SDXL 1.0). Merging within the same family is generally more stable than merging between families, which often requires DARE-TIES to resolve incompatibilities.",
            "dare.trim.title": "Step 1: Trimming (TIES Trim)", "dare.merge.title": "Step 2: Merging (DARE Merge)", "dare.merge.desc": "Use `Model Merger (DARE)` with the created mask.", "dare.hostFromStep1": "Host from Step 1", "dare.justification": "Justification",
            "clip.merge.noobai.title": "`NoobAI` CLIPs Merge", "clip.merge.noobai.weights": "(50% / 50%)", "clip.merge.noobai.result": "`NoobAI` Merge",
            "clip.merge.illustrious.title": "`Illustrious` CLIPs Merge", "clip.merge.illustrious.weights": "(50% / 50%)", "clip.merge.illustrious.result": "`Illustrious` Merge",
            "clip.merge.pony.title": "Final Pony Merge", "clip.merge.pony.weights": "(70% NoobAI / 30% Illustrious)", "clip.merge.pony.final": "Final Coherent CLIP",
            "clip.merge.hybrid.ponyweights": "(60% NoobAI / 40% Illustrious)", "clip.merge.hybrid.finalweights": "(85% Pony Base / 15% SDXL)",
            "vae.title": "Choosing a VAE for Fidelity", "vae.recommendation": "Top Recommendation",
            "footer.text": "Consolidated Interactive Guide to Advanced Model Merging",
            "chart.hoverPrompt": "Hover over a block on the chart to see the rationale for its weight."
        }
    };
    let currentLanguage = 'pl';

    function setLanguage(lang) {
        currentLanguage = lang;
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-i18n-key]').forEach(el => {
            const key = el.getAttribute('data-i18n-key');
            el.innerHTML = i18nData[lang][key] || i18nData['en'][key] || `[${key}]`;
        });
        
        document.getElementById('lang-pl').classList.toggle('active', lang === 'pl');
        document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        
        if (sdxlChartInstance) updateSdxlChart(document.querySelector('#sdxl-recipe-buttons .active').dataset.recipe);
        if (ponyChartInstance) updatePonyChart(document.querySelector('#pony-recipe-buttons .active').dataset.recipe);
        if (hybridChartInstance || document.querySelector('#hybrid-content').style.display !== 'none') {
             updateHybridChart(document.querySelector('#hybrid-recipe-buttons .active').dataset.recipe);
        }
    }

    // --- Charting Logic (with lazy loading) ---
    const blockLabels = ['IN00', 'IN01', 'IN02', 'IN03', 'IN04', 'IN05', 'IN06', 'IN07', 'IN08', 'IN09', 'IN10', 'IN11', 'M00', 'OUT00', 'OUT01', 'OUT02', 'OUT03', 'OUT04', 'OUT05', 'OUT06', 'OUT07', 'OUT08', 'OUT09', 'OUT10', 'OUT11'];
    let sdxlChartInstance, ponyChartInstance, hybridChartInstance;
    const chartDataStore = {
        sdxl: {
            recipes: {
                balanced: { weights: [0.10, 0.12, 0.15, 0.18, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.52, 0.55, 0.60, 0.58, 0.55, 0.52, 0.50, 0.47, 0.42, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10] },
                host_dominant: { weights: [0.05, 0.08, 0.10, 0.12, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.12, 0.10, 0.08, 0.05] },
                donor_receptive: { weights: [0.15, 0.18, 0.20, 0.22, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.58, 0.60, 0.65, 0.62, 0.60, 0.58, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15] }
            }
        },
        pony: {
            recipes: {
                stage1: { model1: 'JANKU', model2: 'NEW ERA V5', color1: '#6366F1', color2: '#312E81', weights: [0.10,0.12,0.15,0.18,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.52,0.55,0.50,0.45,0.40,0.35,0.30,0.25,0.20,0.18,0.15,0.12,0.10,0.08]}, 
                stage2: { model1: 'Graycolor', model2: 'SinGlo', color1: '#F59E0B', color2: '#78350F', weights: [0.15, 0.15, 0.20, 0.20, 0.25, 0.30, 0.30, 0.35, 0.35, 0.40, 0.40, 0.40, 0.45, 0.40, 0.40, 0.35, 0.35, 0.30, 0.30, 0.25, 0.25, 0.20, 0.20, 0.15, 0.15]}, 
                stage3: { model1: {pl:'"Baza Dark Anime"', en:'"Dark Anime Base"'}, model2: {pl:'"Most Malarski"', en: '"Painterly Bridge"'}, color1: '#1E3A8A', color2: '#78350F', weights: [0.10, 0.10, 0.12, 0.15, 0.18, 0.20, 0.22, 0.25, 0.28, 0.30, 0.32, 0.35, 0.40, 0.38, 0.35, 0.32, 0.30, 0.28, 0.25, 0.22, 0.20, 0.18, 0.15, 0.12, 0.10]} 
            }
        },
        hybrid: {
            recipes: {
                stage1: { model1: 'JANKU', model2: 'NEW ERA V5', color1: '#6366F1', color2: '#312E81', weights: [0.10,0.12,0.15,0.18,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.52,0.55,0.50,0.45,0.40,0.35,0.30,0.25,0.20,0.18,0.15,0.12,0.10,0.08]},
                stage2: { model1: 'Graycolor', model2: 'SinGlo', color1: '#F59E0B', color2: '#78350F', weights: [0.15, 0.15, 0.20, 0.20, 0.25, 0.30, 0.30, 0.35, 0.35, 0.40, 0.40, 0.40, 0.45, 0.40, 0.40, 0.35, 0.35, 0.30, 0.30, 0.25, 0.25, 0.20, 0.20, 0.15, 0.15]},
                stage3: { is_dare: true },
                stage4: { model1: {pl:'"Baza z łatką"', en:'"Patched Base"'}, model2: {pl:'"Most Malarski"', en:'"Painterly Bridge"'}, color1: '#1E3A8A', color2: '#78350F', weights: [0.08,0.10,0.12,0.15,0.18,0.20,0.22,0.25,0.28,0.30,0.32,0.35,0.40,0.38,0.35,0.32,0.30,0.28,0.25,0.22,0.20,0.18,0.15,0.12,0.08]}
            }
        }
    };

    const lazyCharts = document.querySelectorAll('.lazy-chart');
    const chartObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const chartContainerId = entry.target.id;
                if (chartContainerId === 'sdxlChartContainer' && !sdxlChartInstance) initializeSdxlChart();
                if (chartContainerId === 'ponyChartContainer' && !ponyChartInstance) initializePonyChart();
                if (chartContainerId === 'hybridChartContainer' && !hybridChartInstance) initializeHybridChart();
                observer.unobserve(entry.target);
            }
        });
    }, { rootMargin: "100px" });

    lazyCharts.forEach(chart => chartObserver.observe(chart));

    // --- General Setup ---
    initShaderBackground();
    
    // --- Event Delegation ---
    document.getElementById('strategy-selector').addEventListener('click', (e) => {
        if (e.target.matches('.version-btn')) {
            switchVersion(e.target.id.replace('select-', ''));
        }
    });

    function createRecipeClickHandler(updateFunction) {
        return (e) => {
            if (e.target.matches('.recipe-btn')) {
                const recipeKey = e.target.dataset.recipe;
                e.currentTarget.querySelector('.active').classList.remove('active');
                e.target.classList.add('active');
                updateFunction(recipeKey);
            }
        };
    }

    document.getElementById('sdxl-recipe-buttons').addEventListener('click', createRecipeClickHandler(updateSdxlChart));
    document.getElementById('pony-recipe-buttons').addEventListener('click', createRecipeClickHandler(updatePonyChart));
    document.getElementById('hybrid-recipe-buttons').addEventListener('click', createRecipeClickHandler(updateHybridChart));
    
    document.getElementById('lang-pl').addEventListener('click', () => setLanguage('pl'));
    document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
    
    // --- Core Functions ---
    function switchVersion(version) {
        ['sdxl', 'pony', 'hybrid'].forEach(v => {
            document.getElementById(`${v}-content`).style.display = v === version ? 'block' : 'none';
            document.getElementById(`select-${v}`).classList.toggle('active', v === version);
        });
         document.getElementById('nav-blueprints').href = `#${version}-blueprints`;
         document.getElementById('nav-recipes').href = `#${version}-recipes`;
         
         // Trigger chart initialization if it becomes visible
         if (version === 'sdxl' && !sdxlChartInstance) initializeSdxlChart();
         if (version === 'pony' && !ponyChartInstance) initializePonyChart();
         if (version === 'hybrid' && !hybridChartInstance) initializeHybridChart();
    }
    
    function createChart(ctx, onHoverCallback) {
        return new Chart(ctx, {
            type: 'bar',
            options: {
                responsive: true, maintainAspectRatio: false,
                animation: { duration: 800 },
                plugins: {
                    tooltip: { 
                        mode: 'index', intersect: false, 
                        callbacks: { 
                            label: (c) => {
                                const modelALabel = c.chart.data.datasets[0].label;
                                const modelBLabel = c.chart.data.datasets[1].label;
                                if (c.datasetIndex === 0) {
                                    return `${modelALabel}: ${((1 - c.parsed.y) * 100).toFixed(0)}%`;
                                }
                                return `${modelBLabel}: ${(c.parsed.y * 100).toFixed(0)}%`;
                            }
                        },
                        backgroundColor: 'rgba(15, 23, 42, 0.8)', titleFont: { weight: 'bold'}, bodyFont: { size: 12 }, borderColor: '#334155', borderWidth: 1,
                    },
                    legend: { position: 'top', labels: { color: '#cbd5e1' } }
                },
                scales: {
                    x: { stacked: true, grid: { display: false }, ticks: { color: '#94a3b8' } },
                    y: { stacked: true, beginAtZero: true, max: 1.0, grid: { color: '#1e293b' }, ticks: { color: '#94a3b8', callback: (v) => (v * 100) + '%' } }
                },
                onHover: onHoverCallback
            }
        });
    }
    
    function initializeSdxlChart() {
        const ctx = document.getElementById('sdxlChart').getContext('2d');
        const justificationEl = document.getElementById('sdxl-justification');
        const onHover = (e, el) => {
            const activeRecipeKey = document.querySelector('#sdxl-recipe-buttons .active').dataset.recipe;
            justificationEl.textContent = el.length ? `[${blockLabels[el[0].index]}] ` + i18nData[currentLanguage][`sdxl.recipes.justification.${activeRecipeKey}.${el[0].index}`] : i18nData[currentLanguage]['chart.hoverPrompt'];
        };
        sdxlChartInstance = createChart(ctx, onHover);
        updateSdxlChart(document.querySelector('#sdxl-recipe-buttons .active').dataset.recipe);
    }

    function updateSdxlChart(recipeKey) {
        if (!sdxlChartInstance) return;
        const recipe = chartDataStore.sdxl.recipes[recipeKey];
        document.getElementById('sdxl-recipe-explanation').innerHTML = i18nData[currentLanguage][`sdxl.recipes.explanation.${recipeKey}`] || '';
        sdxlChartInstance.data = {
            labels: blockLabels,
            datasets: [
                { label: 'Animij (A)', data: recipe.weights.map(w => 1 - w), backgroundColor: '#4f46e5' },
                { label: 'Graycolor (B)', data: recipe.weights, backgroundColor: '#a5b4fc' }
            ]
        };
        sdxlChartInstance.update('none');
    }

    function initializePonyChart() {
        const ctx = document.getElementById('ponyChart').getContext('2d');
        const justificationEl = document.getElementById('pony-justification');
        const onHover = (e, el) => {
            const activeRecipeKey = document.querySelector('#pony-recipe-buttons .active').dataset.recipe;
             justificationEl.textContent = el.length ? `[${blockLabels[el[0].index]}] ` + i18nData[currentLanguage][`pony.recipes.justification.${activeRecipeKey}.${el[0].index}`] : i18nData[currentLanguage]['chart.hoverPrompt'];
        };
        ponyChartInstance = createChart(ctx, onHover);
        updatePonyChart(document.querySelector('#pony-recipe-buttons .active').dataset.recipe);
    }

    function updatePonyChart(recipeKey) {
        if (!ponyChartInstance) return;
        const recipe = chartDataStore.pony.recipes[recipeKey];
        ponyChartInstance.data = {
            labels: blockLabels,
            datasets: [
                { label: `${recipe.model1[currentLanguage] || recipe.model1['en']} (A)`, data: recipe.weights.map(w => 1 - w), backgroundColor: recipe.color1 },
                { label: `${recipe.model2[currentLanguage] || recipe.model2['en']} (B)`, data: recipe.weights, backgroundColor: recipe.color2 }
            ]
        };
        ponyChartInstance.update('none');
    }

    function initializeHybridChart() {
        const ctx = document.getElementById('hybridChart').getContext('2d');
        const justificationEl = document.getElementById('hybrid-justification');
        const onHover = (e, el) => {
            const activeRecipeKey = document.querySelector('#hybrid-recipe-buttons .active').dataset.recipe;
            if (chartDataStore.hybrid.recipes[activeRecipeKey].is_dare) {
                justificationEl.textContent = i18nData[currentLanguage]['dare.fixed'];
            } else {
                justificationEl.textContent = el.length ? `[${blockLabels[el[0].index]}] ` + i18nData[currentLanguage][`hybrid.recipes.justification.${activeRecipeKey}.${el[0].index}`] : i18nData[currentLanguage]['chart.hoverPrompt'];
            }
        };
        hybridChartInstance = createChart(ctx, onHover);
        updateHybridChart(document.querySelector('#hybrid-recipe-buttons .active').dataset.recipe);
    }
    
    function updateHybridChart(recipeKey) {
        const recipe = chartDataStore.hybrid.recipes[recipeKey];
        const explanationEl = document.getElementById('hybrid-recipe-explanation');
        const chartContainer = document.getElementById('hybridChartContainer');
        
        if (recipe.is_dare) {
            explanationEl.innerHTML = i18nData[currentLanguage]['hybrid.recipes.dareExplanation'] || '';
            explanationEl.style.display = 'block';
            chartContainer.style.display = 'none';
        } else {
            explanationEl.style.display = 'none';
            chartContainer.style.display = 'block';
            if (!hybridChartInstance) return;
            hybridChartInstance.data = {
                labels: blockLabels,
                datasets: [
                    { label: `${recipe.model1[currentLanguage] || recipe.model1['en']} (A)`, data: recipe.weights.map(w => 1 - w), backgroundColor: recipe.color1 },
                    { label: `${recipe.model2[currentLanguage] || recipe.model2['en']} (B)`, data: recipe.weights, backgroundColor: recipe.color2 }
                ]
            };
            hybridChartInstance.update('none');
        }
    }

    // Initial state
    setLanguage('pl');
    switchVersion('sdxl');
});
</script>
</body>
</html>
