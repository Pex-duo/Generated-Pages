<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="page_title">Interaktywny przewodnik: Zaawansowane łączenie modeli (Potrójna strategia)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html { scroll-padding-top: 5rem; }
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #cbd5e1; }
        #shader-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
       .content-wrapper { position: relative; z-index: 1; }
       .chart-container { position: relative; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
        @media (min-width: 768px) {.chart-container { height: 450px; } }
       .version-btn,.recipe-btn,.lang-btn { transition: background-color 0.3s, border-color 0.3s, color 0.3s, box-shadow 0.3s, transform 0.3s; transform-style: preserve-3d; }
       .card { background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 0.75rem; border: 1px solid #334155; transition: all 0.3s ease-in-out; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
       .card:hover { box-shadow: 0 0 25px -5px rgba(79, 70, 229, 0.3); border-color: #4f46e5; transform: translateY(-4px) scale(1.02); }
       .version-btn,.recipe-btn,.lang-btn { background-color: rgba(30, 41, 59, 0.8); color: #e2e8f0; border: 1px solid #475569; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
       .version-btn:hover,.recipe-btn:hover,.lang-btn:hover { background-color: #3730a3; border-color: #6366f1; color: white; }
       .version-btn.active,.recipe-btn.active,.lang-btn.active { background-color: #4f46e5; color: white; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); border-color: #6366f1; }
       .dare-panel { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #334155; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3); }
    </style>
</head>
<body class="bg-slate-900">
    <canvas id="shader-canvas"></canvas>
    <div class="content-wrapper">
        <header class="bg-slate-900/50 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-700">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="font-bold text-lg text-slate-100" data-i18n-key="nav_title">Przewodnik po Łączeniu Modeli</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="main-nav" class="hidden sm:flex items-center space-x-4 text-sm font-medium">
                            <a href="#sdxl-blueprints" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav_blueprints">Schematy</a>
                            <a href="#sdxl-recipes" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav_recipes">Przepisy</a>
                            <a href="#analysis" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav_analysis">Analiza</a>
                            <a href="#glossary" class="text-slate-300 hover:text-white transition-colors" data-i18n-key="nav_glossary">Glosariusz</a>
                        </div>
                        <div class="flex items-center border-l border-slate-700 ml-4 pl-4">
                            <button id="lang-pl" class="lang-btn active px-3 py-1 rounded-md text-xs font-bold">PL</button>
                            <button id="lang-en" class="lang-btn px-3 py-1 rounded-md text-xs font-bold">EN</button>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <section class="text-center mb-16">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-100 tracking-tight" data-i18n-key="main_headline">Zaawansowane Łączenie Modeli</h1>
                <p class="mt-4 text-lg text-slate-400 max-w-3xl mx-auto" data-i18n-key="main_subheadline">Skonsolidowany, interaktywny przewodnik po trzech odrębnych filozofiach łączenia. Wybierz wersję poniżej, aby poznać jej unikalną strategię, komponenty i przepisy.</p>
            </section>

            <div class="flex justify-center flex-wrap gap-4 mb-16 p-4 bg-slate-800/50 border border-slate-700 rounded-lg shadow-inner">
                <button id="select-sdxl" class="version-btn active px-6 py-3 rounded-md text-base font-medium" data-i18n-key="btn_version_sdxl">Wersja "Dawcy SDXL"</button>
                <button id="select-pony" class="version-btn px-6 py-3 rounded-md text-base font-medium" data-i18n-key="btn_version_pony">Wersja "Rodziny PONY"</button>
                <button id="select-hybrid" class="version-btn px-6 py-3 rounded-md text-base font-medium" data-i18n-key="btn_version_hybrid">Wersja "Hybryda PONY + SDXL"</button>
            </div>

            <div id="sdxl-content">
                <section id="sdxl-blueprints" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="sdxl_b_title">Schemat: Strategia Dawcy SDXL</h2>
                    <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="sdxl_b_desc">Ta strategia wykorzystuje stabilny model-hosta w stylu anime i chirurgicznie wstrzykuje określone "umiejętności" (takie jak styl lub treść tematyczną) od architektonicznie różnych dawców `SDXL 1.0` za pomocą algorytmu DARE-TIES. Jest to podobne do przeszczepu organu, wymagającego precyzji w celu zapewnienia zgodności.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card p-6 flex flex-col"><a href="https://civitai.com/models/1353314?modelVersionId=1984137" target="_blank" class="hover:underline"><h3 class="font-bold text-lg text-slate-100">Animij [Illustrious] V5.0</h3></a><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="sdxl_b_card1_role">Główny Model Host</p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl_b_card1_desc">Zapewnia fundamentalne rusztowanie: doskonałą anatomię, kompozycję i żywy styl retro anime.</p></div>
                        <div class="card p-6 flex flex-col"><a href="https://civitai.com/models/1721372?modelVersionId=1948027" target="_blank" class="hover:underline"><h3 class="font-bold text-lg text-slate-100">Graycolor SemiRealIllustMix</h3></a><p class="text-sm font-medium text-indigo-400 mb-2" data-i18n-key="sdxl_b_card2_role">Drugorzędny Model Host</p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl_b_card2_desc">Działa jako pomost, łącząc czysty wygląd anime z półrealistycznym odczuciem, aby uczynić hosta bardziej podatnym na dawców.</p></div>
                        <div class="card p-6 flex flex-col"><a href="https://civitai.com/models/163139?modelVersionId=481390" target="_blank" class="hover:underline"><h3 class="font-bold text-lg text-slate-100">Boomer Art Model v2.0</h3></a><p class="text-sm font-medium text-amber-400 mb-2" data-i18n-key="sdxl_b_card3_role">Główny Dawca Stylu</p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl_b_card3_desc">Wstrzykuje malarską, heroiczną esencję fantasy w stylu Frazetty i Vallejo, zapewniając pożądane wykończenie tekstur.</p></div>
                        <div class="card p-6 flex flex-col ring-2 ring-red-500/50"><a href="https://civitai.com/models/1655833/d34dch4nn3lsdxl?modelVersionId=1874216" target="_blank" class="hover:underline"><h3 class="font-bold text-lg text-slate-100">D34D.CH4NN3L.SDXL</h3></a><p class="text-sm font-medium text-red-400 mb-2" data-i18n-key="sdxl_b_card4_role">Dawca Tematyczny</p><p class="text-sm text-slate-400 flex-grow" data-i18n-key="sdxl_b_card4_desc">Potężny i wszechstronny dawca do wstrzykiwania mrocznych, surowych, horrorowych i fantastycznonaukowych treści tematycznych.</p></div>
                    </div>
                </section>
                <section id="sdxl-recipes" class="mb-24 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="sdxl_r_title">Przepis i Implementacja: Dawca SDXL</h2>
                    <div class="card p-6 md:p-8 mb-12">
                        <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="sdxl_r_s1_title">Etap 1: Tworzenie Hosta (Łączenie z wagami bloków)</h3>
                        <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl_r_s1_desc">Najpierw tworzymy solidny model-hosta, łącząc nasze dwa modele bazowe. Wybierz jeden z trzech alternatywnych przepisów poniżej. Każdy oferuje inny strategiczny kompromis między spójnością strukturalną a elastycznością stylistyczną.</p>
                        <div class="flex justify-center flex-wrap gap-4 mb-6">
                            <button id="recipe-sdxl-balanced" class="recipe-btn active px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl_r_btn_a">Przepis A: Zrównoważony (Domyślny)</button>
                            <button id="recipe-sdxl-host_dominant" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl_r_btn_b">Przepis B: Z dominacją Hosta</button>
                            <button id="recipe-sdxl-donor_receptive" class="recipe-btn px-4 py-2 rounded-md text-sm font-medium" data-i18n-key="sdxl_r_btn_c">Przepis C: Podatny na Dawcę</button>
                        </div>
                        <div id="sdxl-recipe-explanation" class="mb-6 p-4 bg-indigo-900/30 border border-indigo-500/50 text-indigo-200 rounded-md text-sm"></div>
                        <div class="chart-container"><canvas id="sdxlChart"></canvas></div>
                        <div id="sdxl-justification" class="mt-6 p-4 bg-slate-800 rounded-md text-sm text-slate-400 min-h-[60px]" data-i18n-key="chart_hover_prompt">Najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie jego wagi.</div>
                    </div>
                    <div class="card p-6 md:p-8 mb-12">
                         <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="sdxl_r_s2_title">Etap 2: Wstrzykiwanie umiejętności (DARE-TIES)</h3>
                         <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl_r_s2_desc">Dwóch dawców `SDXL 1.0` jest wstrzykiwanych sekwencyjnie do hosta z Etapu 1. Ten chirurgiczny proces wykorzystuje węzeł `TIES Merge (DARE)` z pakietu `ComfyUI-DareMerge`, aby przeszczepić tylko najważniejsze aspekty modeli dawców.</p>
                         <div class="grid md:grid-cols-1 gap-8">
                              <div class="dare-panel">
                                   <h4 class="font-bold text-lg text-slate-200 mb-4 text-center" data-i18n-key="sdxl_r_s2a_title">Krok 2a: Wstrzyknij styl malarski</h4>
                                   <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                        <div class="space-y-4">
                                             <h5 class="text-sm font-semibold text-indigo-300" data-i18n-key="dare_inputs">WEJŚCIA</h5>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_host_a">Host (model_a):</strong> <span data-i18n-key="sdxl_r_s2a_host">Host z Etapu 1</span></p>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_donor_b">Dawca (model_b):</strong> Boomer Art Model</p>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_host_base">Baza Hosta:</strong> kohaku-xl-beta5.safetensors</p>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_donor_base">Baza Dawcy:</strong> sd_xl_base_1.0.safetensors</p>
                                        </div>
                                        <div class="space-y-4">
                                             <h5 class="text-sm font-semibold text-amber-300" data-i18n-key="dare_settings">GŁÓWNE USTAWIENIA</h5>
                                             <div><label class="text-xs font-medium text-slate-300" data-i18n-key="dare_density">Gęstość DARE: 0.45</label><div class="w-full bg-slate-700 rounded-full h-2 mt-1"><div class="bg-amber-500 h-2 rounded-full" style="width: 45%"></div></div></div>
                                             <div><label class="text-xs font-medium text-slate-300" data-i18n-key="dare_trim">Przycinanie TIES (ties_trim_n): 0.20</label><div class="w-full bg-slate-700 rounded-full h-2 mt-1"><div class="bg-amber-500 h-2 rounded-full" style="width: 20%"></div></div></div>
                                        </div>
                                   </div>
                                   <div class="mt-6 pt-4 border-t border-slate-700">
                                        <h5 class="text-sm font-semibold text-slate-300 mb-2" data-i18n-key="dare_rationale">Uzasadnienie</h5>
                                        <p class="text-xs text-slate-400" data-i18n-key="sdxl_r_s2a_rationale">To jest zrównoważone wstrzyknięcie stylu. `Gęstość` 0.45 przycina ponad połowę zmian parametrów, zapobiegając uszkodzeniu struktury hosta. `ties_trim_n` 0.20 wybiera następnie tylko 20% najsilniejszych wektorów z pozostałych, zapewniając przeszczepienie tylko najsilniejszej esencji stylu malarskiego.</p>
                                   </div>
                              </div>
                              <div class="dare-panel">
                                   <h4 class="font-bold text-lg text-slate-200 mb-4 text-center" data-i18n-key="sdxl_r_s2b_title">Krok 2b: Wstrzyknij treść tematyczną</h4>
                                   <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                        <div class="space-y-4">
                                             <h5 class="text-sm font-semibold text-indigo-300" data-i18n-key="dare_inputs_2">WEJŚCIA</h5>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_host_a_2">Host (model_a):</strong> <span data-i18n-key="sdxl_r_s2b_host">Wynik z Kroku 2a</span></p>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_donor_b_2">Dawca (model_b):</strong> D34D.CH4NN3L.SDXL</p>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_host_base_2">Baza Hosta:</strong> kohaku-xl-beta5.safetensors</p>
                                             <p class="text-xs flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-in-right mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1.5-.5h8a.5.5 0 0 1.5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0.708.708z"/></svg><strong class="text-slate-300" data-i18n-key="dare_donor_base_2">Baza Dawcy:</strong> sd_xl_base_1.0.safetensors</p>
                                        </div>
                                        <div class="space-y-4">
                                             <h5 class="text-sm font-semibold text-red-300" data-i18n-key="dare_settings_2">GŁÓWNE USTAWIENIA</h5>
                                             <div><label class="text-xs font-medium text-slate-300" data-i18n-key="dare_density_2">Gęstość DARE: 0.25</label><div class="w-full bg-slate-700 rounded-full h-2 mt-1"><div class="bg-red-500 h-2 rounded-full" style="width: 25%"></div></div></div>
                                             <div><label class="text-xs font-medium text-slate-300" data-i18n-key="dare_trim_2">Przycinanie TIES (ties_trim_n): 0.25</label><div class="w-full bg-slate-700 rounded-full h-2 mt-1"><div class="bg-red-500 h-2 rounded-full" style="width: 25%"></div></div></div>
                                        </div>
                                   </div>
                                   <div class="mt-6 pt-4 border-t border-slate-700">
                                        <h5 class="text-sm font-semibold text-slate-300 mb-2" data-i18n-key="dare_rationale_2">Uzasadnienie</h5>
                                        <p class="text-xs text-slate-400" data-i18n-key="sdxl_r_s2b_rationale">To jest bardziej delikatny przeszczep tematyczny. Niższa `gęstość` (0.25) i wyższe `ties_trim_n` (0.25) stosują szerszy, ale mniej agresywny zestaw zmian. Jest to idealne do dodawania treści koncepcyjnych (mroczne, surowe motywy) bez przytłaczania już ustalonego stylu malarskiego i bazy anatomicznej.</p>
                                   </div>
                              </div>
                         </div>
                    </div>
                    <div class="card p-8">
                       <h3 class="text-xl font-bold text-slate-100 mb-4" data-i18n-key="sdxl_r_s3_title">Montaż: Wersja Dawcy SDXL</h3>
                       <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl_r_s3_desc">Strategia CLIP i VAE dla tej wersji musi uwzględniać różne rodziny architektoniczne, aby zapewnić, że model rozumie prompty i prawidłowo renderuje kolory.</p>
                       <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="sdxl_r_s3_clip_title">Tworzenie Dwujęzycznego CLIP</h4>
                                 <p class="text-sm text-slate-400 mb-4" data-i18n-key="sdxl_r_s3_clip_desc">Aby zapobiec "zderzeniu leksykonów" między tagami Danbooru hostów a naturalnym językiem dawców, tworzymy "dwujęzyczny" CLIP poprzez sekwencyjne, trójetapowe łączenie.</p>
                                 <div class="flex flex-col space-y-2 text-center text-xs font-semibold">
                                      <div class="p-2 border border-indigo-500/50 rounded-lg bg-indigo-900/20"><p class="font-medium mb-1 text-indigo-300" data-i18n-key="sdxl_r_s3_clip1_title">1. HOST CLIP</p><div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">Animij</div><div class="text-slate-400">+</div><div class="p-2 bg-indigo-500/30 rounded-md text-indigo-200">Graycolor</div></div><div class="self-center mt-1 text-slate-400">↓ <span class="font-normal">(50/50)</span></div></div>
                                      <div class="p-2 border border-amber-500/50 rounded-lg bg-amber-900/20"><p class="font-medium mb-1 text-amber-300" data-i18n-key="sdxl_r_s3_clip2_title">2. DONOR CLIP</p><div class="flex justify-around items-center"><div class="p-2 bg-amber-500/30 rounded-md text-amber-200">Boomer Art</div><div class="text-slate-400">+</div><div class="p-2 bg-red-500/30 rounded-md text-red-200">D34D.CH4NN3L</div></div><div class="self-center mt-1 text-slate-400">↓ <span class="font-normal">(50/50)</span></div></div>
                                      <div class="p-2 border border-slate-500 rounded-lg bg-slate-800/30"><p class="font-medium mb-1 text-slate-300" data-i18n-key="sdxl_r_s3_clip3_title">3. FINAŁOWE POŁĄCZENIE</p><div class="flex justify-around items-center"><div class="p-2 bg-indigo-500/50 rounded-md text-indigo-100" data-i18n-key="sdxl_r_s3_clip3_host">Połączenie Hosta</div><div class="text-slate-400 font-thin text-xl">+</div><div class="p-2 bg-amber-500/50 rounded-md text-amber-100" data-i18n-key="sdxl_r_s3_clip3_donor">Połączenie Dawcy</div></div><div class="self-center mt-1 text-slate-400">↓ <span class="font-normal" data-i18n-key="sdxl_r_s3_clip3_weights">(65% Host / 35% Dawca)</span></div><div class="p-3 bg-slate-200 rounded-lg text-slate-900 mx-auto mt-2" data-i18n-key="sdxl_r_s3_clip3_final">Finałowy Dwujęzyczny CLIP</div></div>
                                 </div>
                            </div>
                            <div>
                                 <h4 class="font-bold text-lg text-slate-200 mb-4" data-i18n-key="sdxl_r_s3_vae_title">Wybór VAE dla Wierności</h4>
                                 <p class="text-sm text-slate-400 mb-6" data-i18n-key="sdxl_r_s3_vae_desc">Łączenie VAE z różnych rodzin jest bardzo ryzykowne. Aby zapewnić maksymalną wierność kolorów i zapobiec artefaktom, nie łączymy ich. Oryginalny VAE hosta jest najbezpieczniejszym wyborem.</p>
                                 <div class="bg-indigo-900/30 border-2 border-dashed border-indigo-500/50 p-4 rounded-lg text-center">
                                      <p class="font-semibold text-indigo-200" data-i18n-key="sdxl_r_s3_vae_rec_title">Główna Rekomendacja</p>
                                      <p class="text-indigo-300" data-i18n-key="sdxl_r_s3_vae_rec_model">Użyj VAE wbudowanego w `Animij [Illustrious] V5.0`.</p>
                                      <p class="text-xs mt-2 text-indigo-400" data-i18n-key="sdxl_r_s3_vae_rec_rationale">Zapewnia to, że ostateczny obraz jest dekodowany przez VAE idealnie dopasowany do podstawowej architektury hosta.</p>
                                 </div>
                            </div>
                       </div>
                    </div>
                </section>
            </div>

            <div id="pony-content" class="hidden">
                </div>
            
            <div id="hybrid-content" class="hidden">
                 </div>

            <section id="analysis" class="mb-24 scroll-mt-20">
                <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="analysis_title">Analiza Porównawcza Strategii</h2>
                <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="analysis_desc">Każda z trzech strategii łączenia reprezentuje odmienną filozofię i zestaw kompromisów. Zrozumienie ich mocnych i słabych stron jest kluczem do wyboru odpowiedniej metody dla pożądanego rezultatu artystycznego i technicznego.</p>
                </section>

            <section id="glossary" class="scroll-mt-20">
                <h2 class="text-3xl font-bold text-slate-100 mb-2" data-i18n-key="glossary_title">Glosariusz Terminów</h2>
                <p class="text-slate-400 mb-10 max-w-4xl" data-i18n-key="glossary_desc">Poniżej zdefiniowano kluczowe terminy techniczne używane w tym przewodniku, aby zapewnić jasność i zrozumienie dla wszystkich użytkowników.</p>
                </section>

        </main>
    </div>

<script>
// WebGL Background Shader (unchanged)
const canvas = document.getElementById('shader-canvas');
const gl = canvas.getContext('webgl');
let time = 0;
let buffer;
const vertexShader = `
attribute vec2 a_position;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
}`;
const fragmentShader = `
precision highp float;
uniform vec2 u_resolution;
uniform float u_time;

float random (in vec2 _st) {
    return fract(sin(dot(_st.xy, vec2(12.9898,78.233))) * 43758.5453123);
}

float noise (in vec2 _st) {
    vec2 i = floor(_st);
    vec2 f = fract(_st);
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));
    vec2 u = f * f * (3.0 - 2.0 * f);
    return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
}

#define NUM_OCTAVES 5
float fbm ( in vec2 _st) {
    float v = 0.0;
    float a = 0.5;
    vec2 shift = vec2(100.0);
    mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));
    for (int i = 0; i < NUM_OCTAVES; ++i) {
        v += a * noise(_st);
        _st = rot * _st * 2.0 + shift;
        a *= 0.5;
    }
    return v;
}

void main() {
    vec2 st = gl_FragCoord.xy/u_resolution.xy;
    st.x *= u_resolution.x/u_resolution.y;
    vec3 color = vec3(0.0);
    vec2 q = vec2(0.);
    q.x = fbm( st + 0.00*u_time);
    q.y = fbm( st + vec2(1.0));
    vec2 r = vec2(0.);
    r.x = fbm( st + 1.0*q + vec2(1.7,9.2)+ 0.15*u_time );
    r.y = fbm( st + 1.0*q + vec2(8.3,2.8)+ 0.126*u_time);
    float f = fbm(st+r);
    color = mix(vec3(0.101961,0.0921568,0.2313725),
                vec3(0.2666667,0.2666667,0.6980392),
                clamp((f*f)*4.0,0.0,1.0));
    color = mix(color,
                vec3(0.0,0.0,0.1647059),
                clamp(length(q),0.0,1.0));
    color = mix(color,
                vec3(0.6666667,0.6666667,0.9803922),
                clamp(length(r.x),0.0,1.0));
    gl_FragColor = vec4((f*f*f+.6*f*f+.5*f)*color,1.);
}`;

function render() {
    if (!gl) return;
    time += 0.002;
    gl.clear(gl.COLOR_BUFFER_BIT);
    gl.uniform1f(gl.getUniformLocation(program, "u_time"), time);
    gl.drawArrays(gl.TRIANGLES, 0, 6);
    requestAnimationFrame(render);
}

function setup() {
    if (!gl) return;
    const vertex = gl.createShader(gl.VERTEX_SHADER);
    gl.shaderSource(vertex, vertexShader);
    gl.compileShader(vertex);
    const fragment = gl.createShader(gl.FRAGMENT_SHADER);
    gl.shaderSource(fragment, fragmentShader);
    gl.compileShader(fragment);
    const program = gl.createProgram();
    gl.attachShader(program, vertex);
    gl.attachShader(program, fragment);
    gl.linkProgram(program);
    gl.useProgram(program);
    buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1, -1, 1, 1, -1]), gl.STATIC_DRAW);
    const position = gl.getAttribLocation(program, "a_position");
    gl.enableVertexAttribArray(position);
    gl.vertexAttribPointer(position, 2, gl.FLOAT, false, 0, 0);
    gl.uniform2f(gl.getUniformLocation(program, "u_resolution"), canvas.width, canvas.height);
    return program;
}

function resize() {
    if (!gl) return;
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
    gl.uniform2f(gl.getUniformLocation(program, "u_resolution"), canvas.width, canvas.height);
}

const program = setup();
if (program) {
    window.addEventListener("resize", resize);
    resize();
    render();
}
// --- End of WebGL Background Shader ---

// --- Internationalization (i18n) and Application Logic ---
const translations = {
    en: {
        page_title: "Interactive Guide: Advanced Model Merging (Triple Strategy)",
        nav_title: "Model Merging Guide",
        nav_blueprints: "Blueprints",
        nav_recipes: "Recipes",
        nav_analysis: "Analysis",
        nav_glossary: "Glossary",
        main_headline: "Advanced Model Merging",
        main_subheadline: "A consolidated, interactive guide to three distinct merging philosophies. Select a version below to explore its unique strategy, components, and recipes.",
        btn_version_sdxl: '"SDXL Donor" Version',
        btn_version_pony: '"PONY Family" Version',
        btn_version_hybrid: '"PONY + SDXL Hybrid" Version',
        chart_hover_prompt: "Hover over a block on the chart to see the rationale for its weight.",
        
        // SDXL Version Content
        sdxl_b_title: "Blueprint: SDXL Donor Strategy",
        sdxl_b_desc: "This strategy uses a stable, anime-style host model and surgically injects specific 'skills' (like style or thematic content) from architecturally different `SDXL 1.0` donors using the DARE-TIES algorithm. This is akin to an organ transplant, requiring precision to ensure compatibility.",
        sdxl_b_card1_role: "Primary Host Model",
        sdxl_b_card1_desc: "Provides the fundamental scaffolding: excellent anatomy, composition, and a vibrant retro anime style.",
        sdxl_b_card2_role: "Secondary Host Model",
        sdxl_b_card2_desc: "Acts as a bridge, blending the clean anime look with a semi-realistic feel to make the host more receptive to donors.",
        sdxl_b_card3_role: "Primary Style Donor",
        sdxl_b_card3_desc: "Injects a painterly, heroic fantasy essence in the style of Frazetta and Vallejo, providing the desired textural finish.",
        sdxl_b_card4_role: "Thematic Donor",
        sdxl_b_card4_desc: "A powerful and versatile donor for injecting dark, gritty, horror, and sci-fi thematic content.",
        sdxl_r_title: "Recipe & Implementation: SDXL Donor",
        sdxl_r_s1_title: "Stage 1: Host Creation (Block Weight Merge)",
        sdxl_r_s1_desc: "First, we create a robust host model by merging our two base models. Choose one of the three alternative recipes below. Each offers a different strategic trade-off between structural coherence and stylistic flexibility.",
        sdxl_r_btn_a: "Recipe A: Balanced (Default)",
        sdxl_r_btn_b: "Recipe B: Host-Dominant",
        sdxl_r_btn_c: "Recipe C: Donor-Receptive",
        sdxl_r_s2_title: "Stage 2: Skill Injection (DARE-TIES)",
        sdxl_r_s2_desc: "Two `SDXL 1.0` donors are sequentially injected into the Stage 1 host. This surgical process uses the `TIES Merge (DARE)` node from the `ComfyUI-DareMerge` package to transplant only the most essential aspects of the donor models.",
        dare_inputs: "INPUTS",
        dare_host_a: "Host (model_a):",
        sdxl_r_s2a_host: "Host from Stage 1",
        dare_donor_b: "Donor (model_b):",
        dare_host_base: "Host Base:",
        dare_donor_base: "Donor Base:",
        dare_settings: "CORE SETTINGS",
        dare_density: "DARE Density: 0.45",
        dare_trim: "TIES Trimming (ties_trim_n): 0.20",
        dare_rationale: "Rationale",
        sdxl_r_s2a_title: "Step 2a: Inject Painterly Style",
        sdxl_r_s2a_rationale: "This is a balanced style injection. A `density` of 0.45 prunes over half the parameter changes, preventing corruption of the host's structure. `ties_trim_n` of 0.20 then selects only the top 20% strongest vectors from the remainder, ensuring only the most potent essence of the painterly style is transplanted.",
        sdxl_r_s2b_title: "Step 2b: Inject Thematic Content",
        dare_inputs_2: "INPUTS",
        dare_host_a_2: "Host (model_a):",
        sdxl_r_s2b_host: "Output from Step 2a",
        dare_donor_b_2: "Donor (model_b):",
        dare_host_base_2: "Host Base:",
        dare_donor_base_2: "Donor Base:",
        dare_settings_2: "CORE SETTINGS",
        dare_density_2: "DARE Density: 0.25",
        dare_trim_2: "TIES Trimming (ties_trim_n): 0.25",
        dare_rationale_2: "Rationale",
        sdxl_r_s2b_rationale: "This is a more delicate thematic transplant. The lower `density` (0.25) and higher `ties_trim_n` (0.25) apply a broader but less aggressive set of changes. This is ideal for adding conceptual content (dark, gritty themes) without overwhelming the already established painterly style and anatomical base.",
        sdxl_r_s3_title: "Assembly: SDXL Donor Version",
        sdxl_r_s3_desc: "The CLIP and VAE strategy for this version must account for the different architectural families to ensure the model understands prompts and renders colors correctly.",
        sdxl_r_s3_clip_title: "Creating a Bilingual CLIP",
        sdxl_r_s3_clip_desc: "To prevent 'lexicon collision' between the hosts' Danbooru tags and the donors' natural language, we create a 'bilingual' CLIP via a sequential, three-step merge.",
        sdxl_r_s3_clip1_title: "1. HOST CLIP",
        sdxl_r_s3_clip2_title: "2. DONOR CLIP",
        sdxl_r_s3_clip3_title: "3. FINAL MERGE",
        sdxl_r_s3_clip3_host: "Host Merge",
        sdxl_r_s3_clip3_donor: "Donor Merge",
        sdxl_r_s3_clip3_weights: "(65% Host / 35% Donor)",
        sdxl_r_s3_clip3_final: "Final Bilingual CLIP",
        sdxl_r_s3_vae_title: "VAE Selection for Fidelity",
        sdxl_r_s3_vae_desc: "Merging VAEs from different families is highly risky. To ensure maximum color fidelity and prevent artifacts, we do not merge them. The host's original VAE is the safest choice.",
        sdxl_r_s3_vae_rec_title: "Primary Recommendation",
        sdxl_r_s3_vae_rec_model: "Use the VAE baked into `Animij [Illustrious] V5.0`.",
        sdxl_r_s3_vae_rec_rationale: "This ensures the final image is decoded by a VAE perfectly matched to the host's core architecture.",
        
        // Chart Data (SDXL)
        sdxl_recipe_explanations: {
            balanced: "<strong>Recipe A (Balanced):</strong> A blend favoring the Primary Host (Animij) in the early and late blocks for structural and stylistic coherence, while giving the Secondary Host (Graycolor) more influence in the mid-blocks to introduce semi-realism.",
            host_dominant: "<strong>Recipe B (Host-Dominant):</strong> This recipe heavily favors the Primary Host (Animij) across all blocks, using the Secondary Host (Graycolor) only sparingly to add subtle semi-realistic nuances without altering the core anime style.",
            donor_receptive: "<strong>Recipe C (Donor-Receptive):</strong> This recipe gives more weight to the Secondary Host (Graycolor), creating a softer, more blended base that is more stylistically flexible and receptive to the characteristics of the donors to be injected later."
        },
        sdxl_chart: {
            labels:,
            datasets: {
                balanced: [0.8, 0.7, 0.6, 0.5, 0.4, 0.4, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.6, 0.9, 0.8, 0.7, 0.6, 0.5, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.0],
                host_dominant: [0.9, 0.85, 0.8, 0.75, 0.7, 0.7, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 0.8, 0.95, 0.9, 0.85, 0.8, 0.75, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0],
                donor_receptive: [0.7, 0.6, 0.5, 0.4, 0.3, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.5, 0.8, 0.7, 0.6, 0.5, 0.4, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
            },
            justifications:
        },
        
        // Common Analysis & Glossary
        analysis_title: "Comparative Strategy Analysis",
        analysis_desc: "Each of the three merging strategies represents a different philosophy and set of trade-offs. Understanding their strengths and weaknesses is key to choosing the right method for the desired artistic and technical outcome.",
        glossary_title: "Glossary of Terms",
        glossary_desc: "Key technical terms used throughout this guide are defined below to ensure clarity and comprehension for all users."
    },
    pl: {
        page_title: "Interaktywny przewodnik: Zaawansowane łączenie modeli (Potrójna strategia)",
        nav_title: "Przewodnik po Łączeniu Modeli",
        nav_blueprints: "Schematy",
        nav_recipes: "Przepisy",
        nav_analysis: "Analiza",
        nav_glossary: "Glosariusz",
        main_headline: "Zaawansowane Łączenie Modeli",
        main_subheadline: "Skonsolidowany, interaktywny przewodnik po trzech odrębnych filozofiach łączenia. Wybierz wersję poniżej, aby poznać jej unikalną strategię, komponenty i przepisy.",
        btn_version_sdxl: 'Wersja "Dawcy SDXL"',
        btn_version_pony: 'Wersja "Rodziny PONY"',
        btn_version_hybrid: 'Wersja "Hybryda PONY + SDXL"',
        chart_hover_prompt: "Najedź kursorem na blok na wykresie, aby zobaczyć uzasadnienie jego wagi.",

        // SDXL Version Content
        sdxl_b_title: "Schemat: Strategia Dawcy SDXL",
        sdxl_b_desc: "Ta strategia wykorzystuje stabilny model-hosta w stylu anime i chirurgicznie wstrzykuje określone \"umiejętności\" (takie jak styl lub treść tematyczną) od architektonicznie różnych dawców `SDXL 1.0` za pomocą algorytmu DARE-TIES. Jest to podobne do przeszczepu organu, wymagającego precyzji w celu zapewnienia zgodności.",
        sdxl_b_card1_role: "Główny Model Host",
        sdxl_b_card1_desc: "Zapewnia fundamentalne rusztowanie: doskonałą anatomię, kompozycję i żywy styl retro anime.",
        sdxl_b_card2_role: "Drugorzędny Model Host",
        sdxl_b_card2_desc: "Działa jako pomost, łącząc czysty wygląd anime z półrealistycznym odczuciem, aby uczynić hosta bardziej podatnym na dawców.",
        sdxl_b_card3_role: "Główny Dawca Stylu",
        sdxl_b_card3_desc: "Wstrzykuje malarską, heroiczną esencję fantasy w stylu Frazetty i Vallejo, zapewniając pożądane wykończenie tekstur.",
        sdxl_b_card4_role: "Dawca Tematyczny",
        sdxl_b_card4_desc: "Potężny i wszechstronny dawca do wstrzykiwania mrocznych, surowych, horrorowych i fantastycznonaukowych treści tematycznych.",
        sdxl_r_title: "Przepis i Implementacja: Dawca SDXL",
        sdxl_r_s1_title: "Etap 1: Tworzenie Hosta (Łączenie z wagami bloków)",
        sdxl_r_s1_desc: "Najpierw tworzymy solidny model-hosta, łącząc nasze dwa modele bazowe. Wybierz jeden z trzech alternatywnych przepisów poniżej. Każdy oferuje inny strategiczny kompromis między spójnością strukturalną a elastycznością stylistyczną.",
        sdxl_r_btn_a: "Przepis A: Zrównoważony (Domyślny)",
        sdxl_r_btn_b: "Przepis B: Z dominacją Hosta",
        sdxl_r_btn_c: "Przepis C: Podatny na Dawcę",
        sdxl_r_s2_title: "Etap 2: Wstrzykiwanie umiejętności (DARE-TIES)",
        sdxl_r_s2_desc: "Dwóch dawców `SDXL 1.0` jest wstrzykiwanych sekwencyjnie do hosta z Etapu 1. Ten chirurgiczny proces wykorzystuje węzeł `TIES Merge (DARE)` z pakietu `ComfyUI-DareMerge`, aby przeszczepić tylko najważniejsze aspekty modeli dawców.",
        dare_inputs: "WEJŚCIA",
        dare_host_a: "Host (model_a):",
        sdxl_r_s2a_host: "Host z Etapu 1",
        dare_donor_b: "Dawca (model_b):",
        dare_host_base: "Baza Hosta:",
        dare_donor_base: "Baza Dawcy:",
        dare_settings: "GŁÓWNE USTAWIENIA",
        dare_density: "Gęstość DARE: 0.45",
        dare_trim: "Przycinanie TIES (ties_trim_n): 0.20",
        dare_rationale: "Uzasadnienie",
        sdxl_r_s2a_title: "Krok 2a: Wstrzyknij styl malarski",
        sdxl_r_s2a_rationale: "To jest zrównoważone wstrzyknięcie stylu. `Gęstość` 0.45 przycina ponad połowę zmian parametrów, zapobiegając uszkodzeniu struktury hosta. `ties_trim_n` 0.20 wybiera następnie tylko 20% najsilniejszych wektorów z pozostałych, zapewniając przeszczepienie tylko najsilniejszej esencji stylu malarskiego.",
        sdxl_r_s2b_title: "Krok 2b: Wstrzyknij treść tematyczną",
        dare_inputs_2: "WEJŚCIA",
        dare_host_a_2: "Host (model_a):",
        sdxl_r_s2b_host: "Wynik z Kroku 2a",
        dare_donor_b_2: "Dawca (model_b):",
        dare_host_base_2: "Baza Hosta:",
        dare_donor_base_2: "Baza Dawcy:",
        dare_settings_2: "GŁÓWNE USTAWIENIA",
        dare_density_2: "Gęstość DARE: 0.25",
        dare_trim_2: "Przycinanie TIES (ties_trim_n): 0.25",
        dare_rationale_2: "Uzasadnienie",
        sdxl_r_s2b_rationale: "To jest bardziej delikatny przeszczep tematyczny. Niższa `gęstość` (0.25) i wyższe `ties_trim_n` (0.25) stosują szerszy, ale mniej agresywny zestaw zmian. Jest to idealne do dodawania treści koncepcyjnych (mroczne, surowe motywy) bez przytłaczania już ustalonego stylu malarskiego i bazy anatomicznej.",
        sdxl_r_s3_title: "Montaż: Wersja Dawcy SDXL",
        sdxl_r_s3_desc: "Strategia CLIP i VAE dla tej wersji musi uwzględniać różne rodziny architektoniczne, aby zapewnić, że model rozumie prompty i prawidłowo renderuje kolory.",
        sdxl_r_s3_clip_title: "Tworzenie Dwujęzycznego CLIP",
        sdxl_r_s3_clip_desc: "Aby zapobiec \"zderzeniu leksykonów\" między tagami Danbooru hostów a naturalnym językiem dawców, tworzymy \"dwujęzyczny\" CLIP poprzez sekwencyjne, trójetapowe łączenie.",
        sdxl_r_s3_clip1_title: "1. HOST CLIP",
        sdxl_r_s3_clip2_title: "2. DONOR CLIP",
        sdxl_r_s3_clip3_title: "3. FINAŁOWE POŁĄCZENIE",
        sdxl_r_s3_clip3_host: "Połączenie Hosta",
        sdxl_r_s3_clip3_donor: "Połączenie Dawcy",
        sdxl_r_s3_clip3_weights: "(65% Host / 35% Dawca)",
        sdxl_r_s3_clip3_final: "Finałowy Dwujęzyczny CLIP",
        sdxl_r_s3_vae_title: "Wybór VAE dla Wierności",
        sdxl_r_s3_vae_desc: "Łączenie VAE z różnych rodzin jest bardzo ryzykowne. Aby zapewnić maksymalną wierność kolorów i zapobiec artefaktom, nie łączymy ich. Oryginalny VAE hosta jest najbezpieczniejszym wyborem.",
        sdxl_r_s3_vae_rec_title: "Główna Rekomendacja",
        sdxl_r_s3_vae_rec_model: "Użyj VAE wbudowanego w `Animij [Illustrious] V5.0`.",
        sdxl_r_s3_vae_rec_rationale: "Zapewnia to, że ostateczny obraz jest dekodowany przez VAE idealnie dopasowany do podstawowej architektury hosta.",

        // Chart Data (SDXL)
        sdxl_recipe_explanations: {
            balanced: "<strong>Przepis A (Zrównoważony):</strong> Mieszanka faworyzująca Głównego Hosta (Animij) we wczesnych i późnych blokach dla spójności strukturalnej i stylistycznej, jednocześnie dając Drugorzędnemu Hostowi (Graycolor) większy wpływ w środkowych blokach w celu wprowadzenia półrealizmu.",
            host_dominant: "<strong>Przepis B (Z dominacją Hosta):</strong> Ten przepis mocno faworyzuje Głównego Hosta (Animij) we wszystkich blokach, używając Drugorzędnego Hosta (Graycolor) tylko oszczędnie, aby dodać subtelne półrealistyczne niuanse bez zmiany podstawowego stylu anime.",
            donor_receptive: "<strong>Przepis C (Podatny na Dawcę):</strong> Ten przepis daje większą wagę Drugorzędnemu Hostowi (Graycolor), tworząc bardziej miękką, zmieszaną bazę, która jest bardziej elastyczna stylistycznie i podatna na cechy dawców, które zostaną wstrzyknięte później."
        },
        sdxl_chart: {
            labels:,
            datasets: {
                balanced: [0.8, 0.7, 0.6, 0.5, 0.4, 0.4, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.6, 0.9, 0.8, 0.7, 0.6, 0.5, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.0],
                host_dominant: [0.9, 0.85, 0.8, 0.75, 0.7, 0.7, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 0.8, 0.95, 0.9, 0.85, 0.8, 0.75, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0],
                donor_receptive: [0.7, 0.6, 0.5, 0.4, 0.3, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.5, 0.8, 0.7, 0.6, 0.5, 0.4, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
            },
            justifications:
        },

        // Common Analysis & Glossary
        analysis_title: "Analiza Porównawcza Strategii",
        analysis_desc: "Każda z trzech strategii łączenia reprezentuje odmienną filozofię i zestaw kompromisów. Zrozumienie ich mocnych i słabych stron jest kluczem do wyboru odpowiedniej metody dla pożądanego rezultatu artystycznego i technicznego.",
        glossary_title: "Glosariusz Terminów",
        glossary_desc: "Poniżej zdefiniowano kluczowe terminy techniczne używane w tym przewodniku, aby zapewnić jasność i zrozumienie dla wszystkich użytkowników."
    }
};

let currentLanguage = 'pl';
let sdxlChartInstance;
let activeSdxlRecipe = 'balanced';

function switchLanguage(lang) {
    if (lang === currentLanguage) return;
    currentLanguage = lang;
    document.documentElement.lang = lang;

    document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.getAttribute('data-i18n-key');
        const translation = getTranslation(key);
        if (translation) {
            el.innerHTML = translation;
        }
    });

    // Update active language button
    document.getElementById('lang-pl').classList.toggle('active', lang === 'pl');
    document.getElementById('lang-en').classList.toggle('active', lang === 'en');

    // Re-render charts and update dynamic text
    updateSdxlRecipeContent(activeSdxlRecipe);
    // Add calls for other sections (Pony, Hybrid) here when they are implemented
}

function getTranslation(key) {
    const keys = key.split('.');
    let result = translations[currentLanguage];
    for (const k of keys) {
        result = result[k];
        if (result === undefined) return null;
    }
    return result;
}

function setupEventListeners() {
    document.getElementById('lang-pl').addEventListener('click', () => switchLanguage('pl'));
    document.getElementById('lang-en').addEventListener('click', () => switchLanguage('en'));

    // SDXL Recipe Buttons
    document.getElementById('recipe-sdxl-balanced').addEventListener('click', () => updateSdxlRecipeContent('balanced'));
    document.getElementById('recipe-sdxl-host_dominant').addEventListener('click', () => updateSdxlRecipeContent('host_dominant'));
    document.getElementById('recipe-sdxl-donor_receptive').addEventListener('click', () => updateSdxlRecipeContent('donor_receptive'));
}

function updateSdxlRecipeContent(recipeId) {
    activeSdxlRecipe = recipeId;

    // Update active button state
    document.querySelectorAll('#sdxl-recipes.recipe-btn').forEach(btn => {
        btn.classList.toggle('active', btn.id === `recipe-sdxl-${recipeId}`);
    });

    // Update explanation text
    const explanationEl = document.getElementById('sdxl-recipe-explanation');
    explanationEl.innerHTML = getTranslation(`sdxl_recipe_explanations.${recipeId}`);

    // Re-render chart
    renderSdxlChart(recipeId);
}

function renderSdxlChart(recipeId) {
    if (sdxlChartInstance) {
        sdxlChartInstance.destroy();
    }
    const ctx = document.getElementById('sdxlChart').getContext('2d');
    const chartData = getTranslation('sdxl_chart');
    const justifications = chartData.justifications;
    
    const justificationMap = {
        'IN00': justifications, 'IN01': justifications, 'IN02': justifications, 'IN03': justifications,
        'IN04': justifications, 'IN05': justifications, 'IN06': justifications,
        'IN07': justifications, 'IN08': justifications, 'IN09': justifications, 'IN10': justifications, 'IN11': justifications,
        'M00':  justifications,
        'OUT00': justifications, 'OUT01': justifications, 'OUT02': justifications, 'OUT03': justifications,
        'OUT04': justifications, 'OUT05': justifications,
        'OUT06': justifications, 'OUT07': justifications, 'OUT08': justifications, 'OUT09': justifications, 'OUT10': justifications, 'OUT11': justifications
    };

    sdxlChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartData.labels,
            datasets:,
                backgroundColor: 'rgba(99, 102, 241, 0.6)',
                borderColor: 'rgba(129, 140, 248, 1)',
                borderWidth: 2,
                borderRadius: 4,
            }]
        },
        options: {
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1.0,
                    ticks: { color: '#94a3b8' },
                    grid: { color: 'rgba(71, 85, 105, 0.5)' }
                },
                x: {
                    ticks: { color: '#94a3b8' },
                    grid: { display: false }
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    enabled: true,
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            let label = 'Waga Hosta: ' + context.parsed.y;
                            return label;
                        }
                    }
                }
            },
            onHover: (event, chartElement) => {
                const justificationBox = document.getElementById('sdxl-justification');
                if (chartElement.length) {
                    const index = chartElement.index;
                    const label = chartData.labels[index];
                    justificationBox.textContent = justificationMap[label] |

| getTranslation('chart_hover_prompt');
                } else {
                    justificationBox.innerHTML = getTranslation('chart_hover_prompt');
                }
            }
        }
    });
}

// Initial Load
document.addEventListener('DOMContentLoaded', () => {
    // For now, only SDXL content is fully implemented in HTML.
    // The logic for Pony and Hybrid would follow a similar pattern.
    setupEventListeners();
    switchLanguage('pl'); // Set initial language
});
</script>
</body>
</html>
