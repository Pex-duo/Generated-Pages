<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang="pageTitle">Sernik Baskijski: Przepis Definitywny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Harmony (with Dark Mode) -->
    <!-- Application Structure Plan: Retained the successful task-oriented tabbed structure. Added a global control bar for theme (Day/Night) and language (PL/EN) switching. This enhances user experience by providing customization without altering the core, intuitive workflow of the recipe application. All text content is now managed through a centralized JS object for seamless i18n. Added PDF generation functionality. -->
    <!-- Visualization & Content Choices: All visualizations and content structures are preserved but are now dynamically populated from a language-aware data source. The core logic remains the same, but the implementation is refactored to support on-the-fly language changes, including chart labels and dynamic recipe text. The addition of a dark mode theme provides a significant visual enhancement. PDF generation uses html2canvas and jsPDF for a clean, printable output. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --bg-color: #FDFBF8;
            --bg-alt-color: #FFFFFF;
            --text-color: #4A4A4A;
            --text-muted-color: #6B7280;
            --heading-color: #3D405B;
            --accent-color: #D4A373;
            --accent-text-color: #FFFFFF;
            --border-color: #E5E7EB;
            --button-inactive-bg: #F3F4F6;
            --button-inactive-text: #374151;
        }

        html.dark {
            --bg-color: #111827;
            --bg-alt-color: #1F2937;
            --text-color: #D1D5DB;
            --text-muted-color: #9CA3AF;
            --heading-color: #F9FAFB;
            --accent-color: #D4A373;
            --accent-text-color: #111827;
            --border-color: #374151;
            --button-inactive-bg: #374151;
            --button-inactive-text: #F9FAFB;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        h1, h2, h3, .font-playfair {
            font-family: 'Playfair Display', serif;
            color: var(--heading-color);
        }
        .tab-active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
            font-weight: 700;
        }
        .tab-inactive {
            border-bottom-color: transparent;
            color: var(--text-muted-color);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .accordion-button.active + .accordion-content {
            max-height: 1000px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 80vh;
        }
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
        }
        .theme-switch {
            display: inline-block;
            height: 26px;
            position: relative;
            width: 50px;
        }
        .theme-switch input {
            display:none;
        }
        .slider {
            background-color: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
        }
        .slider:before {
            background-color: #fff;
            bottom: 3px;
            content: "";
            height: 20px;
            left: 3px;
            position: absolute;
            transition: .4s;
            width: 20px;
        }
        input:checked + .slider {
            background-color: var(--accent-color);
        }
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        .slider.round {
            border-radius: 34px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        #pdf-content-wrapper {
            position: absolute;
            left: -9999px;
            top: 0;
        }
    </style>
</head>
<body class="antialiased">

    <div id="pdf-content-wrapper"></div>
    <div id="loader" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl text-center">
            <svg class="animate-spin h-8 w-8 text-gray-600 dark:text-gray-300 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="text-gray-800 dark:text-gray-200" data-lang="pdfGenerating">Generowanie PDF...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 md:py-12">

        <header class="text-center mb-4">
            <h1 class="text-4xl md:text-6xl font-bold" data-lang="mainTitle">Sernik Baskijski</h1>
            <p class="text-lg md:text-xl mt-2" data-lang="mainSubtitle" style="color: var(--text-muted-color);">Edycja Definitywna: Interaktywny Przewodnik</p>
        </header>

        <div class="flex justify-center items-center space-x-6 mb-10 md:mb-12">
            <div class="flex items-center space-x-2">
                <button id="lang-pl" class="px-3 py-1 text-sm font-bold rounded-md">üáµüá± PL</button>
                <button id="lang-en" class="px-3 py-1 text-sm font-semibold rounded-md">üá¨üáß EN</button>
            </div>
            <div class="theme-switch-wrapper">
                <span class="mr-2 text-sm">‚òÄÔ∏è</span>
                <label class="theme-switch" for="theme-toggle">
                    <input type="checkbox" id="theme-toggle" />
                    <div class="slider round"></div>
                </label>
                <span class="ml-2 text-sm">üåô</span>
            </div>
        </div>

        <div class="sticky top-0 z-10 mb-8" style="background-color: var(--bg-color); background-opacity: 0.9; backdrop-filter: blur(4px);">
            <div style="border-bottom: 1px solid var(--border-color);">
                <nav class="-mb-px flex justify-center space-x-4 md:space-x-8" aria-label="Tabs">
                    <button id="tab-przeglad" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm md:text-base transition-colors duration-300 tab-active" data-lang="tabOverview">PrzeglƒÖd</button>
                    <button id="tab-przepis" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm md:text-base transition-colors duration-300 tab-inactive" data-lang="tabRecipe">Przepis</button>
                    <button id="tab-koncepcje" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm md:text-base transition-colors duration-300 tab-inactive" data-lang="tabConcepts">Kluczowe Koncepcje</button>
                    <button id="tab-wariacje" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm md:text-base transition-colors duration-300 tab-inactive" data-lang="tabVariations">Wariacje i Porady</button>
                </nav>
            </div>
        </div>

        <main>
            <div id="content-przeglad" class="tab-content">
                <section class="max-w-4xl mx-auto text-center">
                    <h2 class="text-3xl md:text-4xl font-playfair mb-4" data-lang="overviewTitle">W Poszukiwaniu Sernika Doskona≈Çego</h2>
                    <p class="text-base md:text-lg leading-relaxed mb-6" data-lang="overviewIntro" style="color: var(--text-muted-color);"></p>
                    <div class="grid md:grid-cols-3 gap-8 text-center mt-12">
                        <div class="p-6 rounded-lg shadow-sm" style="background-color: var(--bg-alt-color); border: 1px solid var(--border-color);">
                            <h3 class="font-playfair text-xl mb-2" style="color: var(--accent-color);" data-lang="feature1Title">ChrupiƒÖcy Fundament</h3>
                            <p class="text-sm" data-lang="feature1Desc" style="color: var(--text-muted-color);"></p>
                        </div>
                        <div class="p-6 rounded-lg shadow-sm" style="background-color: var(--bg-alt-color); border: 1px solid var(--border-color);">
                            <h3 class="font-playfair text-xl mb-2" style="color: var(--accent-color);" data-lang="feature2Title">G≈Çƒôbia Smaku</h3>
                            <p class="text-sm" data-lang="feature2Desc" style="color: var(--text-muted-color);"></p>
                        </div>
                        <div class="p-6 rounded-lg shadow-sm" style="background-color: var(--bg-alt-color); border: 1px solid var(--border-color);">
                            <h3 class="font-playfair text-xl mb-2" style="color: var(--accent-color);" data-lang="feature3Title">Zdrowsza S≈Çodycz</h3>
                            <p class="text-sm" data-lang="feature3Desc" style="color: var(--text-muted-color);"></p>
                        </div>
                    </div>
                </section>
            </div>

            <div id="content-przepis" class="tab-content hidden">
                <section class="max-w-6xl mx-auto">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl md:text-4xl font-playfair mb-2" data-lang="recipeTitle">Przepis Definitywny</h2>
                        <p style="color: var(--text-muted-color);" data-lang="recipeSubtitle">Dostosuj ilo≈õƒá sk≈Çadnik√≥w do swojej formy i postƒôpuj zgodnie z instrukcjƒÖ.</p>
                        <div class="mt-4 flex justify-center items-center space-x-4">
                            <span class="text-sm font-medium" data-lang="formSizeLabel">Rozmiar formy:</span>
                            <button id="size-23" class="px-4 py-2 text-sm font-semibold rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2" style="background-color: var(--accent-color); color: var(--accent-text-color); border-color: var(--accent-color);">23-24 cm</button>
                            <button id="size-28" class="px-4 py-2 text-sm font-semibold rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2" style="background-color: var(--button-inactive-bg); color: var(--button-inactive-text); border-color: var(--button-inactive-bg);">28 cm</button>
                            <button id="generate-pdf" class="ml-4 px-3 py-2 text-sm font-semibold rounded-md shadow-sm flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-offset-2" style="background-color: var(--accent-color); color: var(--accent-text-color); border-color: var(--accent-color);">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm4 14a1 1 0 100-2 1 1 0 000 2zM8 7a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>
                                <span data-lang="generatePdf">Generuj PDF</span>
                            </button>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-12 gap-8 lg:gap-12">
                        <div class="md:col-span-5 lg:col-span-4 p-6 rounded-lg shadow-sm" style="background-color: var(--bg-alt-color); border: 1px solid var(--border-color);">
                            <h3 class="text-2xl font-playfair border-b pb-2 mb-4" data-lang="ingredientsTitle" style="border-color: var(--border-color);">Sk≈Çadniki</h3>
                            <div id="ingredients-list"></div>
                        </div>
                        <div class="md:col-span-7 lg:col-span-8">
                            <h3 class="text-2xl font-playfair mb-4 text-center" data-lang="stepsTitle">Instrukcja Krok po Kroku</h3>
                            <div id="steps-accordion" class="space-y-3"></div>
                        </div>
                    </div>
                </section>
            </div>
            
            <div id="content-koncepcje" class="tab-content hidden">
                 <section class="max-w-5xl mx-auto">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-playfair mb-2" data-lang="conceptsTitle">Kluczowe Koncepcje Kulinarne</h2>
                        <p style="color: var(--text-muted-color);" data-lang="conceptsSubtitle">Zrozum "dlaczego" za ka≈ºdym krokiem, aby osiƒÖgnƒÖƒá mistrzostwo w pieczeniu.</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8 items-start">
                        <div class="p-6 rounded-lg shadow-sm" style="background-color: var(--bg-alt-color); border: 1px solid var(--border-color);">
                            <h3 class="text-2xl font-playfair text-center mb-4" data-lang="concept1Title">Fundament: Wyb√≥r Spodu</h3>
                            <p class="text-sm text-center mb-6" data-lang="concept1Desc" style="color: var(--text-muted-color);"></p>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 rounded-lg" style="border: 2px solid var(--accent-color); background-color: var(--bg-color);">
                                    <h4 class="font-bold text-center" data-lang="crustType1">Ciasto Kruche</h4>
                                    <ul class="mt-2 text-xs space-y-1" style="color: var(--text-muted-color);">
                                        <li data-lang="crust1Adv1"><span class="text-green-600 font-bold">‚úì</span> Bogaty, ma≈õlany smak</li>
                                        <li data-lang="crust1Adv2"><span class="text-green-600 font-bold">‚úì</span> Stabilna, chrupiƒÖca struktura</li>
                                        <li data-lang="crust1Adv3"><span class="text-green-600 font-bold">‚úì</span> Elegancki wyglƒÖd</li>
                                        <li data-lang="crust1Dis1"><span class="text-red-500 font-bold">‚úó</span> Wymaga podpiekania</li>
                                    </ul>
                                </div>
                                <div class="border p-4 rounded-lg" style="border-color: var(--border-color);">
                                    <h4 class="font-bold text-center" data-lang="crustType2">Sp√≥d Ciasteczkowy</h4>
                                    <ul class="mt-2 text-xs space-y-1" style="color: var(--text-muted-color);">
                                        <li data-lang="crust2Adv1"><span class="text-green-600 font-bold">‚úì</span> Szybko≈õƒá i prostota</li>
                                        <li data-lang="crust2Dis1"><span class="text-red-500 font-bold">‚úó</span> Ryzyko rozmiƒôkniƒôcia</li>
                                        <li data-lang="crust2Dis2"><span class="text-red-500 font-bold">‚úó</span> Mniej wyrafinowany smak</li>
                                        <li data-lang="crust2Dis3"><span class="text-red-500 font-bold">‚úó</span> Mo≈ºe byƒá zbyt s≈Çodki</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="p-6 rounded-lg shadow-sm" style="background-color: var(--bg-alt-color); border: 1px solid var(--border-color);">
                            <h3 class="text-2xl font-playfair text-center mb-4" data-lang="concept2Title">Serce Sernika: Proporcje Masy</h3>
                             <p class="text-sm text-center mb-6" data-lang="concept2Desc" style="color: var(--text-muted-color);"></p>
                            <div class="chart-container">
                                <canvas id="ingredientsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="content-wariacje" class="tab-content hidden">
                <section class="max-w-5xl mx-auto">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-playfair mb-2" data-lang="variationsTitle">Wielki Fina≈Ç: Wariacje i Porady</h2>
                        <p style="color: var(--text-muted-color);" data-lang="variationsSubtitle">Sernik jest doskona≈Çy sam w sobie, ale te dodatki mogƒÖ go wynie≈õƒá na nowy poziom.</p>
                    </div>
                    <div id="variations-accordion" class="space-y-4">
                    </div>
                </section>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const translations = {
        pl: {
            pageTitle: "Sernik Baskijski: Przepis Definitywny",
            mainTitle: "Sernik Baskijski",
            mainSubtitle: "Edycja Definitywna: Interaktywny Przewodnik",
            tabOverview: "PrzeglƒÖd",
            tabRecipe: "Przepis",
            tabConcepts: "Kluczowe Koncepcje",
            tabVariations: "Wariacje i Porady",
            overviewTitle: "W Poszukiwaniu Sernika Doskona≈Çego",
            overviewIntro: "Ta aplikacja to interaktywna podr√≥≈º ku stworzeniu sernika baskijskiego w jego ostatecznej formie. To nie jest zwyk≈Çy przepis, a kulinarne studium. CzerpiƒÖc inspiracjƒô z klasyk√≥w, ≈õwiadomie je udoskonalamy: dodajemy stabilny, ma≈õlany sp√≥d dla kontrastu tekstur, optymalizujemy sk≈Çadniki pod kƒÖtem zdrowszego profilu i wprowadzamy sekretny sk≈Çadnik ‚Äì palone mas≈Ço ‚Äì kt√≥re nadaje ca≈Ço≈õci niezwyk≈Çej g≈Çƒôbi. To deser, kt√≥ry celebruje idealnie skomponowanƒÖ niedoskona≈Ço≈õƒá, od spalonego wierzchu po p≈Çynne, kremowe serce.",
            feature1Title: "ChrupiƒÖcy Fundament",
            feature1Desc: "Orzechowy sp√≥d kruchy tworzy idealny kontrast dla aksamitnej masy serowej.",
            feature2Title: "G≈Çƒôbia Smaku",
            feature2Desc: "Dodatek palonego mas≈Ça wprowadza niezwyk≈Çe, orzechowo-karmelowe nuty.",
            feature3Title: "Zdrowsza S≈Çodycz",
            feature3Desc: "ZastƒÖpienie cukru erytrolem pozwala cieszyƒá siƒô deserem bez kompromis√≥w.",
            recipeTitle: "Przepis Definitywny",
            recipeSubtitle: "Dostosuj ilo≈õƒá sk≈Çadnik√≥w do swojej formy i postƒôpuj zgodnie z instrukcjƒÖ.",
            formSizeLabel: "Rozmiar formy:",
            ingredientsTitle: "Sk≈Çadniki",
            stepsTitle: "Instrukcja Krok po Kroku",
            conceptsTitle: "Kluczowe Koncepcje Kulinarne",
            conceptsSubtitle: "Zrozum \"dlaczego\" za ka≈ºdym krokiem, aby osiƒÖgnƒÖƒá mistrzostwo w pieczeniu.",
            concept1Title: "Fundament: Wyb√≥r Spodu",
            concept1Desc: "Dodanie spodu to kluczowa modyfikacja. Prawid≈Çowo przygotowany sp√≥d kruchy tworzy barierƒô zapobiegajƒÖcƒÖ rozmoczeniu i zapewnia niezbƒôdny kontrast teksturalny dla kremowej masy.",
            crustType1: "Ciasto Kruche",
            crust1Adv1: "‚úì Bogaty, ma≈õlany smak",
            crust1Adv2: "‚úì Stabilna, chrupiƒÖca struktura",
            crust1Adv3: "‚úì Elegancki wyglƒÖd",
            crust1Dis1: "‚úó Wymaga podpiekania",
            crustType2: "Sp√≥d Ciasteczkowy",
            crust2Adv1: "‚úì Szybko≈õƒá i prostota",
            crust2Dis1: "‚úó Ryzyko rozmiƒôkniƒôcia",
            crust2Dis2: "‚úó Mniej wyrafinowany smak",
            crust2Dis3: "‚úó Mo≈ºe byƒá zbyt s≈Çodki",
            concept2Title: "Serce Sernika: Proporcje Masy",
            concept2Desc: "Aksamitna, kremowa konsystencja to wynik idealnego zbalansowania sk≈Çadnik√≥w. Wykres pokazuje dominujƒÖcƒÖ rolƒô nabia≈Çu, kt√≥ry jest kluczem do luksusowej tekstury.",
            variationsTitle: "Wielki Fina≈Ç: Wariacje i Porady",
            variationsSubtitle: "Sernik jest doskona≈Çy sam w sobie, ale te dodatki mogƒÖ go wynie≈õƒá na nowy poziom.",
            crustTitle: "Sp√≥d Kruchy",
            fillingTitle: "Masa Serowa",
            ingredientFlourCrust: "MƒÖka pszenna tortowa (typ 450)",
            ingredientNuts: "Orzechy w≈Çoskie lub laskowe, zmielone",
            ingredientErythritolCrust: "Erytrol w pudrze",
            ingredientButterCrust: "Mas≈Ço, bardzo zimne",
            ingredientYolk: "≈ª√≥≈Çtko",
            ingredientSaltCrust: "S√≥l",
            unitG: "g",
            unitPcs: "szt. (L)",
            unitTsp: "≈Çy≈ºeczki",
            unitMl: "ml",
            ingredientButterFilling: "Mas≈Ço (do palonego mas≈Ça)",
            ingredientCurd: "Twar√≥g sernikowy z wiaderka, t≈Çusty",
            ingredientMascarpone: "Serek mascarpone",
            ingredientErythritolFilling: "Erytrol w pudrze",
            ingredientEggs: "Jajka",
            ingredientCream: "≈ömietanka krem√≥wka 36%",
            ingredientFlourFilling: "MƒÖka pszenna tortowa (typ 450)",
            ingredientVanilla: "Ekstrakt z wanilii",
            ingredientLemonZest: "Sk√≥rka starta z cytryny",
            ingredientSaltFilling: "S√≥l",
            step1Title: "Krok 1: Przygotowanie Spodu",
            step1Content: "W malakserze umie≈õƒá mƒÖkƒô, zmielone orzechy, erytrol i s√≥l. Miksuj pulsacyjnie. Dodaj zimne mas≈Ço, miksuj do konsystencji mokrego piasku. Dodaj ≈º√≥≈Çtko, miksuj kr√≥tko do po≈ÇƒÖczenia. Zawi≈Ñ w foliƒô i ch≈Çod≈∫ w lod√≥wce min. 60 minut. Piekarnik rozgrzej do 180¬∞C. Wylep ciastem dno tortownicy, nak≈Çuj widelcem. Przykryj papierem do pieczenia, obciƒÖ≈º fasolƒÖ. Piecz 15 minut. Zdejmij obciƒÖ≈ºenie i piecz kolejne 5-7 minut. Wystud≈∫.",
            step2Title: "Krok 2: Palone Mas≈Ço",
            step2Content: "W ma≈Çym rondelku podgrzewaj mas≈Ço na ≈õrednim ogniu. Bƒôdzie siƒô topiƒá, pieniƒá i skwierczeƒá. Gdy na dnie pojawiƒÖ siƒô brƒÖzowe drobinki, a mas≈Ço nabierze bursztynowego koloru i orzechowego zapachu, natychmiast zdejmij z ognia. Przelej do miseczki i ca≈Çkowicie wystud≈∫.",
            step3Title: "Krok 3: Masa Serowa",
            step3Content: "Zwiƒôksz temperaturƒô piekarnika do 220¬∞C (termoobieg) lub 240¬∞C (g√≥ra-d√≥≈Ç). Wy≈Ç√≥≈º tortownicƒô z podpieczonym spodem dwoma arkuszami papieru do pieczenia. W du≈ºej misie zmiksuj twar√≥g, mascarpone i erytrol na g≈ÇadkƒÖ masƒô. Dodawaj jajka, jedno po drugim, miksujƒÖc kr√≥tko po ka≈ºdym. Wlej ≈õmietankƒô, waniliƒô, wystudzone palone mas≈Ço, sk√≥rkƒô z cytryny i s√≥l. Kr√≥tko zmiksuj. Na koniec wsyp przesianƒÖ mƒÖkƒô i delikatnie wymieszaj szpatu≈ÇkƒÖ.",
            step4Title: "Krok 4: Pieczenie",
            step4Content: "Przelej masƒô na sp√≥d. Uderz formƒÖ o blat, by uwolniƒá pƒôcherzyki powietrza. Piecz 30-35 minut. Sernik mocno uro≈õnie, a wierzch stanie siƒô ciemnobrƒÖzowy. ≈örodek powinien pozostaƒá wyra≈∫nie dr≈ºƒÖcy (jak galareta na obszarze ok. 5-7 cm w centrum).",
            step5Title: "Krok 5: Studzenie i Ch≈Çodzenie",
            step5Content: "Wyjmij z piekarnika i odstaw do ca≈Çkowitego wystudzenia w temperaturze pokojowej (2-3 godziny). Sernik opadnie - to normalne. Po wystudzeniu wstaw do lod√≥wki na min. 8 godzin, a najlepiej na ca≈ÇƒÖ noc. Przed podaniem wyjmij na 30-60 minut, aby osiƒÖgnƒÖ≈Ç temperaturƒô pokojowƒÖ.",
            chartLabelCurd: "Twar√≥g Sernikowy",
            chartLabelMascarpone: "Serek Mascarpone",
            chartLabelCream: "≈ömietanka 36%",
            chartLabelEggs: "Jajka",
            chartLabelOther: "Pozosta≈Çe",
            chartTitle: "Proporcje Masy Serowej",
            variationModificationTitle: "Sk≈Çadniki / Modyfikacja:",
            variationInstructionTitle: "Instrukcja przygotowania:",
            variationEffectTitle: "Efekt i sugestia podania:",
            variationOrangeTitle: "Wersja Pomara≈Ñczowa z Cointreau",
            variationOrangeDesc: "Ta wariacja wprowadza ciep≈ÇƒÖ, cytrusowƒÖ nutƒô, kt√≥ra wspaniale komponuje siƒô z bogactwem sernika.",
            variationOrangeMod: "Dodaj <strong>2 ≈Çy≈ºki (30 ml) likieru Cointreau</strong> lub Grand Marnier.<br>Dodaj <strong>drobno startƒÖ sk√≥rkƒô z 1 du≈ºej, niewoskowanej pomara≈Ñczy</strong>.",
            variationOrangeInstr: "W <strong>Czƒô≈õci 3 (Przygotowanie masy serowej), w kroku 5</strong>, dodaj likier pomara≈Ñczowy oraz startƒÖ sk√≥rkƒô pomara≈ÑczowƒÖ w tym samym momencie, co ekstrakt z wanilii i sk√≥rkƒô z cytryny. Delikatnie wymieszaj do po≈ÇƒÖczenia.",
            variationOrangeEffect: "Ciep≈Çy, intensywnie cytrusowy aromat likieru doskonale prze≈Çamuje t≈Çusto≈õƒá masy serowej. Ta wersja idealnie komponuje siƒô z sosem z gorzkiej czekolady. Aby go przygotowaƒá, rozpu≈õƒá 100 g czekolady o zawarto≈õci kakao min. 70% w 100 ml gorƒÖcej ≈õmietanki 36%.",
            variationSpiceTitle: "Wersja Korzenna",
            variationSpiceDesc: "Idealna na ch≈Çodniejsze dni, ta wersja otula rozgrzewajƒÖcym aromatem przypraw korzennych, kt√≥re subtelnie wzbogacajƒÖ orzechowy sp√≥d.",
            variationSpiceMod: "Do suchych sk≈Çadnik√≥w na sp√≥d dodaj:<br><strong>¬Ω ≈Çy≈ºeczki cynamonu</strong><br><strong>¬º ≈Çy≈ºeczki kardamonu</strong><br><strong>Szczyptƒô (‚Öõ ≈Çy≈ºeczki) ≈õwie≈ºo startej ga≈Çki muszkato≈Çowej</strong>",
            variationSpiceInstr: "W <strong>Czƒô≈õci 1 (Przygotowanie i podpiekanie spodu), w kroku 1</strong>, przesiej przyprawy razem z mƒÖkƒÖ, zmielonymi orzechami, erytrolem i solƒÖ przed dodaniem mas≈Ça. Dalej postƒôpuj zgodnie z przepisem.",
            variationSpiceEffect: "Sp√≥d zyskuje g≈Çƒôboki, rozgrzewajƒÖcy smak, przypominajƒÖcy chai latte lub piernik. Sernik w tej wersji nie potrzebuje dodatkowych sos√≥w ‚Äì jego z≈Ço≈ºony aromat najlepiej podkre≈õli fili≈ºanka mocnej, czarnej kawy lub aromatycznej herbaty.",
            variationUmamiTitle: "Wersja Umami z Miso",
            variationUmamiDesc: "Dla odwa≈ºnych poszukiwaczy smaku. Dodatek bia≈Çej pasty miso tworzy niezwykle g≈Çƒôboki, s≈Çono-s≈Çodki profil, kt√≥ry podbija karmelowe nuty sernika do niespotykanego poziomu.",
            variationUmamiMod: "ZastƒÖp <strong>¬Ω ≈Çy≈ºeczki soli</strong> w masie serowej <strong>jednƒÖ p≈ÇaskƒÖ ≈Çy≈ºeczkƒÖ (ok. 5-6 g) bia≈Çej pasty miso (shiro miso)</strong>.",
            variationUmamiInstr: "W <strong>Czƒô≈õci 3 (Przygotowanie masy serowej), w kroku 5</strong>, przed dodaniem pasty miso do g≈Ç√≥wnej masy, rozmieszaj jƒÖ dok≈Çadnie w 2 ≈Çy≈ºkach ≈õmietanki krem√≥wki (pobranej z odmierzonej ilo≈õci 400 ml). Zapewni to g≈Çadkie po≈ÇƒÖczenie bez grudek. Dodaj mieszankƒô do masy serowej razem z resztƒÖ ≈õmietanki.",
            variationUmamiEffect: "To najbardziej wyrafinowana i zaskakujƒÖca wersja. Smak jest z≈Ço≈ºony, z wyczuwalnymi nutami s≈Çonego karmelu i subtelnym posmakiem umami. Ze wzglƒôdu na jego intensywno≈õƒá i unikalno≈õƒá, najlepiej podawaƒá go bez ≈ºadnych dodatk√≥w, aby w pe≈Çni doceniƒá jego charakter. Wystarczy bardzo cienki plasterek, by w pe≈Çni nasyciƒá zmys≈Çy.",
            variationCaramelTitle: "Sos S≈Çony Karmel",
            variationCaramelDesc: "Klasyczne i niezawodne po≈ÇƒÖczenie, kt√≥re podkre≈õla karmelowe nuty spalonego wierzchu.",
            variationCaramelMod: "<strong>100 g cukru</strong> (lub ksylitolu dla wersji bezcukrowej)<br><strong>60 ml wody</strong><br><strong>50 g mas≈Ça</strong><br><strong>120 ml ≈õmietanki 36%</strong><br><strong>¬Ω ≈Çy≈ºeczki soli morskiej</strong>",
            variationCaramelInstr: "W rondelku podgrzej cukier z wodƒÖ, nie mieszajƒÖc, a≈º do uzyskania bursztynowego karmelu. Zdejmij z ognia, ostro≈ºnie dodaj mas≈Ço i mieszaj do rozpuszczenia. Powoli wlej gorƒÖcƒÖ ≈õmietankƒô (uwaga, bƒôdzie pryskaƒá!) i energicznie mieszaj. Na koniec dodaj s√≥l.",
            variationCaramelEffect: "Gƒôsty, bogaty sos o idealnym balansie s≈Çodyczy i soli. Polewaj nim sch≈Çodzone porcje sernika tu≈º przed podaniem.",
            variationChocolateTitle: "Sos z Bia≈Çej Czekolady i Pistacji",
            variationChocolateDesc: "Elegancki i nowoczesny dodatek, kt√≥ry dodaje s≈Çodyczy i chrupko≈õci.",
            variationChocolateMod: "<strong>100 g bia≈Çej czekolady</strong> wysokiej jako≈õci<br><strong>50 ml ≈õmietanki 36%</strong><br><strong>2 ≈Çy≈ºki posiekanych pistacji</strong>",
            variationChocolateInstr: "≈ömietankƒô podgrzej niemal do wrzenia. Zdejmij z ognia i dodaj posiekanƒÖ bia≈ÇƒÖ czekoladƒô. Odczekaj minutƒô, a nastƒôpnie mieszaj do uzyskania g≈Çadkiego, l≈õniƒÖcego sosu.",
            variationChocolateEffect: "Aksamitny, s≈Çodki sos, kt√≥ry piƒôknie kontrastuje z lekko gorzkawym wierzchem sernika. Przed podaniem polej sosem kawa≈Çek ciasta i posyp ≈õwie≈ºo posiekanymi pistacjami.",
            variationCoulisTitle: "Mus Owocowy (Coulis)",
            variationCoulisDesc: "Prosty mus ze ≈õwie≈ºych malin lub truskawek doda kontrastujƒÖcej kwasowo≈õci i ≈õwie≈ºo≈õci.",
            variationCoulisMod: "<strong>200 g ≈õwie≈ºych lub mro≈ºonych owoc√≥w</strong> (maliny, truskawki)<br><strong>1-2 ≈Çy≈ºki erytrolu</strong> (lub do smaku)<br><strong>1 ≈Çy≈ºka soku z cytryny</strong>",
            variationCoulisInstr: "Owoce umie≈õƒá w rondelku z erytrolem i sokiem z cytryny. Podgrzewaj na ma≈Çym ogniu, a≈º owoce siƒô rozpadnƒÖ. Zblenduj na g≈Çadko, a nastƒôpnie przetrzyj przez drobne sitko, aby pozbyƒá siƒô pestek.",
            variationCoulisEffect: "Intensywnie owocowy, lekko kwa≈õny sos, kt√≥ry stanowi idealne orze≈∫wienie dla bogatego sernika. Podawaj sch≈Çodzony obok porcji ciasta.",
            generatePdf: "Generuj PDF",
            pdfGenerating: "Generowanie PDF..."
        },
        en: {
            pageTitle: "Basque Cheesecake: The Definitive Recipe",
            mainTitle: "Basque Cheesecake",
            mainSubtitle: "The Definitive Edition: An Interactive Guide",
            tabOverview: "Overview",
            tabRecipe: "Recipe",
            tabConcepts: "Key Concepts",
            tabVariations: "Variations & Tips",
            overviewTitle: "The Quest for the Perfect Cheesecake",
            overviewIntro: "This application is an interactive journey to create the ultimate Basque cheesecake. This isn't just a recipe; it's a culinary study. Drawing inspiration from the classics, we consciously refine them: adding a stable, buttery crust for textural contrast, optimizing ingredients for a healthier profile, and introducing a secret ingredient‚Äîbrown butter‚Äîthat gives the whole thing extraordinary depth. It's a dessert that celebrates perfectly composed imperfection, from its burnt top to its liquid, creamy heart.",
            feature1Title: "A Crunchy Foundation",
            feature1Desc: "The nutty shortcrust base creates a perfect contrast to the velvety cheese filling.",
            feature2Title: "Depth of Flavor",
            feature2Desc: "The addition of brown butter introduces incredible nutty and caramel notes.",
            feature3Title: "Healthier Sweetness",
            feature3Desc: "Replacing sugar with erythritol allows you to enjoy dessert without compromise.",
            recipeTitle: "The Definitive Recipe",
            recipeSubtitle: "Adjust the amount of ingredients to your pan size and follow the instructions.",
            formSizeLabel: "Pan size:",
            ingredientsTitle: "Ingredients",
            stepsTitle: "Step-by-Step Instructions",
            conceptsTitle: "Key Culinary Concepts",
            conceptsSubtitle: "Understand the 'why' behind each step to achieve baking mastery.",
            concept1Title: "Foundation: Choosing the Crust",
            concept1Desc: "Adding a crust is a key modification. A properly prepared shortcrust base creates a barrier against sogginess and provides essential textural contrast for the creamy filling.",
            crustType1: "Shortcrust Pastry",
            crust1Adv1: "‚úì Rich, buttery flavor",
            crust1Adv2: "‚úì Stable, crispy texture",
            crust1Adv3: "‚úì Elegant appearance",
            crust1Dis1: "‚úó Requires blind-baking",
            crustType2: "Cookie Crust",
            crust2Adv1: "‚úì Quick and simple",
            crust2Dis1: "‚úó Risk of getting soggy",
            crust2Dis2: "‚úó Less refined flavor",
            crust2Dis3: "‚úó Can be overly sweet",
            concept2Title: "The Heart: Filling Proportions",
            concept2Desc: "The velvety, creamy consistency is the result of perfectly balanced ingredients. The chart shows the dominant role of dairy, which is the key to a luxurious texture.",
            variationsTitle: "The Grand Finale: Variations & Tips",
            variationsSubtitle: "The cheesecake is perfect on its own, but these additions can take it to the next level.",
            crustTitle: "Shortcrust Base",
            fillingTitle: "Cheese Filling",
            ingredientFlourCrust: "All-purpose flour (type 450)",
            ingredientNuts: "Walnuts or hazelnuts, ground",
            ingredientErythritolCrust: "Powdered erythritol",
            ingredientButterCrust: "Butter, very cold",
            ingredientYolk: "Egg yolk",
            ingredientSaltCrust: "Salt",
            unitG: "g",
            unitPcs: "pc (L)",
            unitTsp: "tsp",
            unitMl: "ml",
            ingredientButterFilling: "Butter (for brown butter)",
            ingredientCurd: "Cream cheese, full-fat",
            ingredientMascarpone: "Mascarpone cheese",
            ingredientErythritolFilling: "Powdered erythritol",
            ingredientEggs: "Eggs",
            ingredientCream: "Heavy cream 36%",
            ingredientFlourFilling: "All-purpose flour (type 450)",
            ingredientVanilla: "Vanilla extract",
            ingredientLemonZest: "Lemon zest",
            ingredientSaltFilling: "Salt",
            step1Title: "Step 1: Preparing the Crust",
            step1Content: "In a food processor, combine flour, ground nuts, erythritol, and salt. Pulse to mix. Add cold butter and pulse until it resembles wet sand. Add the yolk and pulse briefly until combined. Wrap in foil and chill for at least 60 minutes. Preheat oven to 180¬∞C (350¬∞F). Press the dough into the bottom of the springform pan, prick with a fork. Cover with parchment paper, weigh down with beans. Bake for 15 minutes. Remove weights and bake for another 5-7 minutes. Cool.",
            step2Title: "Step 2: Brown Butter",
            step2Content: "In a small saucepan, heat the butter over medium heat. It will melt, foam, and sizzle. When brown specks appear at the bottom and the butter turns amber with a nutty aroma, immediately remove from heat. Pour into a bowl to cool completely.",
            step3Title: "Step 3: Cheese Filling",
            step3Content: "Increase oven temperature to 220¬∞C (425¬∞F) with convection or 240¬∞C (465¬∞F) conventional. Line the springform pan (with the pre-baked crust) with two sheets of parchment paper. In a large bowl, mix cream cheese, mascarpone, and erythritol until smooth. Add eggs one by one, mixing briefly after each. Pour in the cream, vanilla, cooled brown butter, lemon zest, and salt. Mix briefly. Finally, sift in the flour and gently fold with a spatula.",
            step4Title: "Step 4: Baking",
            step4Content: "Pour the filling onto the crust. Tap the pan on the counter to release air bubbles. Bake for 30-35 minutes. The cheesecake will rise significantly, and the top will become dark brown. The center should remain very jiggly (like jelly in a 5-7 cm area).",
            step5Title: "Step 5: Cooling",
            step5Content: "Remove from the oven and let it cool completely at room temperature (2-3 hours). The cheesecake will collapse‚Äîthis is normal. Once cooled, refrigerate for at least 8 hours, or preferably overnight. Before serving, take it out for 30-60 minutes to reach room temperature.",
            chartLabelCurd: "Cream Cheese",
            chartLabelMascarpone: "Mascarpone",
            chartLabelCream: "Heavy Cream 36%",
            chartLabelEggs: "Eggs",
            chartLabelOther: "Other",
            chartTitle: "Cheese Filling Proportions",
            variationModificationTitle: "Ingredients / Modification:",
            variationInstructionTitle: "Preparation Instructions:",
            variationEffectTitle: "Effect & Serving Suggestion:",
            variationOrangeTitle: "Orange & Cointreau Version",
            variationOrangeDesc: "This variation introduces a warm, citrusy note that pairs wonderfully with the richness of the cheesecake.",
            variationOrangeMod: "Add <strong>2 tbsp (30 ml) of Cointreau</strong> or Grand Marnier.<br>Add the <strong>finely grated zest of 1 large, unwaxed orange</strong>.",
            variationOrangeInstr: "In <strong>Part 3 (Preparing the cheese filling), step 5</strong>, add the orange liqueur and orange zest at the same time as the vanilla extract and lemon zest. Mix gently to combine.",
            variationOrangeEffect: "The warm, intensely citrusy aroma of the liqueur perfectly cuts through the richness of the cheese filling. This version pairs ideally with a dark chocolate sauce. To prepare it, melt 100g of chocolate (min. 70% cocoa) in 100ml of hot heavy cream (36%).",
            variationSpiceTitle: "Spiced Version",
            variationSpiceDesc: "Perfect for colder days, this version envelops you with the warming aroma of spices that subtly enrich the nutty crust.",
            variationSpiceMod: "To the dry ingredients for the crust, add:<br><strong>¬Ω tsp cinnamon</strong><br><strong>¬º tsp cardamom</strong><br><strong>A pinch (‚Öõ tsp) of freshly grated nutmeg</strong>",
            variationSpiceInstr: "In <strong>Part 1 (Preparing and blind-baking the crust), step 1</strong>, sift the spices together with the flour, ground nuts, erythritol, and salt before adding the butter. Then proceed with the recipe.",
            variationSpiceEffect: "The crust gains a deep, warming flavor reminiscent of chai latte or gingerbread. This version of the cheesecake needs no additional sauces‚Äîits complex aroma is best highlighted by a cup of strong black coffee or aromatic tea.",
            variationUmamiTitle: "Umami & Miso Version",
            variationUmamiDesc: "For the adventurous flavor seeker. The addition of white miso paste creates an incredibly deep, sweet-and-salty profile that elevates the cheesecake's caramel notes to an unprecedented level.",
            variationUmamiMod: "Replace the <strong>¬Ω tsp of salt</strong> in the cheese filling with <strong>one level teaspoon (approx. 5-6 g) of white miso paste (shiro miso)</strong>.",
            variationUmamiInstr: "In <strong>Part 3 (Preparing the cheese filling), step 5</strong>, before adding the miso paste to the main mixture, whisk it thoroughly in 2 tablespoons of heavy cream (taken from the measured 400 ml). This will ensure a smooth combination without lumps. Add the mixture to the cheese filling along with the rest of the cream.",
            variationUmamiEffect: "This is the most sophisticated and surprising version. The flavor is complex, with discernible notes of salted caramel and a subtle umami aftertaste. Due to its intensity and uniqueness, it is best served without any additions to fully appreciate its character. A very thin slice is enough to fully satisfy the senses.",
            variationCaramelTitle: "Salted Caramel Sauce",
            variationCaramelDesc: "A classic and reliable combination that enhances the caramel notes of the burnt top.",
            variationCaramelMod: "<strong>100 g sugar</strong> (or xylitol for a sugar-free version)<br><strong>60 ml water</strong><br><strong>50 g butter</strong><br><strong>120 ml heavy cream 36%</strong><br><strong>¬Ω tsp sea salt</strong>",
            variationCaramelInstr: "In a saucepan, heat the sugar and water without stirring until an amber caramel forms. Remove from heat, carefully add the butter, and stir until dissolved. Slowly pour in the hot cream (be careful, it will bubble up!) and whisk vigorously. Finally, add the salt.",
            variationCaramelEffect: "A thick, rich sauce with a perfect balance of sweet and salty. Drizzle over chilled cheesecake slices just before serving.",
            variationChocolateTitle: "White Chocolate & Pistachio Sauce",
            variationChocolateDesc: "An elegant and modern addition that adds sweetness and crunch.",
            variationChocolateMod: "<strong>100 g high-quality white chocolate</strong><br><strong>50 ml heavy cream 36%</strong><br><strong>2 tbsp chopped pistachios</strong>",
            variationChocolateInstr: "Heat the cream until almost boiling. Remove from heat and add the chopped white chocolate. Wait a minute, then stir until you have a smooth, glossy sauce.",
            variationChocolateEffect: "A velvety, sweet sauce that beautifully contrasts with the slightly bitter top of the cheesecake. Drizzle over a slice of cake and sprinkle with freshly chopped pistachios before serving.",
            variationCoulisTitle: "Fruit Coulis",
            variationCoulisDesc: "A simple coulis of fresh raspberries or strawberries will add a contrasting acidity and freshness.",
            variationCoulisMod: "<strong>200 g fresh or frozen berries</strong> (raspberries, strawberries)<br><strong>1-2 tbsp erythritol</strong> (or to taste)<br><strong>1 tbsp lemon juice</strong>",
            variationCoulisInstr: "Place the berries, erythritol, and lemon juice in a saucepan. Heat over low heat until the berries break down. Blend until smooth, then strain through a fine-mesh sieve to remove the seeds.",
            variationCoulisEffect: "An intensely fruity, slightly tart sauce that provides a perfect refreshment to the rich cheesecake. Serve chilled alongside a slice of cake.",
            generatePdf: "Generate PDF",
            pdfGenerating: "Generating PDF..."
        }
    };

    const data = {
        base: {
            spod: [
                { nameKey: 'ingredientFlourCrust', amount: 250, unitKey: 'unitG' },
                { nameKey: 'ingredientNuts', amount: 50, unitKey: 'unitG' },
                { nameKey: 'ingredientErythritolCrust', amount: 120, unitKey: 'unitG' },
                { nameKey: 'ingredientButterCrust', amount: 200, unitKey: 'unitG' },
                { nameKey: 'ingredientYolk', amount: 1, unitKey: 'unitPcs' },
                { nameKey: 'ingredientSaltCrust', amount: 0.5, unitKey: 'unitTsp' }
            ],
            masa: [
                { nameKey: 'ingredientButterFilling', amount: 80, unitKey: 'unitG' },
                { nameKey: 'ingredientCurd', amount: 700, unitKey: 'unitG' },
                { nameKey: 'ingredientMascarpone', amount: 300, unitKey: 'unitG' },
                { nameKey: 'ingredientErythritolFilling', amount: 250, unitKey: 'unitG' },
                { nameKey: 'ingredientEggs', amount: 5, unitKey: 'unitPcs' },
                { nameKey: 'ingredientCream', amount: 400, unitKey: 'unitMl' },
                { nameKey: 'ingredientFlourFilling', amount: 35, unitKey: 'unitG' },
                { nameKey: 'ingredientVanilla', amount: 1, unitKey: 'unitTsp' },
                { nameKey: 'ingredientLemonZest', amount: 1, unitKey: 'unitTsp' },
                { nameKey: 'ingredientSaltFilling', amount: 0.5, unitKey: 'unitTsp' }
            ]
        },
        steps: [
            { titleKey: 'step1Title', contentKey: 'step1Content' },
            { titleKey: 'step2Title', contentKey: 'step2Content' },
            { titleKey: 'step3Title', contentKey: 'step3Content' },
            { titleKey: 'step4Title', contentKey: 'step4Content' },
            { titleKey: 'step5Title', contentKey: 'step5Content' }
        ],
        variations: [
            {
                titleKey: 'variationOrangeTitle', descKey: 'variationOrangeDesc',
                modKey: 'variationOrangeMod', instrKey: 'variationOrangeInstr', effectKey: 'variationOrangeEffect'
            },
            {
                titleKey: 'variationSpiceTitle', descKey: 'variationSpiceDesc',
                modKey: 'variationSpiceMod', instrKey: 'variationSpiceInstr', effectKey: 'variationSpiceEffect'
            },
            {
                titleKey: 'variationUmamiTitle', descKey: 'variationUmamiDesc',
                modKey: 'variationUmamiMod', instrKey: 'variationUmamiInstr', effectKey: 'variationUmamiEffect'
            },
            {
                titleKey: 'variationCaramelTitle', descKey: 'variationCaramelDesc',
                modKey: 'variationCaramelMod', instrKey: 'variationCaramelInstr', effectKey: 'variationCaramelEffect'
            },
            {
                titleKey: 'variationChocolateTitle', descKey: 'variationChocolateDesc',
                modKey: 'variationChocolateMod', instrKey: 'variationChocolateInstr', effectKey: 'variationChocolateEffect'
            },
            {
                titleKey: 'variationCoulisTitle', descKey: 'variationCoulisDesc',
                modKey: 'variationCoulisMod', instrKey: 'variationCoulisInstr', effectKey: 'variationCoulisEffect'
            }
        ],
        scaleFactor: 1.4
    };

    let currentLang = 'pl';
    let ingredientsChart;

    const ingredientsContainer = document.getElementById('ingredients-list');
    const stepsContainer = document.getElementById('steps-accordion');
    const variationsContainer = document.getElementById('variations-accordion');
    const size23Btn = document.getElementById('size-23');
    const size28Btn = document.getElementById('size-28');
    const langPlBtn = document.getElementById('lang-pl');
    const langEnBtn = document.getElementById('lang-en');
    const themeToggle = document.getElementById('theme-toggle');
    const pdfBtn = document.getElementById('generate-pdf');
    const loader = document.getElementById('loader');

    function updateLanguage(lang) {
        currentLang = lang;
        document.documentElement.lang = lang;

        document.querySelectorAll('[data-lang]').forEach(el => {
            const key = el.dataset.lang;
            if (translations[lang][key]) {
                el.innerHTML = translations[lang][key];
            }
        });
        
        const currentScale = size28Btn.style.backgroundColor === 'var(--accent-color)' ? data.scaleFactor : 1;
        renderIngredients(currentScale);
        renderSteps();
        renderVariations();
        renderChart();
        updateLangButtons();
    }

    function updateLangButtons() {
        if (currentLang === 'pl') {
            langPlBtn.style.backgroundColor = 'var(--accent-color)';
            langPlBtn.style.color = 'var(--accent-text-color)';
            langEnBtn.style.backgroundColor = 'var(--button-inactive-bg)';
            langEnBtn.style.color = 'var(--button-inactive-text)';
        } else {
            langEnBtn.style.backgroundColor = 'var(--accent-color)';
            langEnBtn.style.color = 'var(--accent-text-color)';
            langPlBtn.style.backgroundColor = 'var(--button-inactive-bg)';
            langPlBtn.style.color = 'var(--button-inactive-text)';
        }
    }

    function renderIngredients(scale = 1) {
        const t = translations[currentLang];
        let html = `<h4 class="font-bold text-lg mb-3" style="color: var(--text-color);">${t.crustTitle}</h4><ul class="space-y-2 mb-6">`;
        data.base.spod.forEach(item => {
            const amount = (item.amount * scale).toFixed(1).replace('.0', '');
            html += `<li class="flex justify-between items-center text-sm"><span style="color: var(--text-muted-color);">${t[item.nameKey]}</span><span class="font-semibold" style="color: var(--accent-color);">${amount} ${t[item.unitKey]}</span></li>`;
        });
        html += `</ul><h4 class="font-bold text-lg mb-3" style="color: var(--text-color);">${t.fillingTitle}</h4><ul class="space-y-2">`;
        data.base.masa.forEach(item => {
            const amount = (item.amount * scale).toFixed(1).replace('.0', '');
            html += `<li class="flex justify-between items-center text-sm"><span style="color: var(--text-muted-color);">${t[item.nameKey]}</span><span class="font-semibold" style="color: var(--accent-color);">${amount} ${t[item.unitKey]}</span></li>`;
        });
        html += '</ul>';
        ingredientsContainer.innerHTML = html;
    }

    function renderSteps() {
        const t = translations[currentLang];
        let html = '';
        data.steps.forEach((step) => {
            html += `
                <div class="rounded-lg overflow-hidden" style="border: 1px solid var(--border-color);">
                    <button class="accordion-button w-full text-left p-4 focus:outline-none flex justify-between items-center" style="background-color: var(--bg-alt-color);">
                        <span class="font-semibold text-base" style="color: var(--heading-color);">${t[step.titleKey]}</span>
                        <svg class="w-5 h-5 transform transition-transform" style="color: var(--text-muted-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content" style="background-color: var(--bg-color);">
                        <p class="p-4 text-sm leading-relaxed" style="color: var(--text-muted-color);">${t[step.contentKey]}</p>
                    </div>
                </div>
            `;
        });
        stepsContainer.innerHTML = html;
    }

    function renderVariations() {
        const t = translations[currentLang];
        let html = '';
        data.variations.forEach(v => {
            html += `
                <div class="rounded-lg overflow-hidden" style="border: 1px solid var(--border-color);">
                    <button class="accordion-button w-full text-left p-4 focus:outline-none flex justify-between items-center" style="background-color: var(--bg-alt-color);">
                        <span class="font-playfair text-xl" style="color: var(--accent-color);">${t[v.titleKey]}</span>
                        <svg class="w-5 h-5 transform transition-transform" style="color: var(--text-muted-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content" style="background-color: var(--bg-color);">
                        <div class="p-4 space-y-4">
                            <p class="text-sm italic" style="color: var(--text-muted-color);">${t[v.descKey]}</p>
                            <div>
                                <h4 class="font-bold text-sm mb-1" style="color: var(--text-color);">${t.variationModificationTitle}</h4>
                                <p class="text-sm" style="color: var(--text-muted-color);">${t[v.modKey]}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm mb-1" style="color: var(--text-color);">${t.variationInstructionTitle}</h4>
                                <p class="text-sm" style="color: var(--text-muted-color);">${t[v.instrKey]}</p>
                            </div>
                             <div>
                                <h4 class="font-bold text-sm mb-1" style="color: var(--text-color);">${t.variationEffectTitle}</h4>
                                <p class="text-sm" style="color: var(--text-muted-color);">${t[v.effectKey]}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        variationsContainer.innerHTML = html;
    }

    function renderChart() {
        if (ingredientsChart) {
            ingredientsChart.destroy();
        }
        const t = translations[currentLang];
        const ctx = document.getElementById('ingredientsChart').getContext('2d');
        const isDark = document.documentElement.classList.contains('dark');
        const legendColor = isDark ? '#D1D5DB' : '#4A4A4A';

        ingredientsChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: [t.chartLabelCurd, t.chartLabelMascarpone, t.chartLabelCream, t.chartLabelEggs, t.chartLabelOther],
                datasets: [{
                    label: t.chartTitle,
                    data: [700, 300, 400, 250, 150],
                    backgroundColor: ['#D4A373', '#E5BF99', '#F2E4D5', '#8D8D8D', '#BFBFBF'],
                    borderColor: isDark ? '#1F2937' : '#FFFFFF',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: legendColor,
                            font: { family: "'Lato', sans-serif" }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.label}: ${context.parsed}g`
                        }
                    }
                }
            }
        });
    }

    function generatePdf() {
        loader.classList.remove('hidden');
        const { jsPDF } = window.jspdf;
        const pdfContentWrapper = document.getElementById('pdf-content-wrapper');
        const t = translations[currentLang];
        const scale = size28Btn.style.backgroundColor === 'var(--accent-color)' ? data.scaleFactor : 1;

        let ingredientsHtml = `<h3 style="font-family: 'Playfair Display', serif; font-size: 14pt; color: #3D405B; border-bottom: 1px solid #D4A373; padding-bottom: 4px; margin-bottom: 12px;">${t.ingredientsTitle}</h3>`;
        ingredientsHtml += `<h4 style="font-size: 12pt; font-weight: bold; margin-top: 12px; margin-bottom: 6px;">${t.crustTitle}</h4><ul style="list-style-type: none; padding-left: 0;">`;
        data.base.spod.forEach(item => {
            const amount = (item.amount * scale).toFixed(1).replace('.0', '');
            ingredientsHtml += `<li style="font-size: 10pt; margin-bottom: 4px; display: flex; justify-content: space-between;"><span>${t[item.nameKey]}</span><span style="font-weight: bold;">${amount} ${t[item.unitKey]}</span></li>`;
        });
        ingredientsHtml += `</ul><h4 style="font-size: 12pt; font-weight: bold; margin-top: 12px; margin-bottom: 6px;">${t.fillingTitle}</h4><ul style="list-style-type: none; padding-left: 0;">`;
        data.base.masa.forEach(item => {
            const amount = (item.amount * scale).toFixed(1).replace('.0', '');
            ingredientsHtml += `<li style="font-size: 10pt; margin-bottom: 4px; display: flex; justify-content: space-between;"><span>${t[item.nameKey]}</span><span style="font-weight: bold;">${amount} ${t[item.unitKey]}</span></li>`;
        });
        ingredientsHtml += '</ul>';

        let stepsHtml = `<h3 style="font-family: 'Playfair Display', serif; font-size: 14pt; color: #3D405B; border-bottom: 1px solid #D4A373; padding-bottom: 4px; margin-bottom: 12px;">${t.stepsTitle}</h3>`;
        data.steps.forEach(step => {
            stepsHtml += `<div style="margin-bottom: 12px; page-break-inside: avoid;">
                <h4 style="font-size: 12pt; font-weight: bold; margin-bottom: 4px;">${t[step.titleKey]}</h4>
                <p style="font-size: 10pt; line-height: 1.4;">${t[step.contentKey]}</p>
            </div>`;
        });

        pdfContentWrapper.innerHTML = `
            <div id="pdf-content" style="font-family: 'Lato', sans-serif; width: 190mm; padding: 10mm; background-color: #FFF; color: #4A4A4A;">
                <h1 style="font-family: 'Playfair Display', serif; font-size: 26pt; text-align: center; margin-bottom: 4px; color: #3D405B;">${t.mainTitle}</h1>
                <p style="font-size: 11pt; text-align: center; color: #6B7280; margin-bottom: 20px;">${t.mainSubtitle}</p>
                <div style="display: flex; flex-direction: row; gap: 15mm;">
                    <div style="width: 35%;">
                        ${ingredientsHtml}
                    </div>
                    <div style="width: 65%; border-left: 1px solid #E5E7EB; padding-left: 15mm;">
                        ${stepsHtml}
                    </div>
                </div>
            </div>
        `;
        
        const pdfContent = document.getElementById('pdf-content');
        html2canvas(pdfContent, { scale: 3 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = doc.internal.pageSize.getHeight();
            doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            
            doc.save('Sernik-Baskijski-Przepis.pdf');
            loader.classList.add('hidden');
            pdfContentWrapper.innerHTML = '';
        }).catch(err => {
            console.error("Error generating PDF:", err);
            loader.classList.add('hidden');
            pdfContentWrapper.innerHTML = '';
        });
    }


    langPlBtn.addEventListener('click', () => updateLanguage('pl'));
    langEnBtn.addEventListener('click', () => updateLanguage('en'));

    themeToggle.addEventListener('change', () => {
        document.documentElement.classList.toggle('dark', themeToggle.checked);
        renderChart();
    });

    size23Btn.addEventListener('click', () => {
        renderIngredients(1);
        size23Btn.style.backgroundColor = 'var(--accent-color)';
        size23Btn.style.color = 'var(--accent-text-color)';
        size28Btn.style.backgroundColor = 'var(--button-inactive-bg)';
        size28Btn.style.color = 'var(--button-inactive-text)';
    });

    size28Btn.addEventListener('click', () => {
        renderIngredients(data.scaleFactor);
        size28Btn.style.backgroundColor = 'var(--accent-color)';
        size28Btn.style.color = 'var(--accent-text-color)';
        size23Btn.style.backgroundColor = 'var(--button-inactive-bg)';
        size23Btn.style.color = 'var(--button-inactive-text)';
    });

    document.getElementById('variations-accordion').addEventListener('click', function(e) {
        const button = e.target.closest('.accordion-button');
        if (button) {
            button.classList.toggle('active');
            button.querySelector('svg').classList.toggle('rotate-180');
        }
    });

    stepsContainer.addEventListener('click', function(e) {
        const button = e.target.closest('.accordion-button');
        if (button) {
            button.classList.toggle('active');
            button.querySelector('svg').classList.toggle('rotate-180');
        }
    });

    document.querySelectorAll('.tab-btn').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.replace('tab-active', 'tab-inactive'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));

            tab.classList.replace('tab-inactive', 'tab-active');
            document.getElementById(`content-${tab.id.split('-')[1]}`).classList.remove('hidden');
        });
    });

    pdfBtn.addEventListener('click', generatePdf);

    // Initial render
    updateLanguage('pl');
});
</script>
</body>
</html>
